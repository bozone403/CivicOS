import{j as e}from"./ui-CDUWW_Ri.js";import{r as c}from"./vendor-1XCZ5AD1.js";import{z as W,q as X,p as Y,E as Z,K as L,r as _,D,a0 as G,B as l,W as ee,a as se,b as ae,c as te,d as re,I as p,l as ie,ae as B,_ as u,X as N,Y as f,Z as y,v as le,P as ce,ar as ne,as as de,al as oe,ak as xe,am as me}from"./index-DhTCSRfs.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=W("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);function ue(){var k,z,E,F,T,A,P,$;const{user:h}=X(),{toast:Q}=Y(),w=Z(),[r,U]=c.useState(null),[m,v]=c.useState(""),[g,V]=c.useState(""),b=c.useRef(null),[R,H]=c.useState(!1),{data:S=[]}=L({queryKey:["/api/social/conversations"],queryFn:async()=>{const s=await fetch("/api/social/conversations",{headers:{Authorization:`Bearer ${localStorage.getItem("civicos-jwt")}`}});if(!s.ok)throw new Error("Failed to fetch conversations");return s.json()},staleTime:3e4}),{data:j=[]}=L({queryKey:["/api/social/messages",r],queryFn:async()=>{if(!r)return[];const s=await fetch(`/api/social/messages/${r}`,{headers:{Authorization:`Bearer ${localStorage.getItem("civicos-jwt")}`}});if(!s.ok)throw new Error("Failed to fetch messages");return s.json()},enabled:!!r,staleTime:1e4}),I=_({mutationFn:async s=>{const t=await fetch("/api/social/messages",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("civicos-jwt")}`},body:JSON.stringify({content:s,receiverId:r,conversationId:r})});if(!t.ok)throw new Error("Failed to send message");return t.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["/api/social/messages",r]}),w.invalidateQueries({queryKey:["/api/social/conversations"]}),v("")},onError:s=>{Q({title:"Failed to send message",description:s.message||"Please try again",variant:"destructive"})}});c.useEffect(()=>{var s;(s=b.current)==null||s.scrollIntoView({behavior:"smooth"})},[j]);const C=()=>{!m.trim()||!r||I.mutate(m)},J=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),C())},M=S.filter(s=>{var t,i;return((t=s.participant)==null?void 0:t.firstName.toLowerCase().includes(g.toLowerCase()))||((i=s.participant)==null?void 0:i.lastName.toLowerCase().includes(g.toLowerCase()))}),a=S.find(s=>s.id===r);return e.jsxs("div",{className:"h-screen flex bg-gray-50",children:[e.jsxs("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Messages"}),e.jsxs(D,{open:R,onOpenChange:H,children:[e.jsx(G,{asChild:!0,children:e.jsx(l,{size:"sm",variant:"outline",children:e.jsx(ee,{className:"w-4 h-4"})})}),e.jsxs(se,{children:[e.jsxs(ae,{children:[e.jsx(te,{children:"New Conversation"}),e.jsx(re,{children:"Start a new conversation with another user"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(p,{placeholder:"Search users..."})})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(p,{placeholder:"Search conversations...",value:g,onChange:s=>V(s.target.value),className:"pl-10"})]})]}),e.jsx(B,{className:"flex-1",children:e.jsx("div",{className:"space-y-1 p-2",children:M.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(u,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No conversations yet"}),e.jsx("p",{className:"text-sm",children:"Add friends to start messaging"})]}):M.map(s=>{var t,i,n,d,o,x,q,K,O;return e.jsx("div",{onClick:()=>U(s.id),className:`p-3 rounded-lg cursor-pointer transition-colors ${r===s.id?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(N,{className:"w-12 h-12",children:[e.jsx(f,{src:(t=s.participant)==null?void 0:t.profileImageUrl}),e.jsxs(y,{children:[(n=(i=s.participant)==null?void 0:i.firstName)==null?void 0:n[0],(o=(d=s.participant)==null?void 0:d.lastName)==null?void 0:o[0]]})]}),((x=s.participant)==null?void 0:x.isOnline)&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-sm truncate",children:[(q=s.participant)==null?void 0:q.firstName," ",(K=s.participant)==null?void 0:K.lastName]}),s.lastMessage&&e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.lastMessage.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:((O=s.lastMessage)==null?void 0:O.content)||"No messages yet"}),s.unreadCount>0&&e.jsx(le,{variant:"secondary",className:"mt-1",children:s.unreadCount})]})]})},s.id)})})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(N,{className:"w-10 h-10",children:[e.jsx(f,{src:(k=a==null?void 0:a.participant)==null?void 0:k.profileImageUrl}),e.jsxs(y,{children:[(E=(z=a==null?void 0:a.participant)==null?void 0:z.firstName)==null?void 0:E[0],(T=(F=a==null?void 0:a.participant)==null?void 0:F.lastName)==null?void 0:T[0]]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold",children:[(A=a==null?void 0:a.participant)==null?void 0:A.firstName," ",(P=a==null?void 0:a.participant)==null?void 0:P.lastName]}),e.jsx("div",{className:"flex items-center space-x-2",children:($=a==null?void 0:a.participant)!=null&&$.isOnline?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm text-green-600",children:"Online"})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Offline"})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(he,{className:"w-4 h-4"})})]})]})}),e.jsx(B,{className:"flex-1 p-4",children:e.jsxs("div",{className:"space-y-4",children:[j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(u,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Start the conversation!"})]}):j.map(s=>{var i,n,d,o,x;const t=s.senderId===(h==null?void 0:h.id);return e.jsx("div",{className:`flex ${t?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex items-end space-x-2 max-w-xs lg:max-w-md ${t?"flex-row-reverse space-x-reverse":""}`,children:[!t&&e.jsxs(N,{className:"w-8 h-8",children:[e.jsx(f,{src:(i=s.sender)==null?void 0:i.profileImageUrl}),e.jsxs(y,{children:[(d=(n=s.sender)==null?void 0:n.firstName)==null?void 0:d[0],(x=(o=s.sender)==null?void 0:o.lastName)==null?void 0:x[0]]})]}),e.jsxs("div",{className:`px-4 py-2 rounded-lg ${t?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-blue-100":"text-gray-500"}`,children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},s.id)}),e.jsx("div",{ref:b})]})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1",children:e.jsx(p,{placeholder:"Type a message...",value:m,onChange:s=>v(s.target.value),onKeyPress:J,className:"w-full"})}),e.jsx(l,{onClick:C,disabled:!m.trim()||I.isPending,size:"sm",children:e.jsx(me,{className:"w-4 h-4"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No conversation selected"}),e.jsx("p",{className:"text-gray-500",children:"Choose a conversation from the sidebar to start messaging"})]})})})]})}export{ue as default};
