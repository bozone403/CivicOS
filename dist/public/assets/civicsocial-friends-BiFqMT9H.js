var _=Object.defineProperty;var G=(t,a,l)=>a in t?_(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l;var L=(t,a,l)=>G(t,typeof a!="symbol"?a+"":a,l);import{j as e}from"./ui-CDUWW_Ri.js";import{r as N}from"./vendor-1XCZ5AD1.js";import{z as H,ao as W,q as K,g as k,W as T,l as V,aj as Y,B as y,J as Z,ap as M,U as J}from"./index-Lb3F-gwD.js";import{a as q,g as ee,h as se,i as ae,e as te}from"./useCivicSocial-BrXtd9st.js";import{U as ie}from"./user-check-ChJDsj_E.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=H("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);class le{constructor(){L(this,"baseURL");this.baseURL=W.apiUrl}async request(a,l={}){const U=`${this.baseURL}${a}`,o={credentials:"include",headers:{"Content-Type":"application/json",...l.headers},...l};return fetch(U,o)}async get(a){return this.request(a,{method:"GET"})}async post(a,l){return this.request(a,{method:"POST",body:l?JSON.stringify(l):void 0})}async put(a,l){return this.request(a,{method:"PUT",body:l?JSON.stringify(l):void 0})}async delete(a){return this.request(a,{method:"DELETE"})}}const re=new le;function ge(){const{user:t}=K(),{data:a,isLoading:l,error:U}=q(),o=(a==null?void 0:a.friends)||[],f=(a==null?void 0:a.received)||[],j=(a==null?void 0:a.sent)||[],S=ee(),A=se(),w=ae(),R=te(),[p,I]=N.useState(""),[$,C]=N.useState([]),[X,z]=N.useState(!1),[E,P]=N.useState(null),[ne,B]=N.useState(null);N.useEffect(()=>{if(p.length<2){C([]),P(null);return}const i=setTimeout(async()=>{z(!0),P(null);try{const n=await(await re.get(`/api/users/search?q=${encodeURIComponent(p)}`)).json();if(n.users){const m=n.users.filter(d=>{const x=d.id===(t==null?void 0:t.id),h=o.some(c=>c.id===d.id),g=j.some(c=>c.friendId===d.id),u=f.some(c=>c.userId===d.id);return!x&&!h&&!g&&!u});C(m)}}catch{P("Failed to search users")}finally{z(!1)}},300);return()=>clearTimeout(i)},[p,o,j,f,t==null?void 0:t.id]);const D=async s=>{try{await S.mutateAsync({friendId:parseInt(s)}),R.mutate({userId:s,type:"friend_request",title:"New Friend Request",message:`${(t==null?void 0:t.firstName)||(t==null?void 0:t.email)||"A user"} sent you a friend request.`}),I(""),C([]),B(null)}catch{}},Q=async s=>{try{await A.mutateAsync({friendId:parseInt(s)}),R.mutate({userId:s,type:"friend_accept",title:"Friend Request Accepted",message:`${(t==null?void 0:t.firstName)||(t==null?void 0:t.email)||"A user"} accepted your friend request!`})}catch{}},F=async s=>{try{await w.mutateAsync({friendId:parseInt(s)})}catch{}};return e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col gap-6",children:[e.jsxs(k,{className:"p-6 mb-4 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(T,{className:"w-8 h-8 text-civic-blue"}),e.jsx("div",{className:"font-bold text-2xl text-civic-blue",children:"Add Friends"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex gap-2 mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-10 pr-4 py-2 border rounded-lg bg-background focus:ring-2 focus:ring-civic-blue",placeholder:"Search users by name or email...",value:p,onChange:s=>I(s.target.value),disabled:S.isPending})]})}),p.length>=2&&e.jsx("div",{className:"absolute z-10 w-full bg-white dark:bg-slate-800 border rounded-lg shadow-lg max-h-60 overflow-y-auto",children:X?e.jsxs("div",{className:"p-4 text-center",children:[e.jsx(Y,{className:"w-4 h-4 animate-spin mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Searching..."})]}):E?e.jsx("div",{className:"p-4 text-center text-red-500",children:e.jsx("p",{className:"text-sm",children:E})}):$.length>0?e.jsx("div",{className:"py-2",children:$.map(s=>{var i,r;return e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-civic-blue rounded-full flex items-center justify-center text-white font-bold",children:[(i=s.firstName)==null?void 0:i[0],(r=s.lastName)==null?void 0:r[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),s.civicPoints&&e.jsxs("p",{className:"text-xs text-civic-gold",children:["Civic Points: ",s.civicPoints]})]})]}),e.jsxs(y,{size:"sm",onClick:()=>D(s.id),disabled:S.isPending,className:"bg-civic-blue hover:bg-civic-gold",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Add Friend"]})]},s.id)})}):e.jsx("div",{className:"p-4 text-center text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No users found"})})})]})]}),f.length>0&&e.jsxs(k,{className:"p-6 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(ie,{className:"w-6 h-6 text-green-600"}),e.jsxs("h3",{className:"font-bold text-xl text-green-600",children:["Friend Requests (",f.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:f.map(s=>{var i,r,n,m,d,x,h,g,u,c,b,v;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold",children:((r=(i=s.user)==null?void 0:i.firstName)==null?void 0:r[0])||((m=(n=s.user)==null?void 0:n.lastName)==null?void 0:m[0])||((x=(d=s.user)==null?void 0:d.email)==null?void 0:x[0])||"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(h=s.user)!=null&&h.firstName&&((g=s.user)!=null&&g.lastName)?`${s.user.firstName} ${s.user.lastName}`:((u=s.user)==null?void 0:u.firstName)||((c=s.user)==null?void 0:c.lastName)||((b=s.user)==null?void 0:b.email)||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-500",children:((v=s.user)==null?void 0:v.email)||"No email"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{size:"sm",onClick:()=>Q(s.userId),disabled:A.isPending,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),"Accept"]}),e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>F(s.userId),disabled:w.isPending,children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Decline"]})]})]},s.id)})})]}),j.length>0&&e.jsxs(k,{className:"p-6 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(O,{className:"w-6 h-6 text-yellow-600"}),e.jsxs("h3",{className:"font-bold text-xl text-yellow-600",children:["Pending Requests (",j.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:j.map(s=>{var i,r,n,m,d,x,h,g,u,c,b,v;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-600 rounded-full flex items-center justify-center text-white font-bold",children:((r=(i=s.friend)==null?void 0:i.firstName)==null?void 0:r[0])||((m=(n=s.friend)==null?void 0:n.lastName)==null?void 0:m[0])||((x=(d=s.friend)==null?void 0:d.email)==null?void 0:x[0])||"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(h=s.friend)!=null&&h.firstName&&((g=s.friend)!=null&&g.lastName)?`${s.friend.firstName} ${s.friend.lastName}`:((u=s.friend)==null?void 0:u.firstName)||((c=s.friend)==null?void 0:c.lastName)||((b=s.friend)==null?void 0:b.email)||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-500",children:((v=s.friend)==null?void 0:v.email)||"No email"})]})]}),e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>F(s.friendId),disabled:w.isPending,children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Cancel"]})]},s.id)})})]}),e.jsxs(k,{className:"p-6 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(J,{className:"w-6 h-6 text-civic-blue"}),e.jsxs("h3",{className:"font-bold text-xl text-civic-blue",children:["My Friends (",o.length,")"]})]}),o.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(J,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No friends yet. Start by searching for users above!"})]}):e.jsx("div",{className:"grid gap-3",children:o.map(s=>{var i,r,n;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-civic-blue rounded-full flex items-center justify-center text-white font-bold",children:((i=s.firstName)==null?void 0:i[0])||((r=s.lastName)==null?void 0:r[0])||((n=s.email)==null?void 0:n[0])||"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.firstName||s.lastName||s.email||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email||"No email"}),s.civicPoints&&e.jsxs("p",{className:"text-xs text-civic-gold",children:["Civic Points: ",s.civicPoints]})]})]}),e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>F(s.id),disabled:w.isPending,className:"text-red-600 hover:text-red-700",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Remove"]})]},s.id)})})]})]})}export{ge as default};
