import{j as e}from"./ui-B-8yHimL.js";import{r as i}from"./vendor-DRd396Ms.js";import{r as se,q as ae,E as te,s as le,h as d,B as c,D as ie,P as oe,a as ne,b as re,d as de,e as ce,I as Q,Q as me,x as ue}from"./index-BY2F1QlS.js";import{u as xe,a as he,b as fe,c as be,d as ge,e as pe}from"./useCivicSocial-BiYXzICp.js";import{S as l,C as je}from"./civicsocial-feed-Ch7ptxWq.js";import{T as Ne,a as ve,b as N,c as v}from"./tabs-OJtZGcP-.js";import{I as we}from"./image-BijOhfh0.js";import"./trash-2-Cyd3jhQZ.js";function ke(){var B;const{user:s,isLoading:z,isAuthenticated:f}=se(),{data:I,isLoading:O,error:ye}=xe(),{data:w}=he(),r=fe(),D=be(),F=ge();pe();const[b,T]=i.useState(""),[L,k]=i.useState({}),[g,A]=i.useState({}),[y,C]=i.useState(null),[S,P]=i.useState(null),[M,m]=i.useState(!1),[U,Y]=i.useState((s==null?void 0:s.firstName)||""),[K,H]=i.useState((s==null?void 0:s.lastName)||""),[R,W]=i.useState((s==null?void 0:s.bio)||""),[$,Ce]=i.useState((s==null?void 0:s.profileImageUrl)||"");i.useRef(null);const{toast:n}=ae(),p=te(),q=(w==null?void 0:w.friends)||[],[V,u]=i.useState("posts"),E=le({mutationFn:async a=>ue("/api/users/profile","PUT",a),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/auth/user"]}),m(!1),n({title:"Profile updated!",description:"Your changes have been saved."})}}),j=I?I.filter(a=>String(a.userId)===String(s==null?void 0:s.id)):[],x=s&&((s.firstName||"")+(s.lastName?" "+s.lastName:"")||s.email)||"Anonymous",G=a=>{var o;const t=(o=a.target.files)==null?void 0:o[0];t&&(C(t),P(URL.createObjectURL(t)))},J=async a=>{if(a.preventDefault(),!b.trim()&&!y)return;let t=null;y&&(t=S),r.mutate({content:b,userId:s==null?void 0:s.id,displayName:x,imageUrl:t},{onSuccess:()=>{n({title:"Post created!",description:"Your post was added to your wall."}),p.invalidateQueries({queryKey:["civicSocialFeed"]})},onError:o=>{n({title:"Error posting",description:o.message||"Failed to post.",variant:"destructive"})}}),T(""),C(null),P(null)},X=a=>{var t;(t=g[a])!=null&&t.trim()&&F.mutate({postId:a,content:g[a],userId:s==null?void 0:s.id,displayName:x},{onSuccess:()=>{A({...g,[a]:""}),k({...L,[a]:!1}),p.invalidateQueries({queryKey:["civicSocialFeed"]})},onError:o=>{n({title:"Error commenting",description:o.message||"Failed to comment.",variant:"destructive"})}})};function Z(a){if(!a.reactions)return null;for(const t in a.reactions)if(a.reactions[t].includes(s==null?void 0:s.id))return t;return null}const _=(a,t)=>{Z(a)===t?D.mutate({postId:a.id,reaction:t}):D.mutate({postId:a.id,reaction:t})},ee=async a=>{if(window.confirm("Are you sure you want to delete this post?"))try{await fetch(`/api/social/posts/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("civicos-jwt")}`}}),n({title:"Post deleted",description:"Your post was removed."}),p.invalidateQueries({queryKey:["civicSocialFeed"]})}catch{n({title:"Error deleting post",description:"Failed to delete post.",variant:"destructive"})}};function h(a){return t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),a())}}return z||O?e.jsxs("div",{className:"w-full max-w-3xl mx-auto flex flex-col gap-6",children:[e.jsxs("div",{className:"relative w-full h-56 md:h-64 bg-gradient-to-r from-blue-600 to-purple-700 rounded-b-3xl shadow-lg overflow-hidden mb-8",children:[e.jsx(l,{className:"absolute inset-0 w-full h-full"}),e.jsxs("div",{className:"absolute left-1/2 bottom-0 transform -translate-x-1/2 translate-y-1/2 flex flex-col items-center",children:[e.jsx(l,{className:"w-32 h-32 rounded-full border-4 border-white shadow-xl bg-white"}),e.jsxs("div",{className:"mt-4 flex flex-col items-center",children:[e.jsx(l,{className:"h-8 w-48 rounded mb-2"}),e.jsx(l,{className:"h-5 w-32 rounded mb-1"}),e.jsx(l,{className:"h-5 w-64 rounded mb-2"}),e.jsx(l,{className:"h-8 w-32 rounded"})]})]})]}),e.jsxs("div",{className:"flex w-full justify-center gap-2 bg-white rounded-xl shadow mb-6",children:[e.jsx(l,{className:"h-10 w-24 rounded-full"}),e.jsx(l,{className:"h-10 w-24 rounded-full"}),e.jsx(l,{className:"h-10 w-24 rounded-full"}),e.jsx(l,{className:"h-10 w-24 rounded-full"})]}),e.jsxs(d,{className:"p-4 mb-4 flex items-start gap-3 bg-white shadow-lg rounded-xl border border-gray-200 fade-in-up",children:[e.jsx(l,{className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx(l,{className:"h-10 w-full rounded-lg mb-2"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{className:"h-8 w-20 rounded-full"}),e.jsx(l,{className:"h-8 w-20 rounded-full"})]})]})]}),[1,2,3].map(a=>e.jsxs(d,{className:"p-4 flex items-start gap-3 bg-white shadow-lg rounded-xl border border-gray-200 fade-in-up",children:[e.jsx(l,{className:"w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx(l,{className:"h-6 w-1/2 rounded"}),e.jsx(l,{className:"h-4 w-1/3 rounded"}),e.jsx(l,{className:"h-10 w-full rounded-lg mt-2"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(l,{className:"h-8 w-16 rounded-full"}),e.jsx(l,{className:"h-8 w-16 rounded-full"}),e.jsx(l,{className:"h-8 w-16 rounded-full"})]})]})]},a))]}):s?e.jsxs("div",{className:"w-full max-w-3xl mx-auto flex flex-col gap-6",children:[e.jsxs("div",{className:"relative w-full h-56 md:h-64 bg-gradient-to-r from-blue-600 to-purple-700 rounded-b-3xl shadow-lg overflow-hidden mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500 via-blue-700 to-purple-700 opacity-90"}),e.jsxs("div",{className:"absolute left-1/2 bottom-0 transform -translate-x-1/2 translate-y-1/2 flex flex-col items-center",children:[e.jsx("div",{className:"w-32 h-32 rounded-full border-4 border-white shadow-xl bg-white overflow-hidden",children:s!=null&&s.profileImageUrl?e.jsx("img",{src:s==null?void 0:s.profileImageUrl,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-5xl font-bold bg-blue-600 text-white",children:x[0]})}),e.jsxs("div",{className:"mt-4 flex flex-col items-center",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900",children:x}),e.jsxs("p",{className:"text-base md:text-lg text-gray-600",children:["@",(B=s==null?void 0:s.email)==null?void 0:B.split("@")[0]]}),e.jsx("p",{className:"text-base text-gray-700 mt-1",children:(s==null?void 0:s.bio)||"No bio available."}),e.jsx(c,{size:"sm",variant:"outline",className:"mt-2 focus:ring-2 focus:ring-blue-400",onClick:()=>m(!0),onKeyDown:h(()=>m(!0)),"aria-label":"Edit Profile",tabIndex:0,children:"Edit Profile"})]})]})]}),e.jsxs(Ne,{value:V,onValueChange:u,className:"w-full",children:[e.jsxs(ve,{className:"flex w-full justify-center gap-2 bg-white rounded-xl shadow mb-6",children:[e.jsx(N,{value:"posts",className:"px-6 py-2 font-semibold focus:ring-2 focus:ring-blue-400",tabIndex:0,"aria-label":"Posts",onKeyDown:h(()=>u("posts")),children:"Posts"}),e.jsx(N,{value:"about",className:"px-6 py-2 font-semibold focus:ring-2 focus:ring-blue-400",tabIndex:0,"aria-label":"About",onKeyDown:h(()=>u("about")),children:"About"}),e.jsx(N,{value:"friends",className:"px-6 py-2 font-semibold focus:ring-2 focus:ring-blue-400",tabIndex:0,"aria-label":"Friends",onKeyDown:h(()=>u("friends")),children:"Friends"}),e.jsx(N,{value:"photos",className:"px-6 py-2 font-semibold focus:ring-2 focus:ring-blue-400",tabIndex:0,"aria-label":"Photos",onKeyDown:h(()=>u("photos")),children:"Photos"})]}),e.jsxs(v,{value:"posts",children:[e.jsxs(d,{className:"p-4 mb-4 flex items-start gap-3 bg-white shadow-lg rounded-xl border border-gray-200 fade-in-up",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center font-bold text-2xl text-white shadow-md",children:x[0]}),e.jsxs("form",{className:"flex-1 flex flex-col gap-2",onSubmit:J,"aria-label":"Post composer",children:[e.jsx("textarea",{className:"flex-1 border rounded-lg px-3 py-2 bg-gray-50 resize-none text-base focus:ring-2 focus:ring-blue-500",placeholder:f?"What's on your mind?":"Login to post",value:b,onChange:a=>T(a.target.value),disabled:r.isPending||!f,"aria-label":"Post content",rows:2,maxLength:500,style:{minHeight:48}}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("label",{className:"cursor-pointer flex items-center gap-1 text-blue-600 hover:text-blue-800 transition-colors",children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("input",{type:"file",accept:"image/*",onChange:G,disabled:r.isPending||!f,"aria-label":"Upload image",className:"hidden"}),e.jsx("span",{className:"text-xs",children:"Image"})]}),S&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:S,alt:"Preview",className:"w-16 h-16 object-cover rounded border"}),e.jsx(c,{type:"button",size:"sm",variant:"outline",onClick:()=>{C(null),P(null)},children:"Remove"})]}),e.jsx(c,{type:"submit",disabled:!b.trim()&&!y||r.isPending||!f,"aria-label":"Submit post",className:"ml-auto px-6 py-2 rounded-lg bg-blue-600 text-white font-bold hover:bg-blue-700 transition-colors",children:r.isPending?"Posting...":"Post"})]}),r.error&&e.jsx("div",{className:"text-xs text-red-500 mt-2",role:"alert",children:"Error posting. Try again."})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[j&&j.length===0&&e.jsx("div",{className:"text-muted-foreground",children:"No posts yet."}),j&&j.map(a=>e.jsx(je,{post:a,user:s,onReact:_,onComment:X,onDelete:ee,openComment:L,setOpenComment:k,commentText:g,setCommentText:A,commentMutation:F,toast:n,showWallLink:!1},a.id))]})]}),e.jsx(v,{value:"about",children:e.jsxs(d,{className:"p-6 bg-white shadow rounded-xl border border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"About"}),e.jsx("p",{className:"text-gray-700",children:(s==null?void 0:s.bio)||"No bio available."}),e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"block text-sm text-gray-500",children:"Email:"}),e.jsx("span",{className:"block text-base font-medium text-gray-800",children:s==null?void 0:s.email})]})]})}),e.jsx(v,{value:"friends",children:e.jsxs(d,{className:"p-6 bg-white shadow rounded-xl border border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Friends"}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-2",children:[q.length===0&&e.jsx("span",{className:"text-gray-500",children:"No friends yet."}),q.map(a=>{var t,o;return e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 rounded-lg px-3 py-2 border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold",children:((t=a.firstName)==null?void 0:t[0])||((o=a.email)==null?void 0:o[0])||"U"}),e.jsx("span",{className:"font-medium text-sm",children:a.firstName||a.email})]},a.id)})]})]})}),e.jsx(v,{value:"photos",children:e.jsxs(d,{className:"p-6 bg-white shadow rounded-xl border border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Photos"}),e.jsx("span",{className:"text-gray-500",children:"No photos yet."})]})})]}),e.jsxs(ie,{open:M,onOpenChange:m,children:[e.jsx(oe,{asChild:!0,children:e.jsx(c,{size:"sm",variant:"outline",className:"text-blue-700 bg-white/80 hover:bg-white",children:"Edit Profile"})}),e.jsxs(ne,{className:"max-w-md",children:[e.jsxs(re,{children:[e.jsx(de,{children:"Edit Profile"}),e.jsx(ce,{children:"Update your display name and bio for CivicSocial."})]}),e.jsxs("form",{className:"flex flex-col gap-4",onSubmit:a=>{a.preventDefault(),E.mutate({firstName:U,lastName:K,bio:R,profileImageUrl:$})},children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",htmlFor:"edit-name",children:"First Name"}),e.jsx(Q,{id:"edit-name",value:U,onChange:a=>Y(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",htmlFor:"edit-lastname",children:"Last Name"}),e.jsx(Q,{id:"edit-lastname",value:K,onChange:a=>H(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",htmlFor:"edit-bio",children:"Bio"}),e.jsx(me,{id:"edit-bio",value:R,onChange:a=>W(a.target.value),rows:3})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(c,{type:"submit",disabled:E.isPending,children:E.isPending?"Saving...":"Save"})]})]})]})]})]}):e.jsx("div",{className:"text-center text-muted-foreground",children:"Login to view your profile."})}export{ke as default};
