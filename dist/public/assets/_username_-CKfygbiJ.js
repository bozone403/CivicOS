import{j as e}from"./ui-CDUWW_Ri.js";import{r as m}from"./vendor-1XCZ5AD1.js";import{q as Y,p as X,E as ie,r as le,y as v,g as n,j as c,R as E,B as P,X as I,Y as R,Z as K,$ as ne,v as M,M as Z,a0 as ce,a1 as oe,a2 as me,a3 as de,K as U,s as xe,a4 as J,a5 as ue,Q as he}from"./index-3pYdAjS7.js";import{T as ge,a as pe,b as k,c as D}from"./tabs-CiDaGwxW.js";import{T as je}from"./tag-MSOjQ6k3.js";import{S as Ne}from"./star-BOJG9t85.js";import{C as ve}from"./calendar-Bypruxjw.js";import{A as W}from"./award-B5AQteRG.js";function fe({onPostCreated:i,placeholder:d="What's on your mind?",showLocation:C=!0,showMood:S=!0,showTags:T=!0,showVisibility:s=!0,showImageUpload:L=!0,className:o="",autoFocus:$=!1}){var G,H;const{user:l}=Y(),{toast:u}=X(),j=ie(),[h,g]=m.useState(""),[N,a]=m.useState("public"),[x,f]=m.useState(""),[O,Q]=m.useState(""),[p,A]=m.useState([]),[y,F]=m.useState(null),[z,q]=m.useState(null),[V,B]=m.useState(!1),_=le({mutationFn:async t=>v("/api/social/posts","POST",t),onSuccess:()=>{u({title:"Post created!",description:"Your post has been shared to your profile and the feed."}),j.invalidateQueries({queryKey:["social-posts"]}),j.invalidateQueries({queryKey:["user-posts"]}),ee(),i==null||i()},onError:t=>{u({title:"Post failed",description:t.message||"Failed to create post. Please try again.",variant:"destructive"})}}),ee=()=>{g(""),a("public"),f(""),Q(""),A([]),F(null),q(null)},se=t=>{var b;const r=(b=t.target.files)==null?void 0:b[0];r&&(F(r),q(URL.createObjectURL(r)))},ae=async t=>{if(t.preventDefault(),!h.trim()&&!y){u({title:"Content required",description:"Please enter some content or upload an image.",variant:"destructive"});return}if(!l){u({title:"Login required",description:"Please log in to create posts.",variant:"destructive"});return}B(!0);try{let r=null;if(y){const w=new FormData;w.append("image",y),r=(await v("/api/upload/image","POST",w)).imageUrl}const b={content:h.trim(),type:"post",visibility:N,imageUrl:r,location:x.trim()||void 0,mood:O.trim()||void 0,tags:p.filter(w=>w.trim())};_.mutate(b)}catch(r){console.error("Post creation error:",r),u({title:"Post failed",description:"Failed to create post. Please try again.",variant:"destructive"})}finally{B(!1)}},te=t=>{if(t.key==="Enter"||t.key===","){t.preventDefault();const r=t.currentTarget.value.trim();r&&!p.includes(r)&&(A([...p,r]),t.currentTarget.value="")}},re=t=>{A(p.filter(r=>r!==t))};return l?e.jsx(n,{className:`p-4 ${o}`,children:e.jsx(c,{className:"p-0",children:e.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(I,{className:"w-10 h-10",children:[e.jsx(R,{src:l.profileImageUrl}),e.jsx(K,{className:"bg-blue-600",children:((G=l.firstName)==null?void 0:G[0])||((H=l.email)==null?void 0:H[0])||"U"})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx(ne,{placeholder:d,value:h,onChange:t=>g(t.target.value),className:"min-h-[100px] resize-none border-0 focus:ring-0 p-0 text-base",autoFocus:$,maxLength:1e3}),z&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:z,alt:"Preview",className:"max-w-xs max-h-48 rounded-lg object-cover"}),e.jsx(P,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 w-6 h-6 p-0",onClick:()=>{F(null),q(null)},children:"×"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[T&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Add tags (press Enter or comma)",onKeyDown:te,className:"flex-1 text-sm border-0 focus:ring-0 p-0 bg-transparent"})]}),p.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map((t,r)=>e.jsxs(M,{variant:"secondary",className:"text-xs",children:["#",t,e.jsx("button",{type:"button",onClick:()=>re(t),className:"ml-1 hover:text-red-600",children:"×"})]},r))})]}),e.jsxs("div",{className:"flex gap-4",children:[C&&e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(Z,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Add location",value:x,onChange:t=>f(t.target.value),className:"flex-1 text-sm border-0 focus:ring-0 p-0 bg-transparent"})]}),S&&e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"How are you feeling?",value:O,onChange:t=>Q(t.target.value),className:"flex-1 text-sm border-0 focus:ring-0 p-0 bg-transparent"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[L&&e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(oe,{className:"w-5 h-5 text-gray-500 hover:text-blue-600"}),e.jsx("input",{type:"file",accept:"image/*",onChange:se,className:"hidden"})]}),s&&e.jsxs("select",{value:N,onChange:t=>a(t.target.value),className:"text-sm border-0 focus:ring-0 p-0 bg-transparent",children:[e.jsx("option",{value:"public",children:"Public"}),e.jsx("option",{value:"friends",children:"Friends"}),e.jsx("option",{value:"private",children:"Private"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[h.length,"/1000"]}),e.jsxs(P,{type:"submit",disabled:!h.trim()&&!y||V,size:"sm",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),V?"Posting...":"Post"]})]})]})]})]})})}):e.jsx(n,{className:`p-4 ${o}`,children:e.jsxs(c,{className:"text-center py-8",children:[e.jsx(E,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Login to Post"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Join the conversation by logging in to your CivicOS account."}),e.jsx(P,{onClick:()=>window.location.href="/auth",children:"Login to Post"})]})})}function Ae(){var N;const{username:i}=de(),{user:d}=Y(),{toast:C}=X(),[S,T]=m.useState("posts"),{data:s,isLoading:L}=U({queryKey:["user-profile",i],queryFn:async()=>(await v(`/api/users/profile/${i}`,"GET")).profile,enabled:!!i}),{data:o,isLoading:$}=U({queryKey:["user-posts",i],queryFn:async()=>(await v(`/api/social/posts/user/${i}`,"GET")).posts||[],enabled:!!i}),{data:l}=U({queryKey:["user-achievements",i],queryFn:async()=>(await v(`/api/users/${i}/achievements`,"GET")).achievements||[],enabled:!!i}),u=async()=>{const a=`${window.location.origin}/profile/${i}`,x=`Check out ${(s==null?void 0:s.firstName)||(s==null?void 0:s.username)}'s profile on CivicOS`;try{navigator.share?await navigator.share({title:`${(s==null?void 0:s.firstName)||(s==null?void 0:s.username)}'s Profile`,text:x,url:a}):(await navigator.clipboard.writeText(`${x} ${a}`),C({title:"Link copied!",description:"Profile link has been copied to your clipboard."}))}catch(f){console.error("Share error:",f)}},j=()=>s!=null&&s.firstName&&(s!=null&&s.lastName)?`${s.firstName} ${s.lastName}`:s!=null&&s.firstName?s.firstName:s!=null&&s.username?s.username:"Anonymous User",h=a=>{switch(a==null?void 0:a.toLowerCase()){case"champion":return"bg-purple-500";case"expert":return"bg-blue-500";case"advocate":return"bg-green-500";case"active":return"bg-yellow-500";default:return"bg-gray-500"}},g=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return L?e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading profile..."})]})}):s?e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx(n,{className:"mb-8",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs(I,{className:"w-24 h-24",children:[e.jsx(R,{src:s.profileImageUrl}),e.jsx(K,{className:"bg-blue-600 text-2xl",children:(N=j()[0])==null?void 0:N.toUpperCase()})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold",children:j()}),s.isVerified&&e.jsxs(M,{variant:"secondary",children:[e.jsx(Ne,{className:"w-3 h-3 mr-1"}),"Verified"]}),e.jsx(M,{className:`text-xs ${h(s.civicLevel||"")}`,children:s.civicLevel||"Registered"})]}),e.jsxs("p",{className:"text-gray-600",children:["@",s.username]}),s.bio&&e.jsx("p",{className:"text-gray-700 max-w-md",children:s.bio}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-4 h-4"}),s.location]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),"Joined ",g(s.joinDate)]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(P,{variant:"outline",size:"sm",onClick:u,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Share Profile"]})})]})})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx(n,{children:e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.postsCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"Posts"})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.followersCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"Followers"})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:s.followingCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"Following"})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:s.civicPoints}),e.jsx("div",{className:"text-sm text-gray-600",children:"Civic Points"})]})})]}),e.jsxs(ge,{value:S,onValueChange:T,children:[e.jsxs(pe,{className:"grid w-full grid-cols-3",children:[e.jsx(k,{value:"posts",children:"Posts"}),e.jsx(k,{value:"achievements",children:"Achievements"}),e.jsx(k,{value:"activity",children:"Activity"})]}),e.jsx(D,{value:"posts",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[(d==null?void 0:d.id)===s.id&&e.jsx(fe,{placeholder:`What's on your mind, ${s.firstName||s.username}?`,onPostCreated:()=>{window.location.reload()}}),$?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading posts..."})]}):(o==null?void 0:o.length)===0?e.jsx(n,{children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(E,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-gray-600",children:(d==null?void 0:d.id)===s.id?"Share your first post to get started!":`${s.firstName||s.username} hasn't posted anything yet.`})]})}):e.jsx("div",{className:"space-y-4",children:o==null?void 0:o.map(a=>{var x;return e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(I,{className:"w-10 h-10",children:[e.jsx(R,{src:a.user.profileImageUrl}),e.jsx(K,{className:"bg-blue-600",children:((x=a.user.firstName)==null?void 0:x[0])||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"font-semibold",children:[a.user.firstName," ",a.user.lastName]}),e.jsx("span",{className:"text-sm text-gray-500",children:g(a.createdAt)})]}),e.jsx("p",{className:"text-gray-800 mb-3",children:a.content}),a.imageUrl&&e.jsx("img",{src:a.imageUrl,alt:"Post",className:"rounded-lg max-w-full h-auto mb-3"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("button",{className:"flex items-center gap-1 hover:text-blue-600",children:[e.jsx(ue,{className:"w-4 h-4"}),a.likesCount||0]}),e.jsxs("button",{className:"flex items-center gap-1 hover:text-blue-600",children:[e.jsx(E,{className:"w-4 h-4"}),a.commentsCount||0]}),e.jsxs("button",{className:"flex items-center gap-1 hover:text-blue-600",children:[e.jsx(J,{className:"w-4 h-4"}),a.sharesCount||0]})]})]})]})})},a.id)})})]})}),e.jsx(D,{value:"achievements",className:"mt-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(l==null?void 0:l.length)===0?e.jsx(n,{className:"col-span-full",children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(W,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No achievements yet"}),e.jsx("p",{className:"text-gray-600",children:"Keep engaging with civic activities to earn achievements!"})]})}):l==null?void 0:l.map(a=>e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(W,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Earned ",g(a.earnedAt)]})]})]})})},a.id))})}),e.jsx(D,{value:"activity",className:"mt-6",children:e.jsx(n,{children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(he,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Activity Feed"}),e.jsx("p",{className:"text-gray-600",children:"Recent civic engagement activity will appear here."})]})})})]})]}):e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Profile Not Found"}),e.jsx("p",{className:"text-gray-600",children:"The user profile you're looking for doesn't exist."})]})})}export{Ae as default};
