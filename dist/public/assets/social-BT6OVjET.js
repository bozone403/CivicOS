import{j as e}from"./ui-CDUWW_Ri.js";import{r as c}from"./vendor-1XCZ5AD1.js";import{z as ue,q as he,p as pe,E as je,K as Q,r as x,y as d,g as u,j as h,X as f,Y as C,Z as b,$ as w,B as i,al as ge,ak as Ne,am as M,h as ve,au as O,a2 as Y,_ as ye,a4 as fe,D as H,a as W,b as B,c as G}from"./index-cZ55YovK.js";import{S as _}from"./square-pen-Cl_5Q3hM.js";import{T as J}from"./trash-2-DMeZkMWY.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=ue("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);function be(){var K,L,R;const{user:t,isAuthenticated:S}=he(),{toast:l}=pe(),o=je(),[p,k]=c.useState(""),[j,F]=c.useState(""),[a,X]=c.useState(null),[Z,g]=c.useState(!1),[V,P]=c.useState(!1),[we,I]=c.useState(null),[m,N]=c.useState(null),[r,E]=c.useState(null),[v,U]=c.useState(""),ee=c.useRef(null),{data:z=[],isLoading:se}=Q({queryKey:["civicSocialFeed"],queryFn:async()=>{const s=await d("/api/social/feed","GET");return(s==null?void 0:s.feed)||[]},enabled:S}),{data:ae=[]}=Q({queryKey:["/api/social/posts",a==null?void 0:a.id,"comments"],queryFn:async()=>{var n;const s=await d(`/api/social/posts/${a==null?void 0:a.id}`,"GET");return((n=s==null?void 0:s.post)==null?void 0:n.comments)||[]},enabled:!!a&&S}),$=x({mutationFn:async s=>d("/api/social/posts","POST",s),onSuccess:()=>{o.invalidateQueries({queryKey:["civicSocialFeed"]}),k(""),U(""),g(!1),l({title:"Post created!",description:"Your post has been shared successfully."})},onError:s=>{l({title:"Error creating post",description:s.message||"Failed to create post. Please try again.",variant:"destructive"})}});x({mutationFn:async({postId:s,data:n})=>d(`/api/social/posts/${s}`,"PUT",n),onSuccess:()=>{o.invalidateQueries({queryKey:["civicSocialFeed"]}),I(null),l({title:"Post updated!",description:"Your post has been updated successfully."})},onError:s=>{l({title:"Error updating post",description:s.message||"Failed to update post. Please try again.",variant:"destructive"})}});const te=x({mutationFn:async s=>d(`/api/social/posts/${s}`,"DELETE"),onSuccess:()=>{o.invalidateQueries({queryKey:["civicSocialFeed"]}),l({title:"Post deleted!",description:"Your post has been deleted successfully."})},onError:s=>{l({title:"Error deleting post",description:s.message||"Failed to delete post. Please try again.",variant:"destructive"})}}),ie=x({mutationFn:async({postId:s,content:n,parentCommentId:y})=>d(`/api/social/posts/${s}/comments`,"POST",{content:n,parentCommentId:y}),onSuccess:()=>{o.invalidateQueries({queryKey:["/api/social/posts",a==null?void 0:a.id,"comments"]}),F(""),E(null),l({title:"Comment posted!",description:"Your comment has been posted successfully."})},onError:s=>{l({title:"Error posting comment",description:s.message||"Failed to post comment. Please try again.",variant:"destructive"})}}),ne=x({mutationFn:async({commentId:s,content:n})=>d(`/api/social/comments/${s}`,"PUT",{content:n}),onSuccess:()=>{o.invalidateQueries({queryKey:["/api/social/posts",a==null?void 0:a.id,"comments"]}),N(null),l({title:"Comment updated!",description:"Your comment has been updated successfully."})},onError:s=>{l({title:"Error updating comment",description:s.message||"Failed to update comment. Please try again.",variant:"destructive"})}}),le=x({mutationFn:async s=>d(`/api/social/comments/${s}`,"DELETE"),onSuccess:()=>{o.invalidateQueries({queryKey:["/api/social/posts",a==null?void 0:a.id,"comments"]}),l({title:"Comment deleted!",description:"Your comment has been deleted successfully."})},onError:s=>{l({title:"Error deleting comment",description:s.message||"Failed to delete comment. Please try again.",variant:"destructive"})}}),re=x({mutationFn:async({postId:s,commentId:n})=>d("/api/social/like","POST",{postId:s,commentId:n}),onSuccess:()=>{o.invalidateQueries({queryKey:["civicSocialFeed"]}),a&&o.invalidateQueries({queryKey:["/api/social/posts",a.id,"comments"]})},onError:s=>{l({title:"Error",description:s.message||"Failed to like/unlike. Please try again.",variant:"destructive"})}}),q=()=>{if(!p.trim()&&!v.trim()){l({title:"Error",description:"Please enter some content or an image URL.",variant:"destructive"});return}$.mutate({content:p,imageUrl:v||void 0})},ce=s=>{confirm("Are you sure you want to delete this post?")&&te.mutate(s)},de=()=>{!a||!j.trim()||ie.mutate({postId:a.id,content:j,parentCommentId:r==null?void 0:r.id})},oe=s=>{m&&ne.mutate({commentId:s.id,content:m.content})},me=s=>{confirm("Are you sure you want to delete this comment?")&&le.mutate(s)},D=(s,n)=>{re.mutate({postId:s,commentId:n})},T=s=>s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.userId,A=s=>s.firstName&&s.lastName?`${s.firstName[0]}${s.lastName[0]}`:s.userId.substring(0,2).toUpperCase();return S?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"CivicSocial Feed"}),e.jsx("p",{className:"text-gray-600",children:"Share your thoughts and engage with the community"})]}),e.jsx(u,{className:"mb-6",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs(f,{className:"h-10 w-10",children:[e.jsx(C,{src:t==null?void 0:t.profileImageUrl}),e.jsx(b,{children:((K=t==null?void 0:t.firstName)==null?void 0:K[0])||((L=t==null?void 0:t.lastName)==null?void 0:L[0])||((R=t==null?void 0:t.email)==null?void 0:R[0])||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(w,{placeholder:"What's on your mind?",value:p,onChange:s=>k(s.target.value),className:"min-h-[100px] resize-none",ref:ee}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>g(!0),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Add Image"]}),e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Emoji"]})]}),e.jsxs(i,{onClick:q,disabled:$.isPending||!p.trim()&&!v.trim(),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Post"]})]})]})]})})}),e.jsx("div",{className:"space-y-6",children:se?e.jsx("div",{className:"animate-pulse space-y-6",children:[...Array(3)].map((s,n)=>e.jsx(u,{children:e.jsxs(h,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})},n))}):z.length===0?e.jsx(u,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-gray-600",children:"Be the first to share something!"})]})})}):z.map(s=>e.jsxs(u,{children:[e.jsx(ve,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(f,{className:"h-10 w-10",children:[e.jsx(C,{src:s.profileImageUrl}),e.jsx(b,{children:A(s)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:T(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:O(new Date(s.createdAt),{addSuffix:!0})})]})]}),s.userId===(t==null?void 0:t.id)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>I(s),children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>ce(s.id),children:e.jsx(J,{className:"w-4 h-4"})})]})]})}),e.jsxs(h,{children:[s.content&&e.jsx("p",{className:"text-gray-900 mb-4",children:s.content}),s.imageUrl&&e.jsx("img",{src:s.imageUrl,alt:"Post image",className:"w-full h-64 object-cover rounded-lg mb-4"}),s.type==="share"&&s.comment&&e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:e.jsx("p",{className:"text-sm text-gray-600",children:s.comment})}),e.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>D(s.id),className:s.isLiked?"text-red-500":"",children:[e.jsx(Y,{className:`w-4 h-4 mr-2 ${s.isLiked?"fill-current":""}`}),s.likeCount]}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>{X(s),P(!0)},children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),s.commentCount]}),e.jsxs(i,{variant:"ghost",size:"sm",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Share"]})]})})]})]},s.id))}),e.jsx(H,{open:Z,onOpenChange:g,children:e.jsxs(W,{children:[e.jsx(B,{children:e.jsx(G,{children:"Create Post"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{placeholder:"What's on your mind?",value:p,onChange:s=>k(s.target.value),className:"min-h-[120px]"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Image URL (optional)"}),e.jsx("input",{type:"url",placeholder:"https://example.com/image.jpg",value:v,onChange:s=>U(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(i,{onClick:q,children:"Post"})]})]})]})}),e.jsx(H,{open:V,onOpenChange:P,children:e.jsxs(W,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(B,{children:e.jsx(G,{children:"Comments"})}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsxs(f,{className:"h-8 w-8",children:[e.jsx(C,{src:a.profileImageUrl}),e.jsx(b,{children:A(a)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:T(a)}),e.jsx("p",{className:"text-xs text-gray-500",children:O(new Date(a.createdAt),{addSuffix:!0})})]})]}),a.content&&e.jsx("p",{className:"text-sm",children:a.content})]})}),e.jsx("div",{className:"space-y-4",children:ae.map(s=>{var n,y;return e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(f,{className:"h-8 w-8 flex-shrink-0",children:[e.jsx(C,{src:s.profileImageUrl}),e.jsxs(b,{children:[(n=s.firstName)==null?void 0:n[0],(y=s.lastName)==null?void 0:y[0]]})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-medium text-sm",children:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.userId}),s.userId===(t==null?void 0:t.id)&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>N(s),children:e.jsx(_,{className:"w-3 h-3"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>me(s.id),children:e.jsx(J,{className:"w-3 h-3"})})]})]}),(m==null?void 0:m.id)===s.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{value:m.content,onChange:xe=>N({...m,content:xe.target.value}),className:"min-h-[80px]"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(i,{size:"sm",onClick:()=>oe(s),children:"Save"}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>N(null),children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>D(void 0,s.id),className:s.isLiked?"text-red-500":"",children:[e.jsx(Y,{className:`w-3 h-3 mr-1 ${s.isLiked?"fill-current":""}`}),s.likeCount]}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>E(s),children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),"Reply"]})]})]})]})})]},s.id)})}),e.jsxs("div",{className:"space-y-2",children:[r&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-600",children:["Replying to ",r.firstName&&r.lastName?`${r.firstName} ${r.lastName}`:r.userId]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>E(null),children:"Cancel reply"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(w,{placeholder:r?"Write a reply...":"Write a comment...",value:j,onChange:s=>F(s.target.value),className:"flex-1"}),e.jsx(i,{onClick:de,disabled:!j.trim(),children:e.jsx(M,{className:"w-4 h-4"})})]})]})]})]})})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(u,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Sign in to view the social feed"}),e.jsx("p",{className:"text-gray-600",children:"Join the conversation and connect with other citizens."})]})})})})}function Ie(){return e.jsx(be,{})}export{Ie as default};
