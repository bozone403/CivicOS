import{j as e}from"./ui-CDUWW_Ri.js";import{r as q}from"./vendor-1XCZ5AD1.js";import{z as V,q as B,u as G,p as H,E as Q,K as v,r as z,B as n,v as j,R as p,D as Z,a0 as S,a as W,b as X,c as _,d as J,$ as ee,g as y,h as b,i as w,U as E,j as C,a1 as se,n as A,V as ae,F as te,X as ie,Y as le,Z as ne,a2 as ce,_ as re,y as P}from"./index-Dsnt0_JB.js";import{P as g}from"./progress-BwVk94eC.js";import{P as oe}from"./plus-h12k8rwV.js";import{T as de}from"./trophy-E4M9a0v1.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=V("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);function ue(){var I,L,T;const{user:i,isAuthenticated:r}=B(),[U,N]=G(),{toast:d}=H(),M=Q(),k=U.split("/"),m=k[k.length-1],l=!m||m==="profile"||m===(i==null?void 0:i.id),c=l?i==null?void 0:i.id:m,{data:Y,isLoading:$}=v({queryKey:["user-profile",c],queryFn:async()=>l?i:await P(`/api/social/users/${c}`,"GET"),enabled:!!c}),s=Y||i,[K,x]=q.useState(!1),[h,D]=q.useState(""),{data:u,isLoading:O}=v({queryKey:["user-posts",c],queryFn:async()=>(await P(`/api/social/posts?userId=${c}`,"GET")).posts||[],enabled:!!c}),f=z({mutationFn:async t=>{if(!r||!i)throw new Error("Please log in to create posts");console.log("Sending post request with token:",localStorage.getItem("civicos-jwt")?"exists":"missing");const o=await P("/api/social/posts","POST",{content:t,type:"post",visibility:"public",tags:[]});return console.log("Post response:",o),o},onSuccess:t=>{console.log("Post created successfully:",t),D(""),x(!1),M.invalidateQueries({queryKey:["user-posts",c]}),d({title:"Post created!",description:"Your post has been shared with the community."})},onError:t=>{console.error("Post creation error:",t),console.error("Error details:",{message:t.message,stack:t.stack,isAuthenticated:r,rawUser:i==null?void 0:i.id,token:localStorage.getItem("civicos-jwt")?"exists":"missing"}),d({title:"Failed to create post",description:t.message||"Please check your connection and try again.",variant:"destructive"})}}),R=()=>{if(!h.trim()){d({title:"Empty post",description:"Please write something to share.",variant:"destructive"});return}console.log("Creating post with:",{isAuthenticated:r,rawUser:i==null?void 0:i.id,content:h,token:localStorage.getItem("civicos-jwt")?"exists":"missing"}),f.mutate(h)};if($)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Loading profile..."}),e.jsx("p",{className:"text-gray-600",children:"Fetching user information..."})]})});if(!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"User not found"}),e.jsx("p",{className:"text-gray-600",children:"The user you're looking for doesn't exist or has been removed."}),e.jsx(n,{onClick:()=>N("/dashboard"),className:"mt-4",children:"Go to Dashboard"})]})});const{data:a}=v({queryKey:["/api/user/stats"]});return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden mb-8",children:[e.jsx("div",{className:"h-48 bg-gradient-to-r from-blue-600 via-purple-600 to-blue-800 relative",children:e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-20"})}),e.jsx("div",{className:"relative px-6 pb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-end space-y-4 sm:space-y-0 sm:space-x-6",children:[e.jsx("div",{className:"relative -mt-16",children:e.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-4xl font-bold border-4 border-white shadow-lg",children:s!=null&&s.profileImageUrl?e.jsx("img",{src:s.profileImageUrl,alt:"Profile",className:"w-full h-full rounded-full object-cover"}):((I=s==null?void 0:s.firstName)==null?void 0:I[0])||((L=s==null?void 0:s.email)==null?void 0:L[0])||"U"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s!=null&&s.firstName&&(s!=null&&s.lastName)?`${s.firstName} ${s.lastName}`:((T=s==null?void 0:s.email)==null?void 0:T.split("@")[0])||"User"}),e.jsxs(j,{variant:"outline",className:"text-xs",children:["ID: ",s==null?void 0:s.id]}),r?e.jsx(j,{className:"bg-green-100 text-green-800",children:"✓ Logged In"}):e.jsx(j,{variant:"destructive",children:"⚠ Not Logged In"})]}),e.jsx("p",{className:"text-gray-600 mb-2",children:s==null?void 0:s.email}),e.jsx("p",{className:"text-gray-700",children:(s==null?void 0:s.bio)||"No bio yet. Visit settings to add one!"})]}),e.jsxs("div",{className:"flex gap-2",children:[l&&e.jsx(e.Fragment,{children:r?e.jsxs(e.Fragment,{children:[e.jsxs(Z,{open:K,onOpenChange:x,children:[e.jsx(S,{asChild:!0,children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Create Post"]})}),e.jsxs(W,{className:"max-w-md",children:[e.jsxs(X,{children:[e.jsx(_,{children:"Create a Post"}),e.jsx(J,{children:"Share something with the CivicOS community"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(ee,{value:h,onChange:t=>D(t.target.value),placeholder:"What's on your mind?",rows:4})}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx(n,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(n,{onClick:R,disabled:f.isPending,children:f.isPending?"Posting...":"Post"})]})]})]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>{console.log("Auth Debug:",{isAuthenticated:r,rawUser:i==null?void 0:i.id,token:localStorage.getItem("civicos-jwt")?"exists":"missing"}),d({title:"Debug Info",description:"Check browser console for authentication details"})},children:"Debug Auth"})]}):e.jsxs(n,{variant:"outline",onClick:()=>N("/auth"),className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4"}),"Login to Post"]})}),e.jsx(n,{variant:"outline",onClick:()=>N("/settings"),children:"Settings"})]})]})})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 mb-8",children:[e.jsxs(y,{className:"bg-white shadow-sm",children:[e.jsx(b,{className:"pb-3",children:e.jsxs(w,{className:"text-lg flex items-center space-x-2",children:[e.jsx(E,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Profile Stats"})]})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Trust Score"}),e.jsxs(j,{variant:"secondary",children:[(a==null?void 0:a.trustScore)||"100.00","%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Civic Level"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(de,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"font-medium",children:(a==null?void 0:a.civicLevel)||1})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Civic Points"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(se,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:(a==null?void 0:a.civicPoints)||0})]})]})]})]}),e.jsxs(y,{className:"md:col-span-2",children:[e.jsxs(b,{children:[e.jsx(w,{children:"Civic Engagement"}),e.jsx(A,{children:"Your participation in democratic processes"})]}),e.jsx(C,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Votes Cast"})]}),e.jsx("span",{className:"font-medium",children:(a==null?void 0:a.voteCount)||0})]}),e.jsx(g,{value:((a==null?void 0:a.voteCount)||0)*10,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Discussions"})]}),e.jsx("span",{className:"font-medium",children:(a==null?void 0:a.discussionCount)||0})]}),e.jsx(g,{value:((a==null?void 0:a.discussionCount)||0)*5,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"h-4 w-4 text-purple-600"}),e.jsx("span",{className:"text-sm",children:"Petitions Signed"})]}),e.jsx("span",{className:"font-medium",children:(a==null?void 0:a.petitionCount)||0})]}),e.jsx(g,{value:((a==null?void 0:a.petitionCount)||0)*15,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"h-4 w-4 text-orange-600"}),e.jsx("span",{className:"text-sm",children:"Contacts Made"})]}),e.jsx("span",{className:"font-medium",children:(a==null?void 0:a.contactCount)||0})]}),e.jsx(g,{value:((a==null?void 0:a.contactCount)||0)*20,className:"h-2"})]})]})})]})]}),e.jsxs(y,{className:"bg-white shadow-sm",children:[e.jsxs(b,{children:[e.jsxs(w,{className:"flex items-center space-x-2",children:[e.jsx(p,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:l?"Your Posts":`${(s==null?void 0:s.firstName)||"User"}'s Posts`})]}),e.jsx(A,{children:l?"Your recent activity and posts":"Recent posts and activity"})]}),e.jsx(C,{children:O?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading posts..."})]}):u&&u.length>0?e.jsx("div",{className:"space-y-4",children:u.map(t=>{var o,F;return e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsxs(ie,{className:"h-10 w-10",children:[e.jsx(le,{src:t.user.profileImageUrl}),e.jsx(ne,{children:((o=t.user.firstName)==null?void 0:o[0])||((F=t.user.lastName)==null?void 0:F[0])||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsxs("span",{className:"font-semibold",children:[t.user.firstName," ",t.user.lastName]}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-gray-700 mb-3",children:t.content}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{children:t.likes})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:t.comments})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:t.shares})]})]})]})]})},t.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(p,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:l?"No posts yet":"No posts found"}),e.jsx("p",{className:"text-gray-600",children:l?"Start sharing your civic thoughts with the community!":"This user hasn't posted anything yet."}),l&&e.jsx(n,{onClick:()=>x(!0),className:"mt-4",children:"Create Your First Post"})]})})]})]})})}export{ue as default};
