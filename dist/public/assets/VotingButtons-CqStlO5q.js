import{j as s}from"./ui-B-8yHimL.js";import{q,p as S,y as V,G as Q,r as $,w as K,x as d,B as y}from"./index-BOKJ3jPl.js";import{T as P,a as B}from"./thumbs-up-CGJX5h12.js";function k({targetType:o,targetId:r,className:w="",size:c="md",showCounts:u=!0}){const{user:j}=q(),{toast:m}=S(),a=V(),{data:e,isLoading:v}=Q({queryKey:[`/api/vote/${o}/${r}`],enabled:!!r}),x=$({mutationFn:async t=>await(await K("/api/vote","POST",{targetType:o,targetId:r,voteType:t})).json(),onSuccess:t=>{a.setQueryData([`/api/vote/${o}/${r}`],t),a.invalidateQueries({queryKey:[`/api/${o}s`]}),a.invalidateQueries({queryKey:["/api/forum/posts"]}),a.invalidateQueries({queryKey:["/api/politicians"]}),a.invalidateQueries({queryKey:["/api/bills"]})},onError:t=>{console.error("Voting error:",t);let n="Failed to register vote";if(t.message){if(t.message.includes("already voted")){m({title:"Already Voted",description:"You have already voted on this item. Each user can only vote once.",variant:"default"});return}const p=t.message.match(/400: (.+)/);if(p)try{n=JSON.parse(p[1]).message||n}catch{n=p[1]}else n=t.message}m({title:"Vote Failed",description:n,variant:"destructive"})}}),h=t=>{if(!j){m({title:"Login Required",description:"Please log in to vote",variant:"destructive"});return}x.mutate(t)},b=(e==null?void 0:e.upvotes)||0,N=(e==null?void 0:e.downvotes)||0,i=(e==null?void 0:e.totalScore)||0,l=e==null?void 0:e.userVote,f={sm:"h-7 w-7",md:"h-8 w-8",lg:"h-10 w-10"},g={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"};return s.jsxs("div",{className:d("flex items-center space-x-2",w),children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(y,{variant:l==="upvote"?"default":"outline",size:"sm",className:d(f[c],"p-0",l==="upvote"&&"bg-green-600 hover:bg-green-700 text-white"),onClick:()=>h("upvote"),disabled:x.isPending||v,children:s.jsx(P,{className:g[c]})}),u&&s.jsx("span",{className:"text-sm font-medium text-green-600 min-w-[20px] text-center",children:b})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(y,{variant:l==="downvote"?"default":"outline",size:"sm",className:d(f[c],"p-0",l==="downvote"&&"bg-red-600 hover:bg-red-700 text-white"),onClick:()=>h("downvote"),disabled:x.isPending||v,children:s.jsx(B,{className:g[c]})}),u&&s.jsx("span",{className:"text-sm font-medium text-red-600 min-w-[20px] text-center",children:N})]}),u&&s.jsxs("div",{className:"flex items-center space-x-1 ml-2 pl-2 border-l",children:[s.jsx("span",{className:"text-xs text-muted-foreground",children:"Score:"}),s.jsx("span",{className:d("text-sm font-bold",i>0&&"text-green-600",i<0&&"text-red-600",i===0&&"text-gray-500"),children:i>0?`+${i}`:i})]})]})}export{k as V};
