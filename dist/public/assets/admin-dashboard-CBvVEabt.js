import{r as Q,j as e}from"./ui-D2Re0T6U.js";import{q as U,z as M,p as B,K as F,r as n,g as m,h,i as x,O as E,n as u,j as p,aw as H,B as r,U as G,F as R,V,k as $,N as Z,C as k,G as s,T as J}from"./app-BXLB3SPJ.js";import{L as t}from"./loading-spinner-DuGVZWPZ.js";import{A as W,a as X}from"./alert-oKm3zNjc.js";import{R as T}from"./refresh-cw-Bfv1saLL.js";import{B as Y}from"./building-2-h7RuT195.js";import{T as _}from"./trending-up-DxR3cs5Y.js";import"./vendor-BtP0CW_r.js";function ce(){var C;const{user:q}=U(),a=M(),{toast:i}=B(),[P,S]=Q.useState(!1),{data:L,isLoading:D}=F({queryKey:["/api/admin/health"],queryFn:()=>s("/api/admin/health","GET"),refetchInterval:3e4}),{data:I,isLoading:O}=F({queryKey:["/api/admin/ingestion/status"],queryFn:()=>s("/api/admin/ingestion/status","GET"),refetchInterval:6e4}),d=n({mutationFn:async()=>(S(!0),await s("/api/admin/refresh/all","POST")),onSuccess:()=>{i({title:"Data Ingestion Complete",description:"All data sources have been refreshed successfully"}),a.invalidateQueries({queryKey:["/api/admin/health"]}),a.invalidateQueries({queryKey:["/api/admin/ingestion/status"]})},onError:l=>{i({title:"Ingestion Failed",description:l.message||"Failed to run comprehensive data ingestion",variant:"destructive"})},onSettled:()=>{S(!1)}}),g=n({mutationFn:()=>s("/api/admin/refresh/politicians","POST"),onSuccess:()=>{i({title:"Politicians refreshed!",description:"Politician data has been updated."}),a.invalidateQueries({queryKey:["/api/admin/health"]})}}),j=n({mutationFn:()=>s("/api/admin/refresh/parliament","POST"),onSuccess:()=>{i({title:"Bills refreshed!",description:"Bill and voting data has been updated."}),a.invalidateQueries({queryKey:["/api/admin/health"]})}}),f=n({mutationFn:()=>s("/api/admin/refresh/elections","POST"),onSuccess:()=>{i({title:"Elections refreshed!",description:"Election data has been updated."}),a.invalidateQueries({queryKey:["/api/admin/health"]})}}),v=n({mutationFn:()=>s("/api/admin/refresh/legal","POST"),onSuccess:()=>{i({title:"Legal data refreshed!",description:"Legal acts and cases have been updated."}),a.invalidateQueries({queryKey:["/api/admin/health"]})}}),N=n({mutationFn:()=>s("/api/admin/refresh/procurement","POST"),onSuccess:()=>{i({title:"Procurement refreshed!",description:"Procurement contract data has been updated."}),a.invalidateQueries({queryKey:["/api/admin/health"]})}}),y=n({mutationFn:()=>s("/api/admin/refresh/lobbyists","POST"),onSuccess:()=>{i({title:"Lobbyists refreshed!",description:"Lobbyist organization data has been updated."}),a.invalidateQueries({queryKey:["/api/admin/health"]})}}),b=n({mutationFn:()=>s("/api/admin/refresh/news","POST"),onSuccess:()=>{i({title:"News refreshed!",description:"News articles have been updated."}),a.invalidateQueries({queryKey:["/api/admin/health"]})}}),w=n({mutationFn:()=>s("/api/admin/refresh/petitions","POST"),onSuccess:()=>{i({title:"Petitions refreshed!",description:"Petition data has been updated."}),a.invalidateQueries({queryKey:["/api/admin/health"]})}});if(!q)return e.jsx("div",{className:"min-h-screen flex items-center justify-center text-gray-500",children:"Please log in to view the admin dashboard."});if(D||O)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(t,{size:"lg"})});const o=L||{users:0,government:{politicians:0,bills:0},content:{news:0},timestamp:new Date().toISOString()},z=I||{politicians:{success:!1,message:"Unknown",timestamp:""},bills:{success:!1,message:"Unknown",timestamp:""},elections:{success:!1,message:"Unknown",timestamp:""},legal:{success:!1,message:"Unknown",timestamp:""},procurement:{success:!1,message:"Unknown",timestamp:""},lobbyists:{success:!1,message:"Unknown",timestamp:""},news:{success:!1,message:"Unknown",timestamp:""},petitions:{success:!1,message:"Unknown",timestamp:""}},K=l=>l?e.jsx(k,{className:"h-4 w-4 text-green-600"}):e.jsx(J,{className:"h-4 w-4 text-red-600"}),A=l=>l?"text-green-600":"text-red-600";return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Monitor and manage CivicOS platform data and operations"})]}),e.jsxs(m,{className:"mb-6",children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"h-5 w-5"}),e.jsx("span",{children:"Platform Health Overview"})]}),e.jsx(u,{children:"Current platform statistics and data counts"})]}),e.jsxs(p,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:o.users}),e.jsx("div",{className:"text-sm text-gray-600",children:"Registered Users"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.government.politicians}),e.jsx("div",{className:"text-sm text-gray-600",children:"Politicians"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:o.government.bills}),e.jsx("div",{className:"text-sm text-gray-600",children:"Active Bills"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:o.content.news}),e.jsx("div",{className:"text-sm text-gray-600",children:"News Articles"})]})]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500 text-center",children:["Last updated: ",new Date(o.timestamp).toLocaleString()]})]})]}),e.jsxs(m,{className:"mb-6",children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"h-5 w-5"}),e.jsx("span",{children:"Comprehensive Data Ingestion"})]}),e.jsx(u,{children:"Refresh all data sources with current government information"})]}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Run Full Data Ingestion"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Refresh all data sources: politicians, bills, elections, legal, procurement, lobbyists, news, and petitions"})]}),e.jsx(r,{onClick:()=>d.mutate(),disabled:P||d.isPending,className:"bg-blue-600 hover:bg-blue-700",children:P||d.isPending?e.jsxs(e.Fragment,{children:[e.jsx(t,{size:"sm",className:"mr-2"}),"Running..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Run Full Ingestion"]})})]}),d.isError&&e.jsx(W,{variant:"destructive",children:e.jsxs(X,{children:["Failed to run comprehensive ingestion: ",(C=d.error)==null?void 0:C.message]})})]})})]}),e.jsxs(m,{className:"mb-6",children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"h-5 w-5"}),e.jsx("span",{children:"Individual Data Source Controls"})]}),e.jsx(u,{children:"Refresh specific data sources individually"})]}),e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(r,{onClick:()=>g.mutate(),disabled:g.isPending,variant:"outline",className:"h-auto p-4 flex-col space-y-2",children:[e.jsx(G,{className:"h-6 w-6"}),e.jsx("span",{children:"Refresh Politicians"}),g.isPending&&e.jsx(t,{size:"sm"})]}),e.jsxs(r,{onClick:()=>j.mutate(),disabled:j.isPending,variant:"outline",className:"h-auto p-4 flex-col space-y-2",children:[e.jsx(R,{className:"h-6 w-6"}),e.jsx("span",{children:"Refresh Bills & Votes"}),j.isPending&&e.jsx(t,{size:"sm"})]}),e.jsxs(r,{onClick:()=>f.mutate(),disabled:f.isPending,variant:"outline",className:"h-auto p-4 flex-col space-y-2",children:[e.jsx(V,{className:"h-6 w-6"}),e.jsx("span",{children:"Refresh Elections"}),f.isPending&&e.jsx(t,{size:"sm"})]}),e.jsxs(r,{onClick:()=>v.mutate(),disabled:v.isPending,variant:"outline",className:"h-auto p-4 flex-col space-y-2",children:[e.jsx($,{className:"h-6 w-6"}),e.jsx("span",{children:"Refresh Legal Data"}),v.isPending&&e.jsx(t,{size:"sm"})]}),e.jsxs(r,{onClick:()=>N.mutate(),disabled:N.isPending,variant:"outline",className:"h-auto p-4 flex-col space-y-2",children:[e.jsx(Y,{className:"h-6 w-6"}),e.jsx("span",{children:"Refresh Procurement"}),N.isPending&&e.jsx(t,{size:"sm"})]}),e.jsxs(r,{onClick:()=>y.mutate(),disabled:y.isPending,variant:"outline",className:"h-auto p-4 flex-col space-y-2",children:[e.jsx(_,{className:"h-6 w-6"}),e.jsx("span",{children:"Refresh Lobbyists"}),y.isPending&&e.jsx(t,{size:"sm"})]}),e.jsxs(r,{onClick:()=>b.mutate(),disabled:b.isPending,variant:"outline",className:"h-auto p-4 flex-col space-y-2",children:[e.jsx(Z,{className:"h-6 w-6"}),e.jsx("span",{children:"Refresh News"}),b.isPending&&e.jsx(t,{size:"sm"})]}),e.jsxs(r,{onClick:()=>w.mutate(),disabled:w.isPending,variant:"outline",className:"h-auto p-4 flex-col space-y-2",children:[e.jsx(R,{className:"h-6 w-6"}),e.jsx("span",{children:"Refresh Petitions"}),w.isPending&&e.jsx(t,{size:"sm"})]})]})})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"h-5 w-5"}),e.jsx("span",{children:"Data Source Status"})]}),e.jsx(u,{children:"Current status of all data sources and last refresh times"})]}),e.jsx(p,{children:e.jsx("div",{className:"space-y-4",children:Object.entries(z).map(([l,c])=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[K(c.success),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium capitalize",children:l.replace(/([A-Z])/g," $1").trim()}),e.jsx("div",{className:"text-sm text-gray-600",children:c.message})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-sm font-medium ${A(c.success)}`,children:c.success?"Healthy":"Issues Detected"}),c.timestamp&&e.jsx("div",{className:"text-xs text-gray-500",children:new Date(c.timestamp).toLocaleString()})]})]},l))})})]})]})})}export{ce as default};
