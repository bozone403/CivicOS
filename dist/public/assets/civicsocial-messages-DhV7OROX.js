import{j as e}from"./ui-B-8yHimL.js";import{r as c}from"./vendor-DRd396Ms.js";import{c as h,q as W,p as D,y as X,G as B,r as Y,D as Z,N as _,B as l,ae as ee,a as se,b as ae,d as te,e as re,I as u,l as ie,a5 as Q,W as y,z as le,ah as ce}from"./index-BOKJ3jPl.js";import{A as N,a as f,b as w}from"./avatar-D6RmvPh8.js";import{P as ne}from"./phone-Bn2_cubk.js";import{I as oe}from"./image-C8pY5LUO.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=h("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=h("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=h("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=h("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function fe(){var z,A,E,F,P,T,$,q;const{user:p}=W(),{toast:V}=D(),v=X(),[r,U]=c.useState(null),[m,b]=c.useState(""),[g,R]=c.useState(""),S=c.useRef(null),[G,H]=c.useState(!1),{data:k=[]}=B({queryKey:["/api/social/conversations"],queryFn:async()=>{const s=await fetch("/api/social/conversations",{headers:{Authorization:`Bearer ${localStorage.getItem("civicos-jwt")}`}});if(!s.ok)throw new Error("Failed to fetch conversations");return s.json()},staleTime:3e4}),{data:j=[]}=B({queryKey:["/api/social/messages",r],queryFn:async()=>{if(!r)return[];const s=await fetch(`/api/social/messages/${r}`,{headers:{Authorization:`Bearer ${localStorage.getItem("civicos-jwt")}`}});if(!s.ok)throw new Error("Failed to fetch messages");return s.json()},enabled:!!r,staleTime:1e4}),I=Y({mutationFn:async s=>{const t=await fetch("/api/social/messages",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("civicos-jwt")}`},body:JSON.stringify({content:s,receiverId:r,conversationId:r})});if(!t.ok)throw new Error("Failed to send message");return t.json()},onSuccess:()=>{v.invalidateQueries({queryKey:["/api/social/messages",r]}),v.invalidateQueries({queryKey:["/api/social/conversations"]}),b("")},onError:s=>{V({title:"Failed to send message",description:s.message||"Please try again",variant:"destructive"})}});c.useEffect(()=>{var s;(s=S.current)==null||s.scrollIntoView({behavior:"smooth"})},[j]);const C=()=>{!m.trim()||!r||I.mutate(m)},J=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),C())},M=k.filter(s=>{var t,i;return((t=s.participant)==null?void 0:t.firstName.toLowerCase().includes(g.toLowerCase()))||((i=s.participant)==null?void 0:i.lastName.toLowerCase().includes(g.toLowerCase()))}),a=k.find(s=>s.id===r);return e.jsxs("div",{className:"h-screen flex bg-gray-50",children:[e.jsxs("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Messages"}),e.jsxs(Z,{open:G,onOpenChange:H,children:[e.jsx(_,{asChild:!0,children:e.jsx(l,{size:"sm",variant:"outline",children:e.jsx(ee,{className:"w-4 h-4"})})}),e.jsxs(se,{children:[e.jsxs(ae,{children:[e.jsx(te,{children:"New Conversation"}),e.jsx(re,{children:"Start a new conversation with another user"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(u,{placeholder:"Search users..."})})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(u,{placeholder:"Search conversations...",value:g,onChange:s=>R(s.target.value),className:"pl-10"})]})]}),e.jsx(Q,{className:"flex-1",children:e.jsx("div",{className:"space-y-1 p-2",children:M.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No conversations yet"}),e.jsx("p",{className:"text-sm",children:"Add friends to start messaging"})]}):M.map(s=>{var t,i,n,o,d,x,L,O,K;return e.jsx("div",{onClick:()=>U(s.id),className:`p-3 rounded-lg cursor-pointer transition-colors ${r===s.id?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(N,{className:"w-12 h-12",children:[e.jsx(f,{src:(t=s.participant)==null?void 0:t.profileImageUrl}),e.jsxs(w,{children:[(n=(i=s.participant)==null?void 0:i.firstName)==null?void 0:n[0],(d=(o=s.participant)==null?void 0:o.lastName)==null?void 0:d[0]]})]}),((x=s.participant)==null?void 0:x.isOnline)&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-sm truncate",children:[(L=s.participant)==null?void 0:L.firstName," ",(O=s.participant)==null?void 0:O.lastName]}),s.lastMessage&&e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.lastMessage.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:((K=s.lastMessage)==null?void 0:K.content)||"No messages yet"}),s.unreadCount>0&&e.jsx(le,{variant:"secondary",className:"mt-1",children:s.unreadCount})]})]})},s.id)})})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(N,{className:"w-10 h-10",children:[e.jsx(f,{src:(z=a==null?void 0:a.participant)==null?void 0:z.profileImageUrl}),e.jsxs(w,{children:[(E=(A=a==null?void 0:a.participant)==null?void 0:A.firstName)==null?void 0:E[0],(P=(F=a==null?void 0:a.participant)==null?void 0:F.lastName)==null?void 0:P[0]]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold",children:[(T=a==null?void 0:a.participant)==null?void 0:T.firstName," ",($=a==null?void 0:a.participant)==null?void 0:$.lastName]}),e.jsx("div",{className:"flex items-center space-x-2",children:(q=a==null?void 0:a.participant)!=null&&q.isOnline?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm text-green-600",children:"Online"})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Offline"})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(de,{className:"w-4 h-4"})})]})]})}),e.jsx(Q,{className:"flex-1 p-4",children:e.jsxs("div",{className:"space-y-4",children:[j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Start the conversation!"})]}):j.map(s=>{var i,n,o,d,x;const t=s.senderId===(p==null?void 0:p.id);return e.jsx("div",{className:`flex ${t?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex items-end space-x-2 max-w-xs lg:max-w-md ${t?"flex-row-reverse space-x-reverse":""}`,children:[!t&&e.jsxs(N,{className:"w-8 h-8",children:[e.jsx(f,{src:(i=s.sender)==null?void 0:i.profileImageUrl}),e.jsxs(w,{children:[(o=(n=s.sender)==null?void 0:n.firstName)==null?void 0:o[0],(x=(d=s.sender)==null?void 0:d.lastName)==null?void 0:x[0]]})]}),e.jsxs("div",{className:`px-4 py-2 rounded-lg ${t?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-blue-100":"text-gray-500"}`,children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},s.id)}),e.jsx("div",{ref:S})]})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1",children:e.jsx(u,{placeholder:"Type a message...",value:m,onChange:s=>b(s.target.value),onKeyPress:J,className:"w-full"})}),e.jsx(l,{onClick:C,disabled:!m.trim()||I.isPending,size:"sm",children:e.jsx(ce,{className:"w-4 h-4"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No conversation selected"}),e.jsx("p",{className:"text-gray-500",children:"Choose a conversation from the sidebar to start messaging"})]})})})]})}export{fe as default};
