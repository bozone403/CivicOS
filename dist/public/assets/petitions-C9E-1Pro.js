import{j as e}from"./ui-CDUWW_Ri.js";import{r as d}from"./vendor-1XCZ5AD1.js";import{q as ce,p as oe,E as de,K as me,r as g,g as b,j as w,T as F,B as l,l as he,I as p,h as xe,i as ue,v as q,C as I,U as z,a3 as M,R as ge,D as R,a as U,b as $,c as B,d as Q,L as x,$ as pe,y as m}from"./index-CxE8SzRb.js";import{S as K,a as _,b as V,c as Y,d as a}from"./select-BwiA_mBG.js";import{P as je}from"./progress-DwdN1oWr.js";import{P as ye}from"./plus-CjX_SOua.js";import{C as G}from"./clock-DuHC0jZ-.js";import{B as J}from"./bookmark-C_WwDjhf.js";import{T as ve}from"./target-CrRh5F6p.js";import{C as fe}from"./calendar-DktYYPSv.js";import"./index-q7PMzjPi.js";const W=[{id:1,title:"Climate Action Now",description:"Urgent petition calling for immediate climate action and carbon reduction targets in Canada.",creator:"Climate Action Network",category:"Environment",region:"National",targetSignatures:5e4,currentSignatures:32450,daysLeft:45,status:"active",urgency:"high",verified:!0,image:"https://images.unsplash.com/photo-1569163139394-de4e4c5c5c5c?w=800&h=400&fit=crop",tags:["Climate","Environment","Action"],supporters:[{name:"Greenpeace Canada",role:"Environmental Organization",location:"National"},{name:"Sierra Club Canada",role:"Environmental Organization",location:"National"}]},{id:2,title:"Universal Healthcare Expansion",description:"Petition to expand universal healthcare coverage to include dental, vision, and mental health services.",creator:"Canadian Health Coalition",category:"Healthcare",region:"National",targetSignatures:75e3,currentSignatures:56780,daysLeft:30,status:"active",urgency:"medium",verified:!0,image:"https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?w=800&h=400&fit=crop",tags:["Healthcare","Universal Coverage","Dental"],supporters:[{name:"Canadian Medical Association",role:"Professional Association",location:"National"},{name:"Canadian Nurses Association",role:"Professional Association",location:"National"}]},{id:3,title:"Housing Affordability Crisis",description:"Petition demanding immediate action on the housing affordability crisis affecting millions of Canadians.",creator:"Housing Rights Coalition",category:"Housing",region:"National",targetSignatures:1e5,currentSignatures:89230,daysLeft:20,status:"active",urgency:"critical",verified:!0,image:"https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=400&fit=crop",tags:["Housing","Affordability","Crisis"],supporters:[{name:"Canadian Housing and Renewal Association",role:"Housing Organization",location:"National"},{name:"ACORN Canada",role:"Tenant Organization",location:"National"}]}];function j(c){return c?typeof c=="string"?c:typeof c.message=="string"?c.message:typeof c.message=="object"?JSON.stringify(c.message):JSON.stringify(c):"Unknown error"}function He(){const{user:c,isAuthenticated:y}=ce(),{toast:i}=oe(),P=de(),[v,X]=d.useState(""),[f,Z]=d.useState("all"),[r,Ne]=d.useState(null),[ee,se]=d.useState(!1),[te,u]=d.useState(!1),[n,o]=d.useState({title:"",description:"",category:"Democracy",targetSignatures:500,deadlineDate:""}),{data:N=[],isLoading:ae,error:D}=me({queryKey:["/api/petitions"],queryFn:async()=>{try{const s=await m("/api/petitions","GET");return s&&Array.isArray(s)?s:s&&s.data&&Array.isArray(s.data)?s.data:(console.warn("Unexpected API response format, using fallback data"),W)}catch{return W}},retry:2,retryDelay:1e3}),E=g({mutationFn:async({petitionId:s,verificationId:t})=>m(`/api/petitions/${s}/sign`,"POST",{verificationId:t}),onSuccess:()=>{i({title:"Petition signed!",description:"Your signature has been recorded successfully."}),P.invalidateQueries({queryKey:["/api/petitions"]})},onError:s=>{i({title:"Error signing petition",description:j(s)||"Failed to sign petition. Please try again.",variant:"destructive"})}}),T=g({mutationFn:async({petitionId:s,platform:t})=>m(`/api/petitions/${s}/share`,"POST",{platform:t}),onSuccess:s=>{s.shareLink&&window.open(s.shareLink,"_blank"),i({title:"Petition shared!",description:"The petition has been shared successfully."})},onError:s=>{i({title:"Error sharing petition",description:j(s)||"Failed to share petition. Please try again.",variant:"destructive"})}}),k=g({mutationFn:async s=>m(`/api/petitions/${s}/save`,"POST"),onSuccess:()=>{i({title:"Petition saved!",description:"The petition has been saved to your bookmarks."})},onError:s=>{i({title:"Error saving petition",description:j(s)||"Failed to save petition. Please try again.",variant:"destructive"})}}),C=g({mutationFn:async s=>m("/api/petitions","POST",s),onSuccess:()=>{i({title:"Petition created!",description:"Your petition has been created successfully."}),u(!1),o({title:"",description:"",category:"Democracy",targetSignatures:500,deadlineDate:""}),P.invalidateQueries({queryKey:["/api/petitions"]})},onError:s=>{i({title:"Error creating petition",description:j(s)||"Failed to create petition. Please try again.",variant:"destructive"})}}),A=async s=>{if(!y){i({title:"Authentication required",description:"Please log in to sign petitions.",variant:"destructive"});return}const t=`petition_${s}_${Date.now()}`;E.mutate({petitionId:s,verificationId:t})},S=async(s,t)=>{const h=N.find(O=>O.id===s);if(!h)return;const le=`Sign this petition: ${h.title} on CivicOS`;if(t==="civicsocial")try{await m("/api/social/posts","POST",{content:le,type:"share",originalItemId:s,originalItemType:"petition",visibility:"public",tags:["petition",h.category]}),i({title:"Shared to CivicSocial!",description:"Your post has been added to the social feed."})}catch{i({title:"Share failed",description:"Failed to share to CivicSocial. Please try again.",variant:"destructive"})}else T.mutate({petitionId:s,platform:t})},L=async s=>{if(!y){i({title:"Authentication required",description:"Please log in to save petitions.",variant:"destructive"});return}k.mutate(s)},ie=async()=>{if(!y){i({title:"Authentication required",description:"Please log in to create petitions.",variant:"destructive"});return}if(!n.title||!n.description){i({title:"Missing information",description:"Please fill in all required fields.",variant:"destructive"});return}C.mutate(n)},H=N.filter(s=>{const t=s.title.toLowerCase().includes(v.toLowerCase())||s.description.toLowerCase().includes(v.toLowerCase()),h=f==="all"||s.category===f;return t&&h}),ne=s=>{switch(s.toLowerCase()){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},re=(s,t)=>Math.min(s/t*100,100);return ae?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"animate-pulse space-y-6",children:[...Array(6)].map((s,t)=>e.jsx(b,{children:e.jsxs(w,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})},t))})}):D&&N.length===0?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(b,{children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Petitions"}),e.jsx("p",{className:"text-gray-600",children:"Unable to load petitions at this time. Please try again later."})]})})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Canadian Petitions"}),e.jsx("p",{className:"text-gray-600",children:"Make your voice heard on important issues affecting Canadians"})]}),e.jsxs(l,{onClick:()=>u(!0),className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Create Petition"]})]}),D&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx(F,{className:"inline w-4 h-4 mr-1"}),"Showing sample data due to connection issues. Some features may be limited."]})}),!1]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(p,{placeholder:"Search petitions...",value:v,onChange:s=>X(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(K,{value:f,onValueChange:Z,children:[e.jsx(_,{children:e.jsx(V,{placeholder:"Filter by category"})}),e.jsxs(Y,{children:[e.jsx(a,{value:"all",children:"All Categories"}),e.jsx(a,{value:"Healthcare",children:"Healthcare"}),e.jsx(a,{value:"Environment",children:"Environment"}),e.jsx(a,{value:"Democracy",children:"Democracy"}),e.jsx(a,{value:"Indigenous Rights",children:"Indigenous Rights"}),e.jsx(a,{value:"Housing",children:"Housing"}),e.jsx(a,{value:"Economy",children:"Economy"}),e.jsx(a,{value:"Transparency",children:"Transparency"})]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:H.map(s=>e.jsxs(b,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(xe,{className:"pb-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(ue,{className:"text-lg mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(q,{variant:"outline",className:"text-xs",children:s.category}),e.jsx(q,{className:`text-xs ${ne(s.urgency)}`,children:s.urgency}),s.verified&&e.jsx(I,{className:"h-4 w-4 text-green-600"})]})]})})}),e.jsxs(w,{className:"pb-6",children:[e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:s.description}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[s.currentSignatures.toLocaleString()," / ",s.targetSignatures.toLocaleString()]})]}),e.jsx(je,{value:re(s.currentSignatures,s.targetSignatures),className:"h-2"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.currentSignatures.toLocaleString()," signatures"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.daysLeft," days left"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-100",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s.creator}),s.verified&&e.jsx(I,{className:"w-4 h-4 text-green-600"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>L(s.id),disabled:k.isPending,children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>S(s.id,"twitter"),disabled:T.isPending,children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Share"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>S(s.id,"civicsocial"),children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"CivicSocial"]})]}),e.jsx(l,{size:"sm",onClick:()=>A(s.id),disabled:E.isPending,children:"Sign Petition"})]})]})]},s.id))}),H.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ve,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No petitions found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your search or filter criteria."})]}),e.jsx(R,{open:ee,onOpenChange:se,children:e.jsx(U,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:r&&e.jsxs("div",{children:[e.jsxs($,{children:[e.jsx(B,{children:r.title}),e.jsx(Q,{children:r.description})]}),e.jsxs("div",{className:"space-y-6 mt-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{children:[r.currentSignatures.toLocaleString()," signatures"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{children:[r.daysLeft," days left"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:r.status})]})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Key Supporters"}),e.jsx("div",{className:"space-y-2",children:r.supporters.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-600",children:s.role})]}),e.jsx("span",{className:"text-xs text-gray-500",children:s.location})]},t))})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["Created by: ",r.creator]}),e.jsxs("span",{children:[r.daysLeft," days remaining"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>L(r.id),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Save"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>S(r.id,"twitter"),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Share"]}),e.jsx(l,{size:"sm",onClick:()=>A(r.id),children:"Sign Petition"})]})]})]})]})})}),e.jsx(R,{open:te,onOpenChange:u,children:e.jsxs(U,{className:"max-w-2xl",children:[e.jsxs($,{children:[e.jsx(B,{children:"Create New Petition"}),e.jsx(Q,{children:"Start a petition to make your voice heard on important issues."})]}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"title",children:"Petition Title *"}),e.jsx(p,{id:"title",placeholder:"Enter petition title...",value:n.title,onChange:s=>o({...n,title:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"description",children:"Description *"}),e.jsx(pe,{id:"description",placeholder:"Describe your petition and why it's important...",value:n.description,onChange:s=>o({...n,description:s.target.value}),rows:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"category",children:"Category"}),e.jsxs(K,{value:n.category,onValueChange:s=>o({...n,category:s}),children:[e.jsx(_,{children:e.jsx(V,{})}),e.jsxs(Y,{children:[e.jsx(a,{value:"Democracy",children:"Democracy"}),e.jsx(a,{value:"Healthcare",children:"Healthcare"}),e.jsx(a,{value:"Environment",children:"Environment"}),e.jsx(a,{value:"Housing",children:"Housing"}),e.jsx(a,{value:"Economy",children:"Economy"}),e.jsx(a,{value:"Indigenous Rights",children:"Indigenous Rights"}),e.jsx(a,{value:"Transparency",children:"Transparency"})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"targetSignatures",children:"Target Signatures"}),e.jsx(p,{id:"targetSignatures",type:"number",placeholder:"500",value:n.targetSignatures,onChange:s=>o({...n,targetSignatures:parseInt(s.target.value)||500})})]})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"deadlineDate",children:"Deadline (Optional)"}),e.jsx(p,{id:"deadlineDate",type:"date",value:n.deadlineDate,onChange:s=>o({...n,deadlineDate:s.target.value})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx(l,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(l,{onClick:ie,disabled:C.isPending,children:C.isPending?"Creating...":"Create Petition"})]})]})})]})}export{He as default};
