import{j as e}from"./ui-CDUWW_Ri.js";import{r as N}from"./vendor-1XCZ5AD1.js";import{q as S,E as D,p as A,K as v,r as o,v as m,B as c,ao as P,D as q,aq as F,am as T,a as M,b as R,c as B,d as K,o as O,g as x,j as h,a5 as z,H as Q,y as d}from"./index-BvFXhaUc.js";import{S as n}from"./switch-hOedCOzg.js";import"./index-q7PMzjPi.js";function G(){const[r,g]=N.useState("all"),[b,k]=N.useState(!1),{user:U,isAuthenticated:L}=S(),u=D(),{toast:i}=A(),{data:l=[]}=v({queryKey:["/api/notifications"],enabled:!0}),{data:t}=v({queryKey:["/api/notifications/preferences"],enabled:!0}),C=o({mutationFn:async s=>{try{await d(`/api/notifications/${s}`,"DELETE")}catch{}return s},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/notifications"]}),i({title:"Notification deleted",description:"The notification has been removed."})},onError:()=>{i({title:"Error",description:"Failed to delete notification.",variant:"destructive"})}}),p=o({mutationFn:async()=>{try{await d("/api/notifications","DELETE")}catch{}return!0},onSuccess:()=>{i({title:"All notifications cleared",description:"All notifications have been removed."})},onError:()=>{i({title:"Error",description:"Failed to clear notifications.",variant:"destructive"})}}),w=o({mutationFn:async s=>{try{await d(`/api/notifications/${s}/read`,"POST")}catch{}return s},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/notifications"]})}}),a=o({mutationFn:s=>d("/api/notifications/preferences","PUT",s),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/notifications/preferences"]}),i({title:"Preferences updated",description:"Your notification preferences have been saved."})},onError:()=>{i({title:"Error",description:"Failed to update preferences.",variant:"destructive"})}}),f=l,j=f.filter(s=>r==="bill"?s.type==="bill":r==="petition"?s.type==="petition":r==="foi"?s.type==="foi":r==="system"?s.type==="system":!0),y=f.filter(s=>!s.read).length;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Notifications"}),e.jsx("p",{className:"text-muted-foreground",children:"Stay updated on civic activities and government changes"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(m,{variant:"outline",className:"text-sm",children:[y," unread"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>p.mutate(),disabled:p.isPending||l.length===0,children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Clear All"]}),e.jsxs(q,{open:b,onOpenChange:k,children:[e.jsx(F,{asChild:!0,children:e.jsxs(c,{variant:"outline",size:"sm",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Preferences"]})}),e.jsxs(M,{className:"max-w-md",children:[e.jsxs(R,{children:[e.jsx(B,{children:"Notification Preferences"}),e.jsx(K,{children:"Manage which notifications you receive from CivicOS."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Petition Alerts"}),e.jsx(n,{checked:(t==null?void 0:t.petitionAlerts)??!0,onCheckedChange:s=>a.mutate({petitionAlerts:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Bill Updates"}),e.jsx(n,{checked:(t==null?void 0:t.billUpdates)??!0,onCheckedChange:s=>a.mutate({billUpdates:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"FOI Responses"}),e.jsx(n,{checked:(t==null?void 0:t.foiResponses)??!0,onCheckedChange:s=>a.mutate({foiResponses:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"System News"}),e.jsx(n,{checked:(t==null?void 0:t.systemNews)??!0,onCheckedChange:s=>a.mutate({systemNews:s})})]})]}),e.jsx(O,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Email Notifications"}),e.jsx(n,{checked:(t==null?void 0:t.emailNotifications)??!0,onCheckedChange:s=>a.mutate({emailNotifications:s})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Push Notifications"}),e.jsx(n,{checked:(t==null?void 0:t.pushNotifications)??!0,onCheckedChange:s=>a.mutate({pushNotifications:s})})]})]})]})]})]})]})]}),e.jsx(x,{children:e.jsx(h,{className:"p-6",children:e.jsx("div",{className:"flex space-x-2",children:[{key:"all",label:"All",count:l.length},{key:"unread",label:"Unread",count:y},{key:"bills",label:"Bills",count:l.filter(s=>s.type==="bill").length},{key:"petitions",label:"Petitions",count:l.filter(s=>s.type==="petition").length}].map(s=>e.jsxs(c,{variant:r===s.key?"default":"ghost",size:"sm",onClick:()=>g(s.key),className:"space-x-2",children:[e.jsx("span",{children:s.label}),e.jsx(m,{variant:"secondary",className:"text-xs",children:s.count})]},s.key))})})}),e.jsx("div",{className:"space-y-4",children:j.length===0?e.jsx(x,{children:e.jsxs(h,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(z,{className:"w-12 h-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No notifications"}),e.jsx("p",{className:"text-muted-foreground text-center",children:"You're all caught up! Check back later for updates on civic activities."})]})}):j.map(s=>e.jsx(x,{className:Q("border",s.read?"border-gray-200":"border-blue-400"),children:e.jsxs(h,{className:"flex flex-col gap-2 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:s.read?"secondary":"default",className:s.read?"bg-gray-200 text-gray-500":"bg-blue-600 text-white",children:s.type}),e.jsx("span",{className:"font-semibold text-sm",children:s.title})]}),!s.read&&e.jsx(c,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 ml-2",onClick:()=>w.mutate(s.id),children:"Mark as Read"})]}),e.jsx("div",{className:"text-xs text-gray-600",children:s.message}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:new Date(s.timestamp).toLocaleString()}),e.jsx(c,{size:"sm",variant:"ghost",className:"text-xs text-red-600 hover:bg-red-50",onClick:()=>C.mutate(s.id),children:"Delete"})]})]})},s.id))})]})}export{G as default};
