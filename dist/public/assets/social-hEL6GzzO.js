import{j as e}from"./ui-B-8yHimL.js";import{r as c}from"./vendor-DRd396Ms.js";import{c as _,r as he,q as pe,E as je,J as Q,s as x,x as d,h as u,k as h,R as f,W as C,X as b,Q as w,B as i,ak as K,i as ge,am as O,a4 as Y,a5 as Ne,a0 as ve,D as H,a as W,b as B,d as G}from"./index-Bo3mAL2C.js";import{I as ye}from"./image-Dl0zAn2D.js";import{S as fe}from"./smile-D97ARpzp.js";import{T as J}from"./trash-2-w6nRaUCP.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=_("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=_("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);function be(){var A,L,M;const{user:t,isAuthenticated:S}=he(),{toast:r}=pe(),o=je(),[p,k]=c.useState(""),[j,P]=c.useState(""),[a,V]=c.useState(null),[Z,g]=c.useState(!1),[ee,F]=c.useState(!1),[we,I]=c.useState(null),[m,N]=c.useState(null),[l,E]=c.useState(null),[v,U]=c.useState(""),se=c.useRef(null),{data:q=[],isLoading:ae}=Q({queryKey:["civicSocialFeed"],queryFn:async()=>{const s=await d("/api/social/feed","GET");return(s==null?void 0:s.feed)||[]},enabled:S}),{data:te=[]}=Q({queryKey:["/api/social/posts",a==null?void 0:a.id,"comments"],queryFn:async()=>{var n;const s=await d(`/api/social/posts/${a==null?void 0:a.id}`,"GET");return((n=s==null?void 0:s.post)==null?void 0:n.comments)||[]},enabled:!!a&&S}),z=x({mutationFn:async s=>d("/api/social/posts","POST",s),onSuccess:()=>{o.invalidateQueries({queryKey:["civicSocialFeed"]}),k(""),U(""),g(!1),r({title:"Post created!",description:"Your post has been shared successfully."})},onError:s=>{r({title:"Error creating post",description:s.message||"Failed to create post. Please try again.",variant:"destructive"})}});x({mutationFn:async({postId:s,data:n})=>d(`/api/social/posts/${s}`,"PUT",n),onSuccess:()=>{o.invalidateQueries({queryKey:["civicSocialFeed"]}),I(null),r({title:"Post updated!",description:"Your post has been updated successfully."})},onError:s=>{r({title:"Error updating post",description:s.message||"Failed to update post. Please try again.",variant:"destructive"})}});const ie=x({mutationFn:async s=>d(`/api/social/posts/${s}`,"DELETE"),onSuccess:()=>{o.invalidateQueries({queryKey:["civicSocialFeed"]}),r({title:"Post deleted!",description:"Your post has been deleted successfully."})},onError:s=>{r({title:"Error deleting post",description:s.message||"Failed to delete post. Please try again.",variant:"destructive"})}}),ne=x({mutationFn:async({postId:s,content:n,parentCommentId:y})=>d(`/api/social/posts/${s}/comments`,"POST",{content:n,parentCommentId:y}),onSuccess:()=>{o.invalidateQueries({queryKey:["/api/social/posts",a==null?void 0:a.id,"comments"]}),P(""),E(null),r({title:"Comment posted!",description:"Your comment has been posted successfully."})},onError:s=>{r({title:"Error posting comment",description:s.message||"Failed to post comment. Please try again.",variant:"destructive"})}}),re=x({mutationFn:async({commentId:s,content:n})=>d(`/api/social/comments/${s}`,"PUT",{content:n}),onSuccess:()=>{o.invalidateQueries({queryKey:["/api/social/posts",a==null?void 0:a.id,"comments"]}),N(null),r({title:"Comment updated!",description:"Your comment has been updated successfully."})},onError:s=>{r({title:"Error updating comment",description:s.message||"Failed to update comment. Please try again.",variant:"destructive"})}}),le=x({mutationFn:async s=>d(`/api/social/comments/${s}`,"DELETE"),onSuccess:()=>{o.invalidateQueries({queryKey:["/api/social/posts",a==null?void 0:a.id,"comments"]}),r({title:"Comment deleted!",description:"Your comment has been deleted successfully."})},onError:s=>{r({title:"Error deleting comment",description:s.message||"Failed to delete comment. Please try again.",variant:"destructive"})}}),ce=x({mutationFn:async({postId:s,commentId:n})=>d("/api/social/like","POST",{postId:s,commentId:n}),onSuccess:()=>{o.invalidateQueries({queryKey:["civicSocialFeed"]}),a&&o.invalidateQueries({queryKey:["/api/social/posts",a.id,"comments"]})},onError:s=>{r({title:"Error",description:s.message||"Failed to like/unlike. Please try again.",variant:"destructive"})}}),$=()=>{if(!p.trim()&&!v.trim()){r({title:"Error",description:"Please enter some content or an image URL.",variant:"destructive"});return}z.mutate({content:p,imageUrl:v||void 0})},de=s=>{confirm("Are you sure you want to delete this post?")&&ie.mutate(s)},oe=()=>{!a||!j.trim()||ne.mutate({postId:a.id,content:j,parentCommentId:l==null?void 0:l.id})},me=s=>{m&&re.mutate({commentId:s.id,content:m.content})},xe=s=>{confirm("Are you sure you want to delete this comment?")&&le.mutate(s)},D=(s,n)=>{ce.mutate({postId:s,commentId:n})},T=s=>s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.userId,R=s=>s.firstName&&s.lastName?`${s.firstName[0]}${s.lastName[0]}`:s.userId.substring(0,2).toUpperCase();return S?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"CivicSocial Feed"}),e.jsx("p",{className:"text-gray-600",children:"Share your thoughts and engage with the community"})]}),e.jsx(u,{className:"mb-6",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs(f,{className:"h-10 w-10",children:[e.jsx(C,{src:t==null?void 0:t.profileImageUrl}),e.jsx(b,{children:((A=t==null?void 0:t.firstName)==null?void 0:A[0])||((L=t==null?void 0:t.lastName)==null?void 0:L[0])||((M=t==null?void 0:t.email)==null?void 0:M[0])||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(w,{placeholder:"What's on your mind?",value:p,onChange:s=>k(s.target.value),className:"min-h-[100px] resize-none",ref:se}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>g(!0),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Add Image"]}),e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Emoji"]})]}),e.jsxs(i,{onClick:$,disabled:z.isPending||!p.trim()&&!v.trim(),children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Post"]})]})]})]})})}),e.jsx("div",{className:"space-y-6",children:ae?e.jsx("div",{className:"animate-pulse space-y-6",children:[...Array(3)].map((s,n)=>e.jsx(u,{children:e.jsxs(h,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})},n))}):q.length===0?e.jsx(u,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-gray-600",children:"Be the first to share something!"})]})})}):q.map(s=>e.jsxs(u,{children:[e.jsx(ge,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(f,{className:"h-10 w-10",children:[e.jsx(C,{src:s.profileImageUrl}),e.jsx(b,{children:R(s)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:T(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:O(new Date(s.createdAt),{addSuffix:!0})})]})]}),s.userId===(t==null?void 0:t.id)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>I(s),children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>de(s.id),children:e.jsx(J,{className:"w-4 h-4"})})]})]})}),e.jsxs(h,{children:[s.content&&e.jsx("p",{className:"text-gray-900 mb-4",children:s.content}),s.imageUrl&&e.jsx("img",{src:s.imageUrl,alt:"Post image",className:"w-full h-64 object-cover rounded-lg mb-4"}),s.type==="share"&&s.comment&&e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:e.jsx("p",{className:"text-sm text-gray-600",children:s.comment})}),e.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>D(s.id),className:s.isLiked?"text-red-500":"",children:[e.jsx(Y,{className:`w-4 h-4 mr-2 ${s.isLiked?"fill-current":""}`}),s.likeCount]}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>{V(s),F(!0)},children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),s.commentCount]}),e.jsxs(i,{variant:"ghost",size:"sm",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Share"]})]})})]})]},s.id))}),e.jsx(H,{open:Z,onOpenChange:g,children:e.jsxs(W,{children:[e.jsx(B,{children:e.jsx(G,{children:"Create Post"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{placeholder:"What's on your mind?",value:p,onChange:s=>k(s.target.value),className:"min-h-[120px]"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Image URL (optional)"}),e.jsx("input",{type:"url",placeholder:"https://example.com/image.jpg",value:v,onChange:s=>U(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(i,{onClick:$,children:"Post"})]})]})]})}),e.jsx(H,{open:ee,onOpenChange:F,children:e.jsxs(W,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(B,{children:e.jsx(G,{children:"Comments"})}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsxs(f,{className:"h-8 w-8",children:[e.jsx(C,{src:a.profileImageUrl}),e.jsx(b,{children:R(a)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:T(a)}),e.jsx("p",{className:"text-xs text-gray-500",children:O(new Date(a.createdAt),{addSuffix:!0})})]})]}),a.content&&e.jsx("p",{className:"text-sm",children:a.content})]})}),e.jsx("div",{className:"space-y-4",children:te.map(s=>{var n,y;return e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(f,{className:"h-8 w-8 flex-shrink-0",children:[e.jsx(C,{src:s.profileImageUrl}),e.jsxs(b,{children:[(n=s.firstName)==null?void 0:n[0],(y=s.lastName)==null?void 0:y[0]]})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-medium text-sm",children:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.userId}),s.userId===(t==null?void 0:t.id)&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>N(s),children:e.jsx(X,{className:"w-3 h-3"})}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>xe(s.id),children:e.jsx(J,{className:"w-3 h-3"})})]})]}),(m==null?void 0:m.id)===s.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{value:m.content,onChange:ue=>N({...m,content:ue.target.value}),className:"min-h-[80px]"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(i,{size:"sm",onClick:()=>me(s),children:"Save"}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>N(null),children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>D(void 0,s.id),className:s.isLiked?"text-red-500":"",children:[e.jsx(Y,{className:`w-3 h-3 mr-1 ${s.isLiked?"fill-current":""}`}),s.likeCount]}),e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>E(s),children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),"Reply"]})]})]})]})})]},s.id)})}),e.jsxs("div",{className:"space-y-2",children:[l&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-600",children:["Replying to ",l.firstName&&l.lastName?`${l.firstName} ${l.lastName}`:l.userId]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>E(null),children:"Cancel reply"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(w,{placeholder:l?"Write a reply...":"Write a comment...",value:j,onChange:s=>P(s.target.value),className:"flex-1"}),e.jsx(i,{onClick:oe,disabled:!j.trim(),children:e.jsx(K,{className:"w-4 h-4"})})]})]})]})]})})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(u,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Sign in to view the social feed"}),e.jsx("p",{className:"text-gray-600",children:"Join the conversation and connect with other citizens."})]})})})})}function Ue(){return e.jsx(be,{})}export{Ue as default};
