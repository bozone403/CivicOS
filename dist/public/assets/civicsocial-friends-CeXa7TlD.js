import{r as h,j as e}from"./ui-D2Re0T6U.js";import{y as G,q as H,u as J,g as w,Q as z,l as O,aj as K,B as p,J as V,aq as E,U as L,ar as M}from"./app-BXLB3SPJ.js";import{b as W,g as Y,h as Z,i as q,f as ee}from"./useCivicSocial-72ypDdfo.js";import{U as se}from"./user-check-BAlFvje1.js";import"./vendor-BtP0CW_r.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=G("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function me(){const{user:a}=H(),[,Q]=J(),{data:c,isLoading:ae,error:ie}=W(),g=(c==null?void 0:c.friends)||[],u=(c==null?void 0:c.received)||[],N=(c==null?void 0:c.sent)||[],k=Y(),P=Z(),y=q(),A=ee(),[f,R]=h.useState(""),[U,C]=h.useState([]),[X,$]=h.useState(!1),[I,S]=h.useState(null),[te,B]=h.useState(null);h.useEffect(()=>{if(f.length<2){C([]),S(null);return}const i=setTimeout(async()=>{$(!0),S(null);try{const t=await M(`/api/users/search?q=${encodeURIComponent(f)}`,"GET");if(t.users){const n=t.users.filter(r=>{const d=r.id===(a==null?void 0:a.id),m=g.some(l=>l.id===r.id),o=N.some(l=>l.friendId===r.id),x=u.some(l=>l.userId===r.id);return!d&&!m&&!o&&!x});C(n)}}catch{S("Failed to search users")}finally{$(!1)}},300);return()=>clearTimeout(i)},[f,g,N,u,a==null?void 0:a.id]);const _=async s=>{try{try{await M("/api/friends/request","POST",{toUserId:s})}catch{await k.mutateAsync({friendId:s})}A.mutate({userId:s,type:"friend_request",title:"New Friend Request",message:`${(a==null?void 0:a.firstName)||(a==null?void 0:a.email)||"A user"} sent you a friend request.`}),R(""),C([]),B(null)}catch{}},D=async s=>{try{await P.mutateAsync({friendId:s}),A.mutate({userId:s,type:"friend_accept",title:"Friend Request Accepted",message:`${(a==null?void 0:a.firstName)||(a==null?void 0:a.email)||"A user"} accepted your friend request!`})}catch{}},F=async s=>{try{await y.mutateAsync({friendId:s})}catch{}};return e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col gap-6",children:[e.jsxs(w,{className:"p-6 mb-4 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(z,{className:"w-8 h-8 text-civic-blue"}),e.jsx("div",{className:"font-bold text-2xl text-civic-blue",children:"Add Friends"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex gap-2 mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-10 pr-4 py-2 border rounded-lg bg-background focus:ring-2 focus:ring-civic-blue",placeholder:"Search users by name or email...",value:f,onChange:s=>R(s.target.value),disabled:k.isPending})]})}),f.length>=2&&e.jsx("div",{className:"absolute z-10 w-full bg-white dark:bg-slate-800 border rounded-lg shadow-lg max-h-60 overflow-y-auto",children:X?e.jsxs("div",{className:"p-4 text-center",children:[e.jsx(K,{className:"w-4 h-4 animate-spin mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Searching..."})]}):I?e.jsx("div",{className:"p-4 text-center text-red-500",children:e.jsx("p",{className:"text-sm",children:I})}):U.length>0?e.jsx("div",{className:"py-2",children:U.map(s=>{var i,t;return e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>Q(`/civicsocial/profile/${encodeURIComponent((s.username||"").trim())}`),children:[e.jsxs("div",{className:"w-10 h-10 bg-civic-blue rounded-full flex items-center justify-center text-white font-bold",children:[(i=s.firstName)==null?void 0:i[0],(t=s.lastName)==null?void 0:t[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.firstName," ",s.lastName," ",s.username?`(@${s.username})`:""]}),!s.username&&e.jsx("p",{className:"text-xs text-red-600",children:"Username missing â€” cannot open public profile"}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),s.civicPoints&&e.jsxs("p",{className:"text-xs text-civic-gold",children:["Civic Points: ",s.civicPoints]})]})]}),e.jsxs(p,{size:"sm",onClick:()=>_(s.id),disabled:k.isPending,className:"bg-civic-blue hover:bg-civic-gold",children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),"Add Friend"]})]},s.id)})}):e.jsx("div",{className:"p-4 text-center text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No users found"})})})]})]}),u.length>0&&e.jsxs(w,{className:"p-6 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(se,{className:"w-6 h-6 text-green-600"}),e.jsxs("h3",{className:"font-bold text-xl text-green-600",children:["Friend Requests (",u.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:u.map(s=>{var i,t,n,r,d,m,o,x,l,j,v,b;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold",children:((t=(i=s.user)==null?void 0:i.firstName)==null?void 0:t[0])||((r=(n=s.user)==null?void 0:n.lastName)==null?void 0:r[0])||((m=(d=s.user)==null?void 0:d.email)==null?void 0:m[0])||"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(o=s.user)!=null&&o.firstName&&((x=s.user)!=null&&x.lastName)?`${s.user.firstName} ${s.user.lastName}`:((l=s.user)==null?void 0:l.firstName)||((j=s.user)==null?void 0:j.lastName)||((v=s.user)==null?void 0:v.email)||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-500",children:((b=s.user)==null?void 0:b.email)||"No email"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{size:"sm",onClick:()=>D(s.userId),disabled:P.isPending,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Accept"]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>F(s.userId),disabled:y.isPending,children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),"Decline"]})]})]},s.id)})})]}),N.length>0&&e.jsxs(w,{className:"p-6 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(T,{className:"w-6 h-6 text-yellow-600"}),e.jsxs("h3",{className:"font-bold text-xl text-yellow-600",children:["Pending Requests (",N.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:N.map(s=>{var i,t,n,r,d,m,o,x,l,j,v,b;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-600 rounded-full flex items-center justify-center text-white font-bold",children:((t=(i=s.friend)==null?void 0:i.firstName)==null?void 0:t[0])||((r=(n=s.friend)==null?void 0:n.lastName)==null?void 0:r[0])||((m=(d=s.friend)==null?void 0:d.email)==null?void 0:m[0])||"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(o=s.friend)!=null&&o.firstName&&((x=s.friend)!=null&&x.lastName)?`${s.friend.firstName} ${s.friend.lastName}`:((l=s.friend)==null?void 0:l.firstName)||((j=s.friend)==null?void 0:j.lastName)||((v=s.friend)==null?void 0:v.email)||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-500",children:((b=s.friend)==null?void 0:b.email)||"No email"})]})]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>F(s.friendId),disabled:y.isPending,children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),"Cancel"]})]},s.id)})})]}),e.jsxs(w,{className:"p-6 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(L,{className:"w-6 h-6 text-civic-blue"}),e.jsxs("h3",{className:"font-bold text-xl text-civic-blue",children:["My Friends (",g.length,")"]})]}),g.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No friends yet. Start by searching for users above!"})]}):e.jsx("div",{className:"grid gap-3",children:g.map(s=>{var i,t,n;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-civic-blue rounded-full flex items-center justify-center text-white font-bold",children:((i=s.firstName)==null?void 0:i[0])||((t=s.lastName)==null?void 0:t[0])||((n=s.email)==null?void 0:n[0])||"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.firstName||s.lastName||s.email||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email||"No email"}),s.civicPoints&&e.jsxs("p",{className:"text-xs text-civic-gold",children:["Civic Points: ",s.civicPoints]})]})]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>F(s.id),disabled:y.isPending,className:"text-red-600 hover:text-red-700",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Remove"]})]},s.id)})})]})]})}export{me as default};
