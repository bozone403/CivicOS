import{j as e}from"./ui-wkHeCsE0.js";import{r as n}from"./vendor-DRd396Ms.js";import{c as x,q as J,p as G,x as W,G as L,r as X,D as Y,N as Z,B as l,a8 as _,a as ee,b as se,d as ae,e as te,I as g,l as ie,a4 as U,y as re,af as le,$ as ne,w as ce}from"./index-C0Em8wlQ.js";import{A as f,a as j,b as y}from"./avatar-C_zRlfN0.js";import{P as de}from"./phone-DxVHPFHe.js";import{I as oe}from"./image-DH3tyW60.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=x("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=x("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=x("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=x("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function we(){var O,k,M,D,P,R,T,E;const{user:p}=J(),{toast:F}=G(),N=W(),[i,H]=n.useState(null),[h,w]=n.useState(""),[u,K]=n.useState(""),v=n.useRef(null),[Q,V]=n.useState(!1),{data:b=[]}=L({queryKey:["/api/social/conversations"],queryFn:()=>Promise.resolve([{id:"1",participants:["user1","user2"],lastMessage:{id:"msg1",content:"Hey! How's the CivicOS platform working for you?",senderId:"user2",receiverId:"user1",timestamp:new Date(Date.now()-1e3*60*5).toISOString(),isRead:!1},unreadCount:1,participant:{firstName:"Sarah",lastName:"Johnson",profileImageUrl:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=150&h=150&fit=crop&crop=face",email:"sarah.johnson@email.com",isOnline:!0}},{id:"2",participants:["user1","user3"],lastMessage:{id:"msg2",content:"The voting system is really impressive!",senderId:"user1",receiverId:"user3",timestamp:new Date(Date.now()-1e3*60*30).toISOString(),isRead:!0},unreadCount:0,participant:{firstName:"Michael",lastName:"Chen",profileImageUrl:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face",email:"michael.chen@email.com",isOnline:!1}},{id:"3",participants:["user1","user4"],lastMessage:{id:"msg3",content:"Have you seen the latest political news?",senderId:"user4",receiverId:"user1",timestamp:new Date(Date.now()-1e3*60*60*2).toISOString(),isRead:!1},unreadCount:1,participant:{firstName:"Emma",lastName:"Davis",profileImageUrl:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop&crop=face",email:"emma.davis@email.com",isOnline:!0}}]),staleTime:1/0}),{data:I=[]}=L({queryKey:["/api/social/messages",i],queryFn:()=>Promise.resolve([{id:"msg1",content:"Hey! How's the CivicOS platform working for you?",senderId:"user2",receiverId:"user1",timestamp:new Date(Date.now()-1e3*60*5).toISOString(),isRead:!1,sender:{firstName:"Sarah",lastName:"Johnson",profileImageUrl:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=150&h=150&fit=crop&crop=face",email:"sarah.johnson@email.com"}},{id:"msg2",content:"It's amazing! The voting system is really intuitive.",senderId:"user1",receiverId:"user2",timestamp:new Date(Date.now()-1e3*60*4).toISOString(),isRead:!0},{id:"msg3",content:"I love how transparent everything is. The politician profiles are so detailed!",senderId:"user2",receiverId:"user1",timestamp:new Date(Date.now()-1e3*60*3).toISOString(),isRead:!1},{id:"msg4",content:"Exactly! And the CivicSocial feature makes it feel like a real community.",senderId:"user1",receiverId:"user2",timestamp:new Date(Date.now()-1e3*60*2).toISOString(),isRead:!0},{id:"msg5",content:"Have you tried the parallel voting system yet?",senderId:"user2",receiverId:"user1",timestamp:new Date(Date.now()-1e3*60*1).toISOString(),isRead:!1}]),enabled:!!i,staleTime:1/0}),S=X({mutationFn:s=>ce("/api/social/messages","POST",{content:s,receiverId:i,conversationId:i}),onSuccess:()=>{N.invalidateQueries({queryKey:["/api/social/messages",i]}),N.invalidateQueries({queryKey:["/api/social/conversations"]}),w("")},onError:s=>{F({title:"Failed to send message",description:s.message||"Please try again",variant:"destructive"})}});n.useEffect(()=>{var s;(s=v.current)==null||s.scrollIntoView({behavior:"smooth"})},[I]);const C=()=>{!h.trim()||!i||S.mutate(h)},$=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),C())},B=b.filter(s=>{var t,r;return((t=s.participant)==null?void 0:t.firstName.toLowerCase().includes(u.toLowerCase()))||((r=s.participant)==null?void 0:r.lastName.toLowerCase().includes(u.toLowerCase()))}),a=b.find(s=>s.id===i);return e.jsxs("div",{className:"h-screen flex bg-gray-50",children:[e.jsxs("div",{className:"w-80 bg-white border-r border-gray-200 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Messages"}),e.jsxs(Y,{open:Q,onOpenChange:V,children:[e.jsx(Z,{asChild:!0,children:e.jsx(l,{size:"sm",variant:"outline",children:e.jsx(_,{className:"w-4 h-4"})})}),e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsx(ae,{children:"New Conversation"}),e.jsx(te,{children:"Start a new conversation with another user"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(g,{placeholder:"Search users..."})})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(g,{placeholder:"Search conversations...",value:u,onChange:s=>K(s.target.value),className:"pl-10"})]})]}),e.jsx(U,{className:"flex-1",children:e.jsx("div",{className:"space-y-1 p-2",children:B.map(s=>{var t,r,c,d,o,m,q,z,A;return e.jsx("div",{onClick:()=>H(s.id),className:`p-3 rounded-lg cursor-pointer transition-colors ${i===s.id?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(f,{className:"w-12 h-12",children:[e.jsx(j,{src:(t=s.participant)==null?void 0:t.profileImageUrl}),e.jsxs(y,{children:[(c=(r=s.participant)==null?void 0:r.firstName)==null?void 0:c[0],(o=(d=s.participant)==null?void 0:d.lastName)==null?void 0:o[0]]})]}),((m=s.participant)==null?void 0:m.isOnline)&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-sm truncate",children:[(q=s.participant)==null?void 0:q.firstName," ",(z=s.participant)==null?void 0:z.lastName]}),s.lastMessage&&e.jsx("span",{className:"text-xs text-gray-500",children:new Date(s.lastMessage.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:(A=s.lastMessage)==null?void 0:A.content}),s.unreadCount>0&&e.jsx(re,{variant:"secondary",className:"mt-1",children:s.unreadCount})]})]})},s.id)})})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(f,{className:"w-10 h-10",children:[e.jsx(j,{src:(O=a==null?void 0:a.participant)==null?void 0:O.profileImageUrl}),e.jsxs(y,{children:[(M=(k=a==null?void 0:a.participant)==null?void 0:k.firstName)==null?void 0:M[0],(P=(D=a==null?void 0:a.participant)==null?void 0:D.lastName)==null?void 0:P[0]]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-semibold",children:[(R=a==null?void 0:a.participant)==null?void 0:R.firstName," ",(T=a==null?void 0:a.participant)==null?void 0:T.lastName]}),e.jsx("div",{className:"flex items-center space-x-2",children:(E=a==null?void 0:a.participant)!=null&&E.isOnline?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm text-green-600",children:"Online"})]}):e.jsx("span",{className:"text-sm text-gray-500",children:"Offline"})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(me,{className:"w-4 h-4"})})]})]})}),e.jsx(U,{className:"flex-1 p-4",children:e.jsxs("div",{className:"space-y-4",children:[I.map(s=>{var r,c,d,o,m;const t=s.senderId===(p==null?void 0:p.id);return e.jsx("div",{className:`flex ${t?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex items-end space-x-2 max-w-xs lg:max-w-md ${t?"flex-row-reverse space-x-reverse":""}`,children:[!t&&e.jsxs(f,{className:"w-8 h-8",children:[e.jsx(j,{src:(r=s.sender)==null?void 0:r.profileImageUrl}),e.jsxs(y,{children:[(d=(c=s.sender)==null?void 0:c.firstName)==null?void 0:d[0],(m=(o=s.sender)==null?void 0:o.lastName)==null?void 0:m[0]]})]}),e.jsxs("div",{className:`px-4 py-2 rounded-lg ${t?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("p",{className:`text-xs mt-1 ${t?"text-blue-100":"text-gray-500"}`,children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})},s.id)}),e.jsx("div",{ref:v})]})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1",children:e.jsx(g,{placeholder:"Type a message...",value:h,onChange:s=>w(s.target.value),onKeyPress:$,className:"w-full"})}),e.jsx(l,{onClick:C,disabled:!h.trim()||S.isPending,size:"sm",children:e.jsx(le,{className:"w-4 h-4"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No conversation selected"}),e.jsx("p",{className:"text-gray-500",children:"Choose a conversation from the sidebar to start messaging"})]})})})]})}export{we as default};
