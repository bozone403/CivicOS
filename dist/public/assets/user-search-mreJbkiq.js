import{r as u,j as e}from"./ui-D2Re0T6U.js";import{q as ie,p as te,E as re,K as k,r as M,g as c,h as y,i as b,n as w,j as d,L as S,I as P,B as n,l as R,U as E,Q as ne,D as le,a as ce,b as de,c as oe,d as me,X as D,Y as I,Z as K,v as g,M as V,o as xe,J as Q,aq as he,W as z,R as $,y as p,av as je}from"./app-CDP34tcP.js";import{T as ue,a as ge,b as C,c as F}from"./tabs-CDqV0ldV.js";import{S as pe,a as ve,b as fe,c as Ne,d as o}from"./select-CrjjNc36.js";import{F as ye}from"./filter-4s4JRBcM.js";import{S as be}from"./star-YtXdPjvx.js";import{U as O}from"./user-check-snwCHvQj.js";import{C as B}from"./clock-B6e33f1c.js";import{E as H}from"./external-link-C1maA0zd.js";import"./vendor-BtP0CW_r.js";import"./index-B4pxPuSB.js";function we(){var U;const{user:Se}=ie(),{toast:x}=te(),h=re(),[t,v]=u.useState({q:"",location:"",interests:"",civicLevel:""}),[Y,G]=u.useState("search"),[a,J]=u.useState(null),[X,_]=u.useState(!1),{data:l,isLoading:W}=k({queryKey:["users/search",t],queryFn:async()=>{const s=new URLSearchParams({q:t.q,location:t.location,interests:t.interests,civicLevel:t.civicLevel});return(await p(`/api/users/search?${s}`,"GET")).users||[]},enabled:t.q.length>0||t.location.length>0||t.civicLevel.length>0}),{data:q=[]}=k({queryKey:["users/suggestions"],queryFn:async()=>(await p("/api/users/suggestions","GET")).suggestions||[]}),Z=M({mutationFn:async({friendId:s,action:i})=>p("/api/social/friends","POST",{friendId:s,action:i}),onSuccess:(s,i)=>{const m=i.action,r={send:"Friend request sent",accept:"Friend request accepted",reject:"Friend request rejected",remove:"Friend removed"}[m];x({title:"Success",description:r}),h.invalidateQueries({queryKey:["users/search"]}),h.invalidateQueries({queryKey:["users/suggestions"]}),h.invalidateQueries({queryKey:["social/friends"]})},onError:s=>{x({title:"Action Failed",description:s.message||"Failed to perform action.",variant:"destructive"})}}),ee=M({mutationFn:async({recipientId:s,content:i})=>p("/api/social/messages","POST",{recipientId:s,content:i}),onSuccess:()=>{x({title:"Message Sent",description:"Your message has been sent successfully."})},onError:s=>{x({title:"Message Failed",description:s.message||"Failed to send message.",variant:"destructive"})}}),f=()=>{h.invalidateQueries({queryKey:["users/search",t]})},j=(s,i)=>{Z.mutate({friendId:s,action:i})},se=(s,i)=>{ee.mutate({recipientId:s,content:i})},L=s=>{switch(s==null?void 0:s.toLowerCase()){case"champion":return"bg-purple-500";case"expert":return"bg-blue-500";case"advocate":return"bg-green-500";case"active":return"bg-yellow-500";default:return"bg-gray-500"}},ae=s=>{const i=new Date(s),r=Math.floor((new Date().getTime()-i.getTime())/1e3);return r<60?"just now":r<3600?`${Math.floor(r/60)}m ago`:r<86400?`${Math.floor(r/3600)}h ago`:r<2592e3?`${Math.floor(r/86400)}d ago`:i.toLocaleDateString()},A=({user:s})=>{var i,m,r,T;return e.jsx(c,{className:"hover:shadow-lg transition-shadow duration-200",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs(D,{className:"h-16 w-16",children:[e.jsx(I,{src:s.profileImageUrl,alt:s.displayName}),e.jsx(K,{className:"bg-gradient-to-br from-blue-500 to-purple-600 text-white text-lg font-semibold",children:s.displayName.split(" ").map(N=>N[0]).join("").toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:s.displayName}),s.isVerified&&e.jsxs(g,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:[e.jsx(Q,{className:"w-3 h-3 mr-1"}),"Verified"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["@",s.username||"user"]}),s.civicLevel&&e.jsx(g,{variant:"outline",className:L(s.civicLevel),children:s.civicLevel})]}),s.bio&&e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:s.bio}),s.location&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-3",children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),s.location]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["Joined ",s.joinedAt?ae(s.joinedAt):"recently"]}),s.stats&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{children:[s.stats.posts," posts"]}),e.jsxs("span",{children:[s.stats.friends," friends"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>j(s.id,"send"),disabled:((i=s.friendship)==null?void 0:i.isFriend)||((m=s.friendship)==null?void 0:m.pendingRequest),children:(r=s.friendship)!=null&&r.isFriend?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Friends"]}):(T=s.friendship)!=null&&T.pendingRequest?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Pending"]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),"Add Friend"]})}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>se(s.id,"Hello! I found you on CivicOS."),children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Message"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{const N=s.username?`/civicsocial/profile/${s.username}`:`/profile/${s.id}`;window.open(N,"_blank")},children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"View Profile"]})]})]})]})]})})})};return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Find People"}),e.jsx("p",{className:"text-gray-600",children:"Connect with fellow citizens and build your civic network"})]}),e.jsxs(ue,{value:Y,onValueChange:G,children:[e.jsxs(ge,{className:"grid w-full grid-cols-3",children:[e.jsx(C,{value:"search",children:"Search Users"}),e.jsx(C,{value:"suggestions",children:"Suggestions"}),e.jsx(C,{value:"recent",children:"Recent Activity"})]}),e.jsxs(F,{value:"search",className:"mt-6",children:[e.jsxs(c,{className:"mb-6",children:[e.jsxs(y,{children:[e.jsx(b,{children:"Search Users"}),e.jsx(w,{children:"Find people by name, location, or interests"})]}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"search-name",children:"Name or Email"}),e.jsx(P,{id:"search-name",placeholder:"Search by name or email...",value:t.q,onChange:s=>v(i=>({...i,q:s.target.value})),onKeyPress:s=>s.key==="Enter"&&f()})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"search-location",children:"Location"}),e.jsx(P,{id:"search-location",placeholder:"City, province, or riding...",value:t.location,onChange:s=>v(i=>({...i,location:s.target.value})),onKeyPress:s=>s.key==="Enter"&&f()})]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"search-level",children:"Civic Level"}),e.jsxs(pe,{value:t.civicLevel,onValueChange:s=>v(i=>({...i,civicLevel:s})),children:[e.jsx(ve,{children:e.jsx(fe,{placeholder:"Any level"})}),e.jsxs(Ne,{children:[e.jsx(o,{value:"",children:"Any level"}),e.jsx(o,{value:"Registered",children:"Registered"}),e.jsx(o,{value:"Active",children:"Active"}),e.jsx(o,{value:"Advocate",children:"Advocate"}),e.jsx(o,{value:"Expert",children:"Expert"}),e.jsx(o,{value:"Champion",children:"Champion"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(n,{onClick:f,className:"w-full",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Search"]})})]})})]}),W?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Searching users..."})]}):(l==null?void 0:l.length)===0&&(t.q||t.location||t.civicLevel)?e.jsx(c,{children:e.jsxs(d,{className:"p-8 text-center",children:[e.jsx(E,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No users found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your search criteria or browse suggestions instead."})]})}):(l==null?void 0:l.length)>0?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Search Results (",l.length,")"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>_(!X),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Filters"]})]}),l.map(s=>e.jsx(A,{user:s},s.id))]}):e.jsx(c,{children:e.jsxs(d,{className:"p-8 text-center",children:[e.jsx(R,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Start searching"}),e.jsx("p",{className:"text-gray-600",children:"Enter a name, location, or civic level to find users."})]})})]}),e.jsx(F,{value:"suggestions",className:"mt-6",children:e.jsxs(c,{children:[e.jsxs(y,{children:[e.jsx(b,{children:"People You May Know"}),e.jsx(w,{children:"Users with similar interests or location"})]}),e.jsx(d,{children:q.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(E,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No suggestions yet"}),e.jsx("p",{className:"text-gray-600",children:"Complete your profile to get personalized suggestions."})]}):e.jsx("div",{className:"space-y-4",children:q.map(s=>e.jsx(A,{user:s},s.id))})})]})}),e.jsx(F,{value:"recent",className:"mt-6",children:e.jsxs(c,{children:[e.jsxs(y,{children:[e.jsx(b,{children:"Recent Activity"}),e.jsx(w,{children:"Recent user activity and engagement"})]}),e.jsx(d,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ne,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No recent activity"}),e.jsx("p",{className:"text-gray-600",children:"Activity feed will appear here as users engage with the platform."})]})})]})})]}),e.jsx(le,{open:!!a,onOpenChange:()=>J(null),children:e.jsxs(ce,{className:"max-w-2xl",children:[e.jsxs(de,{children:[e.jsx(oe,{children:"User Profile"}),e.jsx(me,{children:"View user profile details and manage friendship status."})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(D,{className:"w-16 h-16",children:[e.jsx(I,{src:a.profileImageUrl}),e.jsx(K,{className:"bg-blue-600 text-lg",children:(U=a.displayName[0])==null?void 0:U.toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:a.displayName}),a.isVerified&&e.jsxs(g,{variant:"secondary",children:[e.jsx(be,{className:"w-3 h-3 mr-1"}),"Verified"]}),e.jsx(g,{className:L(a.civicLevel||""),children:a.civicLevel||"Registered"})]}),a.location&&e.jsxs("div",{className:"flex items-center gap-1 text-gray-600 mb-2",children:[e.jsx(V,{className:"w-4 h-4"}),a.location]}),a.stats&&e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:[a.stats.posts," posts"]}),e.jsxs("span",{children:[a.stats.friends," friends"]}),e.jsxs("span",{children:[a.stats.activities," activities"]})]})]})]}),e.jsx(xe,{}),e.jsxs("div",{className:"flex gap-2",children:[a.friendship&&e.jsx(e.Fragment,{children:a.friendship.isFriend?e.jsxs(n,{variant:"outline",disabled:!0,children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Friends"]}):a.friendship.pendingRequest?e.jsxs(n,{variant:"outline",disabled:!0,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Request Sent"]}):a.friendship.receivedRequest?e.jsxs(e.Fragment,{children:[e.jsxs(n,{onClick:()=>j(a.id,"accept"),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Accept Request"]}),e.jsxs(n,{variant:"outline",onClick:()=>j(a.id,"reject"),children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Decline"]})]}):a.friendship.canSendRequest?e.jsxs(n,{onClick:()=>j(a.id,"send"),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Add Friend"]}):null}),e.jsxs(n,{variant:"outline",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Send Message"]}),e.jsxs(n,{variant:"outline",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"View Profile"]})]})]})]})})]})}function Ee(){return e.jsx(je,{children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Find CivicOS Users"}),e.jsx("p",{className:"text-gray-600",children:"Search for other civic-minded individuals to connect with and build your civic network."})]}),e.jsx(we,{})]})})})}export{Ee as default};
