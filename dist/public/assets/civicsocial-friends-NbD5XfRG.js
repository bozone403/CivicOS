var H=Object.defineProperty;var J=(a,t,r)=>t in a?H(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r;var I=(a,t,r)=>J(a,typeof t!="symbol"?t+"":t,r);import{j as e}from"./ui-B-8yHimL.js";import{r as h}from"./vendor-DRd396Ms.js";import{c as T,ag as Q,r as _,h as j,ah as z,m as G,ai as K,B as p,z as V,aj as E,U as L}from"./index-Bf5EIYwi.js";import{a as W,f as Y,g as Z,h as ee,e as se}from"./useCivicSocial-dOj3eCjH.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=T("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=T("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);class ae{constructor(){I(this,"baseURL");this.baseURL=Q.apiUrl}async request(t,r={}){const S=`${this.baseURL}${t}`,d={credentials:"include",headers:{"Content-Type":"application/json",...r.headers},...r};return fetch(S,d)}async get(t){return this.request(t,{method:"GET"})}async post(t,r){return this.request(t,{method:"POST",body:r?JSON.stringify(r):void 0})}async put(t,r){return this.request(t,{method:"PUT",body:r?JSON.stringify(r):void 0})}async delete(t){return this.request(t,{method:"DELETE"})}}const ie=new ae;function me(){const{user:a}=_(),{data:t,isLoading:r,error:S}=W(),d=(t==null?void 0:t.friends)||[],g=(t==null?void 0:t.received)||[],u=(t==null?void 0:t.sent)||[],b=Y(),C=Z(),y=ee(),U=se(),[f,P]=h.useState(""),[F,v]=h.useState([]),[$,A]=h.useState(!1),[R,w]=h.useState(null),[re,O]=h.useState(null);h.useEffect(()=>{if(f.length<2){v([]),w(null);return}const i=setTimeout(async()=>{A(!0),w(null);try{const n=await(await ie.get(`/api/users/search?q=${encodeURIComponent(f)}`)).json();if(n.users){const o=n.users.filter(l=>{const m=l.id===(l==null?void 0:l.id),x=d.some(N=>N.id===l.id),B=u.some(N=>N.friendId===l.id),D=g.some(N=>N.userId===l.id);return!m&&!x&&!B&&!D});v(o)}}catch{w("Failed to search users")}finally{A(!1)}},300);return()=>clearTimeout(i)},[f,d,u,g,a==null?void 0:a.id]);const X=async s=>{try{await b.mutateAsync({friendId:parseInt(s)}),U.mutate({userId:s,type:"friend_request",title:"New Friend Request",message:`${(a==null?void 0:a.firstName)||(a==null?void 0:a.email)||"A user"} sent you a friend request.`}),P(""),v([]),O(null)}catch{}},q=async s=>{try{await C.mutateAsync({friendId:parseInt(s)}),U.mutate({userId:s,type:"friend_accept",title:"Friend Request Accepted",message:`${(a==null?void 0:a.firstName)||(a==null?void 0:a.email)||"A user"} accepted your friend request!`})}catch{}},k=async s=>{try{await y.mutateAsync({friendId:parseInt(s)})}catch{}};return e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col gap-6",children:[e.jsxs(j,{className:"p-6 mb-4 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(z,{className:"w-8 h-8 text-civic-blue"}),e.jsx("div",{className:"font-bold text-2xl text-civic-blue",children:"Add Friends"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex gap-2 mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-10 pr-4 py-2 border rounded-lg bg-background focus:ring-2 focus:ring-civic-blue",placeholder:"Search users by name or email...",value:f,onChange:s=>P(s.target.value),disabled:b.isPending})]})}),f.length>=2&&e.jsx("div",{className:"absolute z-10 w-full bg-white dark:bg-slate-800 border rounded-lg shadow-lg max-h-60 overflow-y-auto",children:$?e.jsxs("div",{className:"p-4 text-center",children:[e.jsx(K,{className:"w-4 h-4 animate-spin mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Searching..."})]}):R?e.jsx("div",{className:"p-4 text-center text-red-500",children:e.jsx("p",{className:"text-sm",children:R})}):F.length>0?e.jsx("div",{className:"py-2",children:F.map(s=>{var i,c;return e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-civic-blue rounded-full flex items-center justify-center text-white font-bold",children:[(i=s.firstName)==null?void 0:i[0],(c=s.lastName)==null?void 0:c[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),s.civicPoints&&e.jsxs("p",{className:"text-xs text-civic-gold",children:["Civic Points: ",s.civicPoints]})]})]}),e.jsxs(p,{size:"sm",onClick:()=>X(s.id),disabled:b.isPending,className:"bg-civic-blue hover:bg-civic-gold",children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),"Add Friend"]})]},s.id)})}):e.jsx("div",{className:"p-4 text-center text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No users found"})})})]})]}),g.length>0&&e.jsxs(j,{className:"p-6 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(te,{className:"w-6 h-6 text-green-600"}),e.jsxs("h3",{className:"font-bold text-xl text-green-600",children:["Friend Requests (",g.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:g.map(s=>{var i,c,n,o,l,m,x;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold",children:[(c=(i=s.user)==null?void 0:i.firstName)==null?void 0:c[0],(o=(n=s.user)==null?void 0:n.lastName)==null?void 0:o[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[(l=s.user)==null?void 0:l.firstName," ",(m=s.user)==null?void 0:m.lastName]}),e.jsx("p",{className:"text-sm text-gray-500",children:(x=s.user)==null?void 0:x.email})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{size:"sm",onClick:()=>q(s.userId),disabled:C.isPending,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Accept"]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>k(s.userId),disabled:y.isPending,children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),"Decline"]})]})]},s.id)})})]}),u.length>0&&e.jsxs(j,{className:"p-6 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(M,{className:"w-6 h-6 text-yellow-600"}),e.jsxs("h3",{className:"font-bold text-xl text-yellow-600",children:["Pending Requests (",u.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:u.map(s=>{var i,c,n,o,l,m,x;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-yellow-600 rounded-full flex items-center justify-center text-white font-bold",children:[(c=(i=s.friend)==null?void 0:i.firstName)==null?void 0:c[0],(o=(n=s.friend)==null?void 0:n.lastName)==null?void 0:o[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[(l=s.friend)==null?void 0:l.firstName," ",(m=s.friend)==null?void 0:m.lastName]}),e.jsx("p",{className:"text-sm text-gray-500",children:(x=s.friend)==null?void 0:x.email})]})]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>k(s.friendId),disabled:y.isPending,children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),"Cancel"]})]},s.id)})})]}),e.jsxs(j,{className:"p-6 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(L,{className:"w-6 h-6 text-civic-blue"}),e.jsxs("h3",{className:"font-bold text-xl text-civic-blue",children:["My Friends (",d.length,")"]})]}),d.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No friends yet. Start by searching for users above!"})]}):e.jsx("div",{className:"grid gap-3",children:d.map(s=>{var i,c;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-civic-blue rounded-full flex items-center justify-center text-white font-bold",children:[(i=s.firstName)==null?void 0:i[0],(c=s.lastName)==null?void 0:c[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),s.civicPoints&&e.jsxs("p",{className:"text-xs text-civic-gold",children:["Civic Points: ",s.civicPoints]})]})]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>k(s.id),disabled:y.isPending,className:"text-red-600 hover:text-red-700",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Remove"]})]},s.id)})})]})]})}export{me as default};
