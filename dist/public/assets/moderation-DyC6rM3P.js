import{j as e}from"./ui-CDUWW_Ri.js";import{r as d}from"./vendor-1XCZ5AD1.js";import{z as T,E as _,p as Q,at as R,q as z,K as D,r as K,B as v,g as h,h as f,i as p,j as y}from"./index-Bn1P6P6N.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=T("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);function B({required:n}){const r=Array.isArray(n)?n:[n];return e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded border bg-amber-50 text-amber-900",children:[e.jsx($,{className:"w-4 h-4 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:["This action requires the following permission(s):",e.jsx("ul",{className:"list-disc ml-5 mt-1",children:r.map(l=>e.jsx("li",{children:e.jsx("code",{children:l})},l))})]})]})}function I(){var g,C,w,A,L,E;const n=_(),{toast:r}=Q(),l=R(),{user:a}=z(),[u,H]=d.useState(25),[x,N]=d.useState(0),[m,S]=d.useState(""),{data:t,isLoading:q,isError:M,error:O}=D({queryKey:["admin","moderation-dashboard",u,x],queryFn:async()=>await l.request({method:"GET",url:`/api/admin/moderation-dashboard?limit=${u}&offset=${x}`}),enabled:!!(a!=null&&a.isAdmin)}),k=K({mutationFn:async s=>{await l.request({method:"DELETE",url:`/api/moderation/comments/${s}`})},onSuccess:()=>{n.invalidateQueries({queryKey:["admin","moderation-dashboard"]}),r({title:"Comment removed"})},onError:()=>r({title:"Failed to remove comment",variant:"destructive"})});if(!(a!=null&&a.isAdmin))return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{children:"Access denied."}),e.jsx(B,{required:["view_analytics","reject_content","moderate_comments"]})]});if(q)return e.jsx("div",{className:"p-6",children:"Loading…"});if(M)return e.jsx("div",{className:"p-6",children:"Failed to load dashboard."});const P=d.useMemo(()=>{var i,o;const s=m.trim().toLowerCase();return s?(((o=t==null?void 0:t.recent)==null?void 0:o.posts)||[]).filter(j=>(j.content||"").toLowerCase().includes(s)):((i=t==null?void 0:t.recent)==null?void 0:i.posts)||[]},[t,m]),F=d.useMemo(()=>{var i,o;const s=m.trim().toLowerCase();return s?(((o=t==null?void 0:t.recent)==null?void 0:o.comments)||[]).filter(j=>(j.content||"").toLowerCase().includes(s)):((i=t==null?void 0:t.recent)==null?void 0:i.comments)||[]},[t,m]);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{value:m,onChange:s=>S(s.target.value),placeholder:"Filter posts/comments…",className:"w-full max-w-md border rounded px-3 py-2"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"secondary",onClick:()=>N(s=>Math.max(0,s-u)),disabled:x===0,children:"Prev"}),e.jsx(v,{variant:"secondary",onClick:()=>N(s=>s+u),children:"Next"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx(c,{title:"Users",value:(g=t==null?void 0:t.summary)==null?void 0:g.users}),e.jsx(c,{title:"Posts",value:(C=t==null?void 0:t.summary)==null?void 0:C.posts}),e.jsx(c,{title:"Comments",value:(w=t==null?void 0:t.summary)==null?void 0:w.comments}),e.jsx(c,{title:"Notifications",value:(A=t==null?void 0:t.summary)==null?void 0:A.notifications}),e.jsx(c,{title:"News",value:(L=t==null?void 0:t.summary)==null?void 0:L.news}),e.jsx(c,{title:"Votes",value:(E=t==null?void 0:t.summary)==null?void 0:E.votes})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(p,{children:"Recent Posts"})}),e.jsx(y,{children:e.jsx("ul",{className:"divide-y",children:P.map(s=>{var i;return e.jsx("li",{className:"py-3 flex items-center justify-between",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:((i=s.content)==null?void 0:i.slice(0,120))||"Untitled"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt||s.created_at).toLocaleString()})]})},s.id)})})})]}),e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(p,{children:"Recent Comments"})}),e.jsx(y,{children:e.jsx("ul",{className:"divide-y",children:F.map(s=>{var i;return e.jsxs("li",{className:"py-3 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:((i=s.content)==null?void 0:i.slice(0,160))||"—"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt||s.created_at).toLocaleString()})]}),e.jsx(v,{variant:"destructive",size:"sm",onClick:()=>k.mutate(s.id),children:"Remove"})]},s.id)})})})]})]})}function c({title:n,value:r}){return e.jsxs(h,{children:[e.jsx(f,{className:"py-4",children:e.jsx(p,{className:"text-sm text-muted-foreground",children:n})}),e.jsx(y,{className:"pt-0 pb-4",children:e.jsx("div",{className:"text-2xl font-semibold",children:r??0})})]})}export{I as default};
