import{r as l,j as e}from"./ui-D2Re0T6U.js";import{p as de,q as oe,E as xe,K as me,r as U,g as P,j as T,T as I,B as n,l as he,I as m,h as ue,i as je,v as R,C as z,U as M,a2 as $,_ as ge,D as B,a as O,b as K,c as Q,d as V,L as d,Z as ve,y as D}from"./app-BYR0VHFY.js";import{S as h,a as u,b as j,c as g,d as a}from"./select-DJnustoI.js";import{P as pe}from"./progress-DrGJdjAB.js";import{P as ye}from"./plus-WEzh7H6h.js";import{C as _}from"./clock-CxvTlMxY.js";import{B as Y}from"./bookmark-GgFnaFTE.js";import{T as fe}from"./target-VOQPC30D.js";import{C as Ne}from"./calendar-B9vE9byU.js";import"./vendor-BtP0CW_r.js";import"./index-B4pxPuSB.js";function qe(){var H;const{toast:r}=de(),{user:v}=oe(),F=xe(),[p,G]=l.useState(""),[y,Z]=l.useState("all"),[f,J]=l.useState("all"),[N,W]=l.useState("all"),[t,X]=l.useState(null),[ee,o]=l.useState(!1),[we,E]=l.useState(!1),[se,ae]=l.useState(""),{data:w=[],isLoading:te,error:k}=me({queryKey:["/api/petitions"],queryFn:async()=>{try{const s=await D("/api/petitions","GET");return s&&typeof s=="object"&&"data"in s?Array.isArray(s.data)?s.data:[]:Array.isArray(s)?s:[]}catch(s){return console.error("Failed to fetch petitions:",s),[]}},staleTime:300*1e3,retry:2}),c=U({mutationFn:async s=>await D("/api/petitions","POST",s),onSuccess:()=>{r({title:"Success",description:"Your petition has been created successfully."}),o(!1),F.invalidateQueries({queryKey:["/api/petitions"]})},onError:s=>{r({title:"Error",description:(s==null?void 0:s.message)||"Failed to create petition. Please try again.",variant:"destructive"})}}),ie=U({mutationFn:async s=>await D(`/api/petitions/${s}/sign`,"POST",{comment:se}),onSuccess:()=>{r({title:"Success",description:"You have successfully signed this petition!"}),E(!1),ae(""),F.invalidateQueries({queryKey:["/api/petitions"]})},onError:s=>{r({title:"Error",description:(s==null?void 0:s.message)||"Failed to sign petition. Please try again.",variant:"destructive"})}}),L=async()=>{if(!v){r({title:"Authentication required",description:"Please log in to sign petitions.",variant:"destructive"});return}E(!0)},A=async()=>{if(!v){r({title:"Authentication required",description:"Please log in to save petitions.",variant:"destructive"});return}r({title:"Feature coming soon",description:"Save functionality will be available soon."})},S=async(s,i)=>{const x=w.find(ce=>ce.id===s);if(!x)return;const b=`${window.location.origin}/petitions?id=${s}`,C=`Sign this petition: ${x.title} on CivicOS`;i==="twitter"?window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(C)}&url=${encodeURIComponent(b)}`,"_blank"):i==="civicsocial"&&r({title:"Feature coming soon",description:"CivicSocial sharing will be available soon."})},ne=async()=>{if(!v){r({title:"Authentication required",description:"Please log in to create petitions.",variant:"destructive"});return}c.mutate({title:"New Petition Title",description:"New Petition Description",category:"Democracy",targetSignatures:500,deadlineDate:"2024-12-31"})},q=w.filter(s=>{const i=s.title.toLowerCase().includes(p.toLowerCase())||s.description.toLowerCase().includes(p.toLowerCase()),x=y==="all"||s.category===y,b=f==="all"||s.status===f,C=N==="all"||s.urgency===N;return i&&x&&b&&C}),re=s=>{switch(s.toLowerCase()){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},le=(s,i)=>Math.min(s/i*100,100);return te?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"animate-pulse space-y-6",children:[...Array(6)].map((s,i)=>e.jsx(P,{children:e.jsxs(T,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})},i))})}):k&&w.length===0?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(P,{children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(I,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Petitions"}),e.jsx("p",{className:"text-gray-600",children:"Unable to load petitions at this time. Please try again later."})]})})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Canadian Petitions"}),e.jsx("p",{className:"text-gray-600",children:"Make your voice heard on important issues affecting Canadians"})]}),e.jsxs(n,{onClick:()=>o(!0),className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Create Petition"]})]}),k&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx(I,{className:"inline w-4 h-4 mr-1"}),"Showing sample data due to connection issues. Some features may be limited."]})}),!1]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(m,{placeholder:"Search petitions...",value:p,onChange:s=>G(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(h,{value:y,onValueChange:Z,children:[e.jsx(u,{children:e.jsx(j,{placeholder:"Filter by category"})}),e.jsxs(g,{children:[e.jsx(a,{value:"all",children:"All Categories"}),e.jsx(a,{value:"Healthcare",children:"Healthcare"}),e.jsx(a,{value:"Environment",children:"Environment"}),e.jsx(a,{value:"Democracy",children:"Democracy"}),e.jsx(a,{value:"Indigenous Rights",children:"Indigenous Rights"}),e.jsx(a,{value:"Housing",children:"Housing"}),e.jsx(a,{value:"Economy",children:"Economy"}),e.jsx(a,{value:"Transparency",children:"Transparency"})]})]})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(h,{value:f,onValueChange:J,children:[e.jsx(u,{children:e.jsx(j,{placeholder:"Filter by status"})}),e.jsxs(g,{children:[e.jsx(a,{value:"all",children:"All Statuses"}),e.jsx(a,{value:"active",children:"Active"}),e.jsx(a,{value:"closed",children:"Closed"}),e.jsx(a,{value:"archived",children:"Archived"})]})]})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(h,{value:N,onValueChange:W,children:[e.jsx(u,{children:e.jsx(j,{placeholder:"Filter by urgency"})}),e.jsxs(g,{children:[e.jsx(a,{value:"all",children:"All Urgencies"}),e.jsx(a,{value:"critical",children:"Critical"}),e.jsx(a,{value:"high",children:"High"}),e.jsx(a,{value:"medium",children:"Medium"})]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:q.map(s=>e.jsxs(P,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(ue,{className:"pb-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(je,{className:"text-lg mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{variant:"outline",className:"text-xs",children:s.category}),e.jsx(R,{className:`text-xs ${re(s.urgency)}`,children:s.urgency}),s.verified&&e.jsx(z,{className:"h-4 w-4 text-green-600"})]})]})})}),e.jsxs(T,{className:"pb-6",children:[e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:s.description}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[s.currentSignatures.toLocaleString()," / ",s.targetSignatures.toLocaleString()]})]}),e.jsx(pe,{value:le(s.currentSignatures,s.targetSignatures),className:"h-2"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.currentSignatures.toLocaleString()," signatures"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.daysLeft," days left"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-100",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s.creator}),s.verified&&e.jsx(z,{className:"w-4 h-4 text-green-600"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>A(),disabled:c.isPending,children:[e.jsx(Y,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>S(s.id,"twitter"),disabled:c.isPending,children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Share"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>S(s.id,"civicsocial"),children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"CivicSocial"]})]}),e.jsx(n,{size:"sm",onClick:()=>L(),disabled:ie.isPending,children:"Sign Petition"})]})]})]},s.id))}),q.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No petitions found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your search or filter criteria."})]}),e.jsx(B,{open:!!t,onOpenChange:s=>!s&&X(null),children:e.jsx(O,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:t&&e.jsxs("div",{children:[e.jsxs(K,{children:[e.jsx(Q,{children:t.title}),e.jsx(V,{children:t.description})]}),e.jsxs("div",{className:"space-y-6 mt-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{children:[t.currentSignatures.toLocaleString()," signatures"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{children:[t.daysLeft," days left"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:t.status})]})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Key Supporters"}),e.jsx("div",{className:"space-y-2",children:(H=t.supporters)==null?void 0:H.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-600",children:s.role})]}),e.jsx("span",{className:"text-xs text-gray-500",children:s.location})]},i))})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["Created by: ",t.creator]}),e.jsxs("span",{children:[t.daysLeft," days remaining"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>A(),children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Save"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>S(t.id,"twitter"),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Share"]}),e.jsx(n,{size:"sm",onClick:()=>L(),children:"Sign Petition"})]})]})]})]})})}),e.jsx(B,{open:ee,onOpenChange:o,children:e.jsxs(O,{className:"max-w-2xl",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Create New Petition"}),e.jsx(V,{children:"Start a petition to make your voice heard on important issues."})]}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"title",children:"Petition Title *"}),e.jsx(m,{id:"title",placeholder:"Enter petition title..."})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"description",children:"Description *"}),e.jsx(ve,{id:"description",placeholder:"Describe your petition and why it's important...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"category",children:"Category"}),e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(j,{})}),e.jsxs(g,{children:[e.jsx(a,{value:"Democracy",children:"Democracy"}),e.jsx(a,{value:"Healthcare",children:"Healthcare"}),e.jsx(a,{value:"Environment",children:"Environment"}),e.jsx(a,{value:"Housing",children:"Housing"}),e.jsx(a,{value:"Economy",children:"Economy"}),e.jsx(a,{value:"Indigenous Rights",children:"Indigenous Rights"}),e.jsx(a,{value:"Transparency",children:"Transparency"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"targetSignatures",children:"Target Signatures"}),e.jsx(m,{id:"targetSignatures",type:"number",placeholder:"500"})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"deadlineDate",children:"Deadline (Optional)"}),e.jsx(m,{id:"deadlineDate",type:"date"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx(n,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(n,{onClick:ne,disabled:c.isPending,children:c.isPending?"Creating...":"Create Petition"})]})]})})]})}export{qe as default};
