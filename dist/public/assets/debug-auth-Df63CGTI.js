import{j as s}from"./ui-CDUWW_Ri.js";import{r as n}from"./vendor-1XCZ5AD1.js";import{q as S,am as r,g as i,h as o,i as c,v as T,j as l,B as d,y as k}from"./index-C-Q3Nhrw.js";function R(){const{user:h,isAuthenticated:x,isLoading:m}=S(),[p,v]=n.useState({}),[u,f]=n.useState({}),[g,j]=n.useState(!1),a=localStorage.getItem("civicos-jwt");n.useEffect(()=>{v({token:a?`${a.substring(0,20)}...`:"None",tokenLength:(a==null?void 0:a.length)||0,apiUrl:r.apiUrl,userAgent:navigator.userAgent,timestamp:new Date().toISOString(),localStorage:{hasToken:!!a,tokenKey:"civicos-jwt",allKeys:Object.keys(localStorage)}})},[a]);const b=async()=>{j(!0);const t={};try{try{const e=await fetch(`${r.apiUrl}/api/auth/env-check`);t.backendReachable={status:e.ok,statusText:e.statusText,data:await e.json()}}catch(e){t.backendReachable={status:!1,error:e instanceof Error?e.message:String(e)}}try{const e=await fetch(`${r.apiUrl}/api/auth/debug-jwt`);t.jwtSecret={status:e.ok,statusText:e.statusText,data:await e.json()}}catch(e){t.jwtSecret={status:!1,error:e instanceof Error?e.message:String(e)}}if(a)try{const e=await k("/api/auth/user","GET");t.tokenValidation={status:!0,data:e}}catch(e){t.tokenValidation={status:!1,error:e instanceof Error?e.message:String(e)}}else t.tokenValidation={status:!1,error:"No token to test"};try{const e=await fetch(`${r.apiUrl}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:"test@example.com",password:"wrongpassword"})});t.loginEndpoint={status:e.ok,statusCode:e.status,statusText:e.statusText}}catch(e){t.loginEndpoint={status:!1,error:e instanceof Error?e.message:String(e)}}}catch(e){t.generalError=e instanceof Error?e.message:String(e)}f(t),j(!1)},N=()=>{localStorage.removeItem("civicos-jwt"),window.location.reload()},w=()=>{window.location.href="/auth"},y=()=>{window.location.reload()};return s.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:s.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[s.jsxs(i,{children:[s.jsx(o,{children:s.jsxs(c,{className:"flex items-center gap-2",children:["🔍 Authentication Debug Panel",s.jsx(T,{variant:x?"default":"destructive",children:x?"Authenticated":"Not Authenticated"})]})}),s.jsxs(l,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Authentication State"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{children:[s.jsx("strong",{children:"Loading:"})," ",m?"Yes":"No"]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Authenticated:"})," ",x?"Yes":"No"]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Token exists:"})," ",a?"Yes":"No"]}),s.jsxs("div",{children:[s.jsx("strong",{children:"User:"})," ",h?`${h.firstName} ${h.lastName}`:"None"]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Configuration"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{children:[s.jsx("strong",{children:"API URL:"})," ",r.apiUrl]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Environment:"})," ",r.environment]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Version:"})," ",r.version]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Token Length:"})," ",(a==null?void 0:a.length)||0]})]})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(d,{onClick:b,disabled:g,children:g?"Running Tests...":"Run Diagnostic Tests"}),s.jsx(d,{onClick:N,variant:"outline",children:"Clear Token"}),s.jsx(d,{onClick:w,variant:"outline",children:"Go to Auth"}),s.jsx(d,{onClick:y,variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"Force Refresh"})]})]})]}),s.jsxs(i,{children:[s.jsx(o,{children:s.jsx(c,{children:"Debug Information"})}),s.jsx(l,{children:s.jsx("pre",{className:"text-xs bg-gray-100 p-4 rounded overflow-auto max-h-64",children:JSON.stringify(p,null,2)})})]}),Object.keys(u).length>0&&s.jsxs(i,{children:[s.jsx(o,{children:s.jsx(c,{children:"Test Results"})}),s.jsx(l,{children:s.jsx("div",{className:"space-y-4",children:Object.entries(u).map(([t,e])=>s.jsxs("div",{className:"border rounded p-3",children:[s.jsx("h4",{className:"font-semibold mb-2 capitalize",children:t.replace(/([A-Z])/g," $1")}),s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{children:[s.jsx("strong",{children:"Status:"})," ",e.status?"✅ Pass":"❌ Fail"]}),e.error&&s.jsxs("div",{children:[s.jsx("strong",{children:"Error:"})," ",e.error]}),e.statusCode&&s.jsxs("div",{children:[s.jsx("strong",{children:"Status Code:"})," ",e.statusCode]}),e.data&&s.jsxs("div",{children:[s.jsx("strong",{children:"Data:"}),s.jsx("pre",{className:"text-xs bg-gray-100 p-2 rounded mt-1 overflow-auto",children:JSON.stringify(e.data,null,2)})]})]})]},t))})})]}),s.jsxs(i,{children:[s.jsx(o,{children:s.jsx(c,{children:"Authentication Debug Logs"})}),s.jsx(l,{children:s.jsx("div",{className:"max-h-64 overflow-y-auto",children:window.authDebug?s.jsx("div",{className:"space-y-2",children:window.authDebug.map((t,e)=>s.jsxs("div",{className:"text-xs border-b pb-1",children:[s.jsx("div",{className:"text-gray-500",children:t.timestamp}),s.jsx("div",{className:"text-blue-600",children:t.message}),t.data&&s.jsx("pre",{className:"text-xs bg-gray-100 p-1 rounded mt-1",children:JSON.stringify(t.data,null,2)})]},e))}):s.jsx("div",{className:"text-gray-500",children:"No debug logs available"})})})]})]})})}export{R as default};
