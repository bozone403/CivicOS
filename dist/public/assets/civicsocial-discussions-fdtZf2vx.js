import{j as e}from"./ui-B-8yHimL.js";import{r}from"./vendor-DRd396Ms.js";import{c as Y,p as $,z as J,H as E,r as p,D as F,O as X,B as a,a as R,b as q,d as O,e as Z,I as _,P as A,g as L,j as M,a5 as y,h as ee,Q as se,W as te,E as v,G as ae,a4 as Q,F as ie,w as c}from"./index-C5-i7nqW.js";import{S as le,a as ne,b as re,c as ce,d as oe}from"./select-Cr4-E9RT.js";import"./index-Bfvbq57u.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=Y("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function je(){const[o,f]=r.useState("all"),[K,d]=r.useState(!1),[l,x]=r.useState(null),[u,N]=r.useState(""),[t,m]=r.useState({title:"",content:"",categoryId:"",billId:""}),{toast:n}=$(),h=J(),{data:B=[]}=E({queryKey:["/api/forum/categories"],queryFn:()=>c("/api/forum/categories","GET")}),{data:b=[],isLoading:H}=E({queryKey:["/api/forum/posts"],queryFn:()=>c("/api/forum/posts","GET")}),j=p({mutationFn:s=>c("/api/forum/posts","POST",s),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/forum/posts"]}),d(!1),m({title:"",content:"",categoryId:"",billId:""}),n({title:"Success",description:"Discussion created successfully!"})},onError:s=>{n({title:"Error",description:s.message||"Failed to create discussion",variant:"destructive"})}}),g=p({mutationFn:s=>c("/api/forum/replies","POST",s),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/forum/posts"]}),N(""),x(null),n({title:"Success",description:"Reply posted successfully!"})},onError:s=>{n({title:"Error",description:s.message||"Failed to post reply",variant:"destructive"})}}),G=p({mutationFn:s=>c(`/api/forum/posts/${s}/like`,"POST"),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/forum/posts"]})}}),V=()=>{if(!t.title.trim()||!t.content.trim()||!t.categoryId){n({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}j.mutate({title:t.title,content:t.content,categoryId:parseInt(t.categoryId),billId:t.billId?parseInt(t.billId):void 0})},U=()=>{!u.trim()||!l||g.mutate({content:u,postId:l.id})},W=s=>{G.mutate(s)},C=b.filter(s=>o==="all"||s.categoryId===parseInt(o)),w=B.sort((s,i)=>s.sortOrder-i.sortOrder);return b.sort((s,i)=>s.isSticky&&!i.isSticky?-1:!s.isSticky&&i.isSticky?1:new Date(i.createdAt).getTime()-new Date(s.createdAt).getTime()),e.jsx("div",{className:"flex-1 bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Community Discussions"}),e.jsx("p",{className:"text-gray-600",children:"Engage in meaningful conversations about Canadian politics and civic issues"})]}),e.jsxs(F,{open:K,onOpenChange:d,children:[e.jsx(X,{asChild:!0,children:e.jsxs(a,{className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"New Discussion"]})}),e.jsxs(R,{className:"max-w-2xl",children:[e.jsxs(q,{children:[e.jsx(O,{children:"Start a New Discussion"}),e.jsx(Z,{children:"Share your thoughts and start a new civic discussion."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Title"}),e.jsx(_,{value:t.title,onChange:s=>m({...t,title:s.target.value}),placeholder:"Enter discussion title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Category"}),e.jsxs(le,{value:t.categoryId,onValueChange:s=>m({...t,categoryId:s}),children:[e.jsx(ne,{children:e.jsx(re,{placeholder:"Select a category"})}),e.jsx(ce,{children:w.map(s=>e.jsx(oe,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Content"}),e.jsx(A,{value:t.content,onChange:s=>m({...t,content:s.target.value}),placeholder:"Share your thoughts...",rows:6})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx(a,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(a,{onClick:V,disabled:j.isPending,children:j.isPending?"Creating...":"Create Discussion"})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(a,{variant:o==="all"?"default":"outline",size:"sm",onClick:()=>f("all"),children:"All Discussions"}),w.map(s=>e.jsx(a,{variant:o===s.id.toString()?"default":"outline",size:"sm",onClick:()=>f(s.id.toString()),children:s.name},s.id))]})]}),e.jsx("div",{className:"space-y-4",children:H?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading discussions..."})]}):C.length===0?e.jsx(L,{className:"text-center py-8",children:e.jsxs(M,{children:[e.jsx(y,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No discussions yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Be the first to start a discussion about Canadian politics and civic issues!"}),e.jsxs(a,{onClick:()=>d(!0),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Start First Discussion"]})]})}):C.map(s=>{var i,S,k,P,I,D,T;return e.jsxs(L,{className:"bg-white shadow-sm hover:shadow-md transition-shadow",children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(se,{className:"h-10 w-10",children:e.jsx(te,{children:((S=(i=s.author)==null?void 0:i.firstName)==null?void 0:S[0])||((P=(k=s.author)==null?void 0:k.email)==null?void 0:P[0])||"U"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.title}),s.isSticky&&e.jsx(v,{variant:"secondary",className:"text-xs",children:"Pinned"})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsx("span",{children:((I=s.author)==null?void 0:I.firstName)||((T=(D=s.author)==null?void 0:D.email)==null?void 0:T.split("@")[0])||"Anonymous"}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()}),s.category&&e.jsx(v,{variant:"outline",style:{backgroundColor:s.category.color+"20",color:s.category.color},children:s.category.name})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:s.viewCount})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:s.replyCount})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:s.likeCount})]})]})]})}),e.jsxs(M,{children:[e.jsx("p",{className:"text-gray-700 mb-4 line-clamp-3",children:s.content}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(a,{variant:"ghost",size:"sm",onClick:()=>W(s.id),className:"text-gray-500 hover:text-red-500",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Like"]}),e.jsxs(a,{variant:"ghost",size:"sm",onClick:()=>x(s),className:"text-gray-500 hover:text-blue-500",children:[e.jsx(y,{className:"h-4 w-4 mr-1"}),"Reply"]})]}),s.bill&&e.jsxs(v,{variant:"outline",className:"text-xs",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),s.bill.billNumber]})]})]})]},s.id)})}),l&&e.jsx(F,{open:!!l,onOpenChange:()=>x(null),children:e.jsxs(R,{className:"max-w-2xl",children:[e.jsx(q,{children:e.jsxs(O,{children:["Reply to: ",l.title]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsx("p",{className:"text-gray-700",children:l.content})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Your Reply"}),e.jsx(A,{value:u,onChange:s=>N(s.target.value),placeholder:"Share your thoughts...",rows:4})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(a,{variant:"outline",onClick:()=>x(null),children:"Cancel"}),e.jsx(a,{onClick:U,disabled:g.isPending,children:g.isPending?"Posting...":"Post Reply"})]})]})})]})})}export{je as default};
