import{j as e}from"./ui-CDUWW_Ri.js";import{r as l}from"./vendor-1XCZ5AD1.js";import{z as ge,q as Ne,p as ye,E as be,r as p,B as c,am as J,Q as X,s as k,$ as Z,a1 as we,R as A,t as Se,v as Ce,W as Pe,D as Fe,a as Ee,b as ke,c as Ae,d as Ie,I as r,y as f}from"./index-CFRUQat6.js";import{u as Le,a as Be,b as Ue,c as Te,d as Me,e as De,f as Re}from"./useCivicSocial-BQlB_L58.js";import{d as o,h as _,C as I,a as Ye,b as qe,i as ee,T as Oe,c as L,e as Qe,f as ze,j as $e,g as Ke}from"./CivicSocialCard-nXa4noSv.js";import{T as We,a as Ve,b as j,c as v}from"./tabs-BGm4RIWb.js";import{C as He}from"./camera-DumnnrUn.js";import{A as se}from"./award-C4gXMKjC.js";import"./bookmark-BXzk5lKo.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=ge("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);function ns(){const{user:s,isLoading:te,isAuthenticated:Ge}=Ne(),{data:U,isLoading:ie,error:ae}=Le(),{data:g}=Be(),N=Ue(),le=Te();Me(),De();const[u,T]=l.useState(""),[M,ce]=l.useState({}),[Je,Xe]=l.useState({}),[y,b]=l.useState(null),[m,w]=l.useState(null),[ne,x]=l.useState(!1),[D,oe]=l.useState((s==null?void 0:s.firstName)||""),[R,de]=l.useState((s==null?void 0:s.lastName)||""),[Y,re]=l.useState((s==null?void 0:s.bio)||""),[q,me]=l.useState((s==null?void 0:s.profileImageUrl)||""),O=l.useRef(null),{toast:a}=ye(),h=be(),S=(g==null?void 0:g.friends)||[],[xe,Q]=l.useState("posts"),C=p({mutationFn:async t=>f("/api/users/profile","PUT",t),onSuccess:()=>{h.invalidateQueries({queryKey:["/api/auth/user"]}),x(!1),a({title:"Profile updated!",description:"Your changes have been saved."})}}),he=Re(),z=t=>{he.mutate({followingId:t},{onSuccess:()=>{a({title:"Followed",description:"You are now following this user!"})},onError:i=>{a({title:"Error",description:i.message||"Failed to follow user.",variant:"destructive"})}})},P=U?U.filter(t=>String(t.userId)===String(s==null?void 0:s.id)):[],$=s?s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.firstName||s.lastName||s.email||"Anonymous":"Anonymous",ue=t=>{var n;const i=(n=t.target.files)==null?void 0:n[0];i&&(b(i),w(URL.createObjectURL(i)))},pe=async t=>{if(t.preventDefault(),!u.trim()&&!y){a({title:"Nothing to post",description:"Add text or an image.",variant:"destructive"});return}let i=null;y&&(i=m),N.mutate({content:u,imageUrl:i},{onSuccess:()=>{a({title:"Post created!",description:"Your post was added to your wall."}),h.invalidateQueries({queryKey:["civicSocialFeed"]})},onError:n=>{a({title:"Error posting",description:(n==null?void 0:n.message)||"Failed to post.",variant:"destructive"})}}),T(""),b(null),w(null)},fe=p({mutationFn:async({postId:t,platform:i="internal"})=>f(`/api/social/posts/${t}/share`,"POST",{platform:i}),onSuccess:()=>{h.invalidateQueries({queryKey:["civicSocialFeed"]}),a({title:"Shared",description:"Post shared successfully!"})},onError:t=>{a({title:"Share failed",description:(t==null?void 0:t.message)||"Could not share post.",variant:"destructive"})}}),je=p({mutationFn:async({postId:t,content:i,imageUrl:n})=>f(`/api/social/posts/${t}`,"PUT",{content:i,imageUrl:n}),onSuccess:()=>{h.invalidateQueries({queryKey:["civicSocialFeed"]}),a({title:"Post updated",description:"Your post has been updated."})},onError:t=>{a({title:"Edit failed",description:(t==null?void 0:t.message)||"Could not update post.",variant:"destructive"})}}),ve=p({mutationFn:async({postId:t})=>f(`/api/social/posts/${t}`,"DELETE"),onSuccess:()=>{h.invalidateQueries({queryKey:["civicSocialFeed"]}),a({title:"Post deleted",description:"Your post has been removed."})},onError:t=>{a({title:"Delete failed",description:(t==null?void 0:t.message)||"Could not delete post.",variant:"destructive"})}}),d={posts:P.length,friends:S.length,civicPoints:(s==null?void 0:s.civicPoints)||0},F=e.jsx(Ke,{title:"My Profile",subtitle:"Manage your civic social presence",actions:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>x(!0),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Edit Profile"]}),e.jsxs(c,{variant:"outline",size:"sm",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Settings"]})]})}),E=e.jsxs(e.Fragment,{children:[e.jsx(o,{title:"Profile Info",children:e.jsx(_,{user:{id:(s==null?void 0:s.id)||"",firstName:s==null?void 0:s.firstName,lastName:s==null?void 0:s.lastName,email:(s==null?void 0:s.email)||"",profileImageUrl:s==null?void 0:s.profileImageUrl,civicLevel:s==null?void 0:s.civicLevel,bio:s==null?void 0:s.bio,isOnline:!0},stats:d,onMessage:()=>a({title:"Message sent",description:"Your message has been sent successfully!"}),onFollow:()=>z((s==null?void 0:s.id)||"")})}),e.jsx(o,{title:"Quick Actions",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(c,{onClick:()=>x(!0),className:"w-full social-button-primary",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Edit Profile"]}),e.jsxs(c,{variant:"outline",className:"w-full",children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Change Photo"]}),e.jsxs(c,{variant:"outline",className:"w-full",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Privacy Settings"]})]})}),e.jsx(o,{title:"Activity Stats",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"w-4 h-4 text-social-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Posts"})]}),e.jsx("span",{className:"text-lg font-bold text-social-primary",children:d.posts})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"w-4 h-4 text-social-secondary"}),e.jsx("span",{className:"text-sm font-medium",children:"Friends"})]}),e.jsx("span",{className:"text-lg font-bold text-social-secondary",children:d.friends})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"w-4 h-4 text-social-accent"}),e.jsx("span",{className:"text-sm font-medium",children:"Civic Points"})]}),e.jsx("span",{className:"text-lg font-bold text-social-accent",children:d.civicPoints})]})]})})]});return te||ie?e.jsx(I,{header:F,sidebar:E,children:e.jsx(Ye,{title:"Loading your profile...",description:"We're gathering your profile information and posts."})}):ae?e.jsx(I,{header:F,sidebar:E,children:e.jsx(qe,{title:"Failed to load profile",description:"We couldn't load your profile information. Please check your connection and try again.",retry:()=>window.location.reload()})}):e.jsxs(I,{header:F,sidebar:E,children:[e.jsx(o,{children:e.jsxs(We,{value:xe,onValueChange:Q,children:[e.jsxs(Ve,{className:"grid w-full grid-cols-4",children:[e.jsx(j,{value:"posts",children:"Posts"}),e.jsx(j,{value:"about",children:"About"}),e.jsx(j,{value:"friends",children:"Friends"}),e.jsx(j,{value:"activity",children:"Activity"})]}),e.jsxs(v,{value:"posts",className:"mt-6",children:[e.jsx(o,{title:"Create New Post",children:e.jsx(ee,{children:e.jsx("form",{onSubmit:pe,className:"space-y-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"social-avatar w-10 h-10",children:m?e.jsx("img",{src:m,alt:"Preview",className:"w-full h-full rounded-full object-cover"}):e.jsx("div",{className:"w-full h-full rounded-full bg-social-primary flex items-center justify-center text-white font-medium",children:$.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx(Z,{placeholder:"What's on your mind?",value:u,onChange:t=>T(t.target.value),className:"min-h-[100px] resize-none"}),m&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:m,alt:"Preview",className:"w-full rounded-lg max-h-64 object-cover"}),e.jsx(c,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{b(null),w(null)},children:e.jsx(Oe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:()=>{var t;return(t=O.current)==null?void 0:t.click()},children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Add Image"]}),e.jsx("input",{ref:O,type:"file",accept:"image/*",onChange:ue,className:"hidden"})]}),e.jsxs(c,{type:"submit",className:"social-button-primary",disabled:N.isPending||!u.trim()&&!y,children:[N.isPending?e.jsx("div",{className:"w-4 h-4 animate-spin border-2 border-white border-t-transparent rounded-full mr-2"}):e.jsx(A,{className:"w-4 h-4 mr-2"}),"Post"]})]})]})]})})})}),e.jsx(o,{title:"Your Posts",children:P.length===0?e.jsx(L,{title:"No posts yet",description:"Start sharing your civic thoughts and experiences!",icon:e.jsx(A,{className:"w-8 h-8"}),action:e.jsxs(c,{onClick:()=>Q("posts"),className:"social-button-primary",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Create Your First Post"]})}):e.jsx(Qe,{children:P.map(t=>e.jsx(ze,{post:t,onLike:()=>le.mutate({postId:t.id}),onComment:()=>ce({...M,[t.id]:!M[t.id]}),onShare:()=>fe.mutate({postId:t.id}),onBookmark:()=>a({title:"Bookmarked",description:"Post added to your bookmarks!"}),onEdit:()=>{const i=prompt("Edit your post:",t.content);i!==null&&je.mutate({postId:t.id,content:i})},onDelete:()=>{confirm("Delete this post?")&&ve.mutate({postId:t.id})}},t.id))})})]}),e.jsx(v,{value:"about",className:"mt-6",children:e.jsx(o,{title:"About Me",children:e.jsx(ee,{children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"social-heading-3 text-card-foreground mb-2",children:"Personal Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Name:"}),e.jsx("span",{className:"text-sm font-medium",children:$})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Se,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"text-sm font-medium",children:s==null?void 0:s.email})]}),(s==null?void 0:s.civicLevel)&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(se,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Civic Level:"}),e.jsx(Ce,{className:"social-badge-primary",children:s.civicLevel})]})]})]}),(s==null?void 0:s.bio)&&e.jsxs("div",{children:[e.jsx("h4",{className:"social-heading-3 text-card-foreground mb-2",children:"Bio"}),e.jsx("p",{className:"social-body text-muted-foreground",children:s.bio})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"social-heading-3 text-card-foreground mb-2",children:"Activity Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Posts Created"}),e.jsx("span",{className:"text-lg font-bold text-social-primary",children:d.posts})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Friends"}),e.jsx("span",{className:"text-lg font-bold text-social-secondary",children:d.friends})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Civic Points"}),e.jsx("span",{className:"text-lg font-bold text-social-accent",children:d.civicPoints})]})]})]})})]})})})})}),e.jsx(v,{value:"friends",className:"mt-6",children:e.jsx(o,{title:"My Friends",children:S.length===0?e.jsx(L,{title:"No friends yet",description:"Connect with other civic-minded individuals!",icon:e.jsx(k,{className:"w-8 h-8"}),action:e.jsxs(c,{className:"social-button-primary",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Find Friends"]})}):e.jsx($e,{cols:3,children:S.map(t=>e.jsx(_,{user:{id:t.id,firstName:t.firstName,lastName:t.lastName,email:t.email,profileImageUrl:t.profileImageUrl,civicLevel:t.civicLevel,isOnline:t.isOnline},onMessage:()=>a({title:"Message sent",description:"Your message has been sent successfully!"}),onFollow:()=>z(t.id)},t.id))})})}),e.jsx(v,{value:"activity",className:"mt-6",children:e.jsx(o,{title:"Recent Activity",children:e.jsx(L,{title:"No recent activity",description:"Your civic engagement activity will appear here.",icon:e.jsx(X,{className:"w-8 h-8"})})})})]})}),e.jsx(Fe,{open:ne,onOpenChange:x,children:e.jsxs(Ee,{className:"max-w-2xl",children:[e.jsxs(ke,{children:[e.jsx(Ae,{children:"Edit Profile"}),e.jsx(Ie,{children:"Update your profile information and preferences."})]}),e.jsxs("form",{onSubmit:t=>{var i,n,K,W,V,H,G;t.preventDefault(),C.mutate({firstName:D,lastName:R,bio:Y,profileImageUrl:q,profileBannerUrl:((i=document.getElementById("profileBannerUrl"))==null?void 0:i.value)||void 0,profileAccentColor:((n=document.getElementById("profileAccentColor"))==null?void 0:n.value)||void 0,website:((K=document.getElementById("website"))==null?void 0:K.value)||void 0,profileShowBadges:(W=document.getElementById("showBadges"))==null?void 0:W.checked,profileShowStats:(V=document.getElementById("showStats"))==null?void 0:V.checked,profileShowActivity:(H=document.getElementById("showActivity"))==null?void 0:H.checked,profileShowFriends:(G=document.getElementById("showFriends"))==null?void 0:G.checked})},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"First Name"}),e.jsx(r,{value:D,onChange:t=>oe(t.target.value),placeholder:"First name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Last Name"}),e.jsx(r,{value:R,onChange:t=>de(t.target.value),placeholder:"Last name"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Bio"}),e.jsx(Z,{value:Y,onChange:t=>re(t.target.value),placeholder:"Tell us about yourself...",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Profile Image URL"}),e.jsx(r,{value:q,onChange:t=>me(t.target.value),placeholder:"https://example.com/image.jpg"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"profileBannerUrl",className:"text-sm font-medium",children:"Profile Banner URL"}),e.jsx(r,{id:"profileBannerUrl",placeholder:"https://example.com/banner.jpg",defaultValue:(s==null?void 0:s.profileBannerUrl)||""})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"profileAccentColor",className:"text-sm font-medium",children:"Theme Accent Color"}),e.jsx(r,{id:"profileAccentColor",type:"color",defaultValue:(s==null?void 0:s.profileAccentColor)||"#3b82f6"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"website",className:"text-sm font-medium",children:"Website"}),e.jsx(r,{id:"website",placeholder:"https://my-site.com",defaultValue:(s==null?void 0:s.website)||""})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"showBadges",type:"checkbox",defaultChecked:(s==null?void 0:s.profileShowBadges)??!0}),e.jsx("label",{htmlFor:"showBadges",className:"text-sm",children:"Show badges"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"showStats",type:"checkbox",defaultChecked:(s==null?void 0:s.profileShowStats)??!0}),e.jsx("label",{htmlFor:"showStats",className:"text-sm",children:"Show stats"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"showActivity",type:"checkbox",defaultChecked:(s==null?void 0:s.profileShowActivity)??!0}),e.jsx("label",{htmlFor:"showActivity",className:"text-sm",children:"Show activity"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"showFriends",type:"checkbox",defaultChecked:(s==null?void 0:s.profileShowFriends)??!0}),e.jsx("label",{htmlFor:"showFriends",className:"text-sm",children:"Show friends"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(c,{type:"submit",className:"social-button-primary",disabled:C.isPending,children:[C.isPending?e.jsx("div",{className:"w-4 h-4 animate-spin border-2 border-white border-t-transparent rounded-full mr-2"}):e.jsx(B,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]})]})})]})}export{ns as default};
