import{r as u,j as e}from"./ui-SeOhkiHV.js";import{q as _,p as X,E as le,r as ne,y as v,g as n,j as c,R as k,B as f,X as R,Y as K,Z as M,$ as ce,v as z,M as Z,a0 as oe,a1 as me,a2 as de,u as H,K as q,s as xe,a3 as J,U as ue,a4 as he,Q as ge}from"./app-C-GM7XxL.js";import{T as pe,a as je,b as D,c as E}from"./tabs-DBpaEs6T.js";import{T as Ne}from"./tag-Cw_x9_WO.js";import{u as ve}from"./useCivicSocial-agn5LvJl.js";import{S as fe}from"./star-e4N4rR0s.js";import{C as ye}from"./calendar-Cpnx5wME.js";import{A as W}from"./award-D6ePxjK5.js";import"./vendor-BtP0CW_r.js";function be({onPostCreated:y,placeholder:$="What's on your mind?",showLocation:r=!0,showMood:O=!0,showTags:b=!0,showVisibility:A=!0,showImageUpload:o=!0,className:j="",autoFocus:U=!1}){var B,Y;const{user:h}=_(),{toast:g}=X(),s=le(),[p,m]=u.useState(""),[C,d]=u.useState("public"),[S,w]=u.useState(""),[P,N]=u.useState(""),[x,a]=u.useState([]),[l,T]=u.useState(null),[Q,I]=u.useState(null),[G,V]=u.useState(!1),ee=ne({mutationFn:async t=>v("/api/social/posts","POST",t),onSuccess:()=>{g({title:"Post created!",description:"Your post has been shared to your profile and the feed."}),s.invalidateQueries({queryKey:["social-posts"]}),s.invalidateQueries({queryKey:["user-posts"]}),se(),y==null||y()},onError:t=>{g({title:"Post failed",description:t.message||"Failed to create post. Please try again.",variant:"destructive"})}}),se=()=>{m(""),d("public"),w(""),N(""),a([]),T(null),I(null)},ae=t=>{var L;const i=(L=t.target.files)==null?void 0:L[0];i&&(T(i),I(URL.createObjectURL(i)))},te=async t=>{if(t.preventDefault(),!p.trim()&&!l){g({title:"Content required",description:"Please enter some content or upload an image.",variant:"destructive"});return}if(!h){g({title:"Login required",description:"Please log in to create posts.",variant:"destructive"});return}V(!0);try{let i=null;if(l){const F=new FormData;F.append("image",l),i=(await v("/api/upload/image","POST",F)).imageUrl}const L={content:p.trim(),type:"post",visibility:C,imageUrl:i,location:S.trim()||void 0,mood:P.trim()||void 0,tags:x.filter(F=>F.trim())};ee.mutate(L)}catch{g({title:"Post failed",description:"Failed to create post. Please try again.",variant:"destructive"})}finally{V(!1)}},ie=t=>{if(t.key==="Enter"||t.key===","){t.preventDefault();const i=t.currentTarget.value.trim();i&&!x.includes(i)&&(a([...x,i]),t.currentTarget.value="")}},re=t=>{a(x.filter(i=>i!==t))};return h?e.jsx(n,{className:`p-4 ${j}`,children:e.jsx(c,{className:"p-0",children:e.jsxs("form",{onSubmit:te,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(R,{className:"w-10 h-10",children:[e.jsx(K,{src:h.profileImageUrl}),e.jsx(M,{className:"bg-blue-600",children:((B=h.firstName)==null?void 0:B[0])||((Y=h.email)==null?void 0:Y[0])||"U"})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx(ce,{placeholder:$,value:p,onChange:t=>m(t.target.value),className:"min-h-[100px] resize-none border-0 focus:ring-0 p-0 text-base",autoFocus:U,maxLength:1e3}),Q&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:Q,alt:"Preview",className:"max-w-xs max-h-48 rounded-lg object-cover"}),e.jsx(f,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 w-6 h-6 p-0",onClick:()=>{T(null),I(null)},children:"×"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[b&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Add tags (press Enter or comma)",onKeyDown:ie,className:"flex-1 text-sm border-0 focus:ring-0 p-0 bg-transparent"})]}),x.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map((t,i)=>e.jsxs(z,{variant:"secondary",className:"text-xs",children:["#",t,e.jsx("button",{type:"button",onClick:()=>re(t),className:"ml-1 hover:text-red-600",children:"×"})]},i))})]}),e.jsxs("div",{className:"flex gap-4",children:[r&&e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(Z,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Add location",value:S,onChange:t=>w(t.target.value),className:"flex-1 text-sm border-0 focus:ring-0 p-0 bg-transparent"})]}),O&&e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"How are you feeling?",value:P,onChange:t=>N(t.target.value),className:"flex-1 text-sm border-0 focus:ring-0 p-0 bg-transparent"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(me,{className:"w-5 h-5 text-gray-500 hover:text-blue-600"}),e.jsx("input",{type:"file",accept:"image/*",onChange:ae,className:"hidden"})]}),A&&e.jsxs("select",{value:C,onChange:t=>d(t.target.value),className:"text-sm border-0 focus:ring-0 p-0 bg-transparent",children:[e.jsx("option",{value:"public",children:"Public"}),e.jsx("option",{value:"friends",children:"Friends"}),e.jsx("option",{value:"private",children:"Private"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[p.length,"/1000"]}),e.jsxs(f,{type:"submit",disabled:!p.trim()&&!l||G,size:"sm",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),G?"Posting...":"Post"]})]})]})]})]})})}):e.jsx(n,{className:`p-4 ${j}`,children:e.jsxs(c,{className:"text-center py-8",children:[e.jsx(k,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Login to Post"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Join the conversation by logging in to your CivicOS account."}),e.jsx(f,{onClick:()=>window.location.href="/auth",children:"Login to Post"})]})})}function Ue(){var x;const[y]=H(),[,$]=H(),r=y.split("/").pop(),b=/^[0-9a-fA-F-]{36}$/.test(r||"")||/^user_/i.test(r||""),A=(r||"").replace(/^user_/i,""),{user:o}=_(),{toast:j}=X(),[U,h]=u.useState("posts"),g=ve(),{data:s,isLoading:p}=q({queryKey:["user-profile",r],queryFn:async()=>b?await v(`/api/users/${A}/profile`,"GET"):(await v(`/api/users/profile/${r}`,"GET")).profile,enabled:!!r}),{data:m,isLoading:C}=q({queryKey:["user-posts",(s==null?void 0:s.username)||r],queryFn:async()=>{const a=b?(s==null?void 0:s.username)||"":r||"";return a?(await v(`/api/social/posts/user/${a}`,"GET")).posts||[]:[]},enabled:!!(s!=null&&s.username||!b&&r)}),{data:d}=q({queryKey:["user-achievements",s==null?void 0:s.username],queryFn:async()=>s!=null&&s.username?(await v(`/api/users/${s.username}/achievements`,"GET")).achievements||[]:[],enabled:!!(s!=null&&s.username)}),S=async()=>{const a=`${window.location.origin}/civicsocial/profile/${(s==null?void 0:s.username)||r}`,l=`Check out ${(s==null?void 0:s.firstName)||(s==null?void 0:s.username)}'s profile on CivicOS`;try{navigator.share?await navigator.share({title:`${(s==null?void 0:s.firstName)||(s==null?void 0:s.username)}'s Profile`,text:l,url:a}):(await navigator.clipboard.writeText(`${l} ${a}`),j({title:"Link copied!",description:"Profile link has been copied to your clipboard."}))}catch{}},w=()=>s!=null&&s.firstName&&(s!=null&&s.lastName)?`${s.firstName} ${s.lastName}`:s!=null&&s.firstName?s.firstName:s!=null&&s.username?s.username:"Anonymous User",P=a=>{switch(a==null?void 0:a.toLowerCase()){case"champion":return"bg-purple-500";case"expert":return"bg-blue-500";case"advocate":return"bg-green-500";case"active":return"bg-yellow-500";default:return"bg-gray-500"}},N=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return p?e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading profile..."})]})}):s?e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx(n,{className:"mb-8",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs(R,{className:"w-24 h-24",children:[e.jsx(K,{src:s.profileImageUrl}),e.jsx(M,{className:"bg-blue-600 text-2xl",children:(x=w()[0])==null?void 0:x.toUpperCase()})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold",children:w()}),s.isVerified&&e.jsxs(z,{variant:"secondary",children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),"Verified"]}),e.jsx(z,{className:`text-xs ${P(s.civicLevel||"")}`,children:s.civicLevel||"Registered"})]}),e.jsxs("p",{className:"text-gray-600",children:["@",s.username]}),s.bio&&e.jsx("p",{className:"text-gray-700 max-w-md",children:s.bio}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-4 h-4"}),s.location]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),"Joined ",N(s.joinDate)]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:S,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Share Profile"]}),(o==null?void 0:o.id)!==s.id&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{variant:"default",size:"sm",onClick:()=>$(`/civicsocial/messages?recipientId=${encodeURIComponent(s.id)}`),children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Message"]}),e.jsxs(f,{variant:"secondary",size:"sm",onClick:()=>g.mutate({followingId:s.id},{onSuccess:()=>j({title:"Followed",description:`You are now following @${s.username}`}),onError:a=>j({title:"Follow failed",description:(a==null?void 0:a.message)||"Could not follow user",variant:"destructive"})}),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Follow"]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx(n,{children:e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.postsCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"Posts"})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.followersCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"Followers"})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:s.followingCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"Following"})]})}),e.jsx(n,{children:e.jsxs(c,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:s.civicPoints}),e.jsx("div",{className:"text-sm text-gray-600",children:"Civic Points"})]})})]}),e.jsxs(pe,{value:U,onValueChange:h,children:[e.jsxs(je,{className:"grid w-full grid-cols-3",children:[e.jsx(D,{value:"posts",children:"Posts"}),e.jsx(D,{value:"achievements",children:"Achievements"}),e.jsx(D,{value:"activity",children:"Activity"})]}),e.jsx(E,{value:"posts",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[(o==null?void 0:o.id)===s.id&&e.jsx(be,{placeholder:`What's on your mind, ${s.firstName||s.username}?`,onPostCreated:()=>{window.location.reload()}}),C?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading posts..."})]}):(m==null?void 0:m.length)===0?e.jsx(n,{children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(k,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-gray-600",children:(o==null?void 0:o.id)===s.id?"Share your first post to get started!":`${s.firstName||s.username} hasn't posted anything yet.`})]})}):e.jsx("div",{className:"space-y-4",children:m==null?void 0:m.map(a=>{var l;return e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(R,{className:"w-10 h-10",children:[e.jsx(K,{src:a.user.profileImageUrl}),e.jsx(M,{className:"bg-blue-600",children:((l=a.user.firstName)==null?void 0:l[0])||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"font-semibold",children:[a.user.firstName," ",a.user.lastName]}),e.jsx("span",{className:"text-sm text-gray-500",children:N(a.createdAt)})]}),e.jsx("p",{className:"text-gray-800 mb-3",children:a.content}),a.imageUrl&&e.jsx("img",{src:a.imageUrl,alt:"Post",className:"rounded-lg max-w-full h-auto mb-3"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("button",{className:"flex items-center gap-1 hover:text-blue-600",children:[e.jsx(he,{className:"w-4 h-4"}),a.likesCount||0]}),e.jsxs("button",{className:"flex items-center gap-1 hover:text-blue-600",children:[e.jsx(k,{className:"w-4 h-4"}),a.commentsCount||0]}),e.jsxs("button",{className:"flex items-center gap-1 hover:text-blue-600",children:[e.jsx(J,{className:"w-4 h-4"}),a.sharesCount||0]})]})]})]})})},a.id)})})]})}),e.jsx(E,{value:"achievements",className:"mt-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(d==null?void 0:d.length)===0?e.jsx(n,{className:"col-span-full",children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(W,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No achievements yet"}),e.jsx("p",{className:"text-gray-600",children:"Keep engaging with civic activities to earn achievements!"})]})}):d==null?void 0:d.map(a=>e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(W,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Earned ",N(a.earnedAt)]})]})]})})},a.id))})}),e.jsx(E,{value:"activity",className:"mt-6",children:e.jsx(n,{children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(ge,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Activity Feed"}),e.jsx("p",{className:"text-gray-600",children:"Recent civic engagement activity will appear here."})]})})})]})]}):e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Profile Not Found"}),e.jsx("p",{className:"text-gray-600",children:"The user profile you're looking for doesn't exist."})]})})}export{Ue as default};
