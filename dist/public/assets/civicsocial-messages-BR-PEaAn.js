import{r,j as e}from"./ui-D2Re0T6U.js";import{z as F,q as Q,p as R,E as V,u as B,K as k,r as O,B as l,l as A,I as g,at as P,_ as p,X as $,Y as D,Z as L,v as _,P as G,ak as H,au as X,a1 as Y,a0 as Z,a2 as J,D as W,a as ee,b as se,c as ae,d as te,y as u}from"./app-DvyBRsoP.js";import{P as ie}from"./plus-B99RX2l9.js";import"./vendor-BtP0CW_r.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=F("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);function xe(){var I,M;const{user:i}=Q(),{toast:U}=R(),j=V(),[N]=B(),[t,y]=r.useState(null),[n,v]=r.useState(""),[o,f]=r.useState(""),b=r.useRef(null),[q,w]=r.useState(!1),[le,ce]=r.useState(null),{data:c=[],isLoading:z}=k({queryKey:["civicSocialConversations"],queryFn:async()=>{const s=await u("/api/social/conversations","GET");return s.success?s.conversations:[]},staleTime:3e4}),{data:m=[],isLoading:T}=k({queryKey:["civicSocialMessages",t],queryFn:async()=>{if(!t)return[];const s=await u(`/api/social/messages/${t}`,"GET");return s.success?s.messages:[]},enabled:!!t,staleTime:1e4}),x=O({mutationFn:async({recipientId:s,content:a})=>u("/api/social/messages","POST",{recipientId:s,content:a}),onSuccess:()=>{j.invalidateQueries({queryKey:["civicSocialMessages",t]}),j.invalidateQueries({queryKey:["civicSocialConversations"]}),v("")},onError:()=>{U({title:"Error",description:"Failed to send message",variant:"destructive"})}});r.useEffect(()=>{var s;(s=b.current)==null||s.scrollIntoView({behavior:"smooth"})},[m]),r.useEffect(()=>{const a=new URLSearchParams(N.split("?")[1]||"").get("recipientId");a&&y(a)},[N]);const S=()=>{!n.trim()||!t||x.mutate({recipientId:t,content:n.trim()})},K=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),S())},h=s=>s.participant?`${s.participant.firstName||""} ${s.participant.lastName||""}`.trim()||s.participant.email:"Unknown User",C=s=>{if(s.participant){const a=s.participant.firstName||"",d=s.participant.lastName||"";return`${a.charAt(0)}${d.charAt(0)}`.toUpperCase()||s.participant.email.charAt(0).toUpperCase()}return"?"};return e.jsxs("div",{className:"flex h-screen bg-white",children:[e.jsxs("div",{className:"w-80 border-r border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Messages"}),e.jsxs(l,{size:"sm",onClick:()=>w(!0),className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"New"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(g,{placeholder:"Search conversations...",value:o,onChange:s=>f(s.target.value),className:"pl-10"})]})]}),e.jsx(P,{className:"h-[calc(100vh-120px)]",children:z?e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,a)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3 animate-pulse"})]})]},a))})}):c.length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(p,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No conversations yet"}),e.jsx("p",{className:"text-sm",children:"Start a conversation to begin messaging"})]}):e.jsx("div",{className:"p-2",children:c.filter(s=>h(s).toLowerCase().includes(o.toLowerCase())).map(s=>{var a,d,E;return e.jsxs("div",{onClick:()=>y(s.id),className:`flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-colors ${t===s.id?"bg-blue-50 border border-blue-200":"hover:bg-gray-100"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsxs($,{className:"w-10 h-10",children:[e.jsx(D,{src:(a=s.participant)==null?void 0:a.profileImageUrl}),e.jsx(L,{children:C(s)})]}),((d=s.participant)==null?void 0:d.isOnline)&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:h(s)}),s.unreadCount>0&&e.jsx(_,{variant:"destructive",className:"text-xs",children:s.unreadCount})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:typeof s.lastMessage=="string"?s.lastMessage:((E=s.lastMessage)==null?void 0:E.content)||"No messages yet"})]})]},s.id)})})})]}),e.jsx("div",{className:"flex-1 flex flex-col bg-white",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs($,{className:"w-8 h-8",children:[e.jsx(D,{src:(M=(I=c.find(s=>s.id===t))==null?void 0:I.participant)==null?void 0:M.profileImageUrl}),e.jsx(L,{children:C(c.find(s=>s.id===t)||{})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:h(c.find(s=>s.id===t)||{})}),e.jsx("p",{className:"text-sm text-gray-500",children:"Active now"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(re,{className:"w-4 h-4"})})]})]})}),e.jsx(P,{className:"flex-1 p-4 bg-gray-50",children:T?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsx("div",{className:`flex ${a%2===0?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${a%2===0?"bg-blue-500 text-white":"bg-white border"}`,children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})})},a))}):m.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(p,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Start the conversation!"})]}):e.jsxs("div",{className:"space-y-4",children:[m.map(s=>e.jsx("div",{className:`flex ${s.senderId===(i==null?void 0:i.id)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${s.senderId===(i==null?void 0:i.id)?"bg-blue-500 text-white":"bg-white border border-gray-200"}`,children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("p",{className:`text-xs mt-1 ${s.senderId===(i==null?void 0:i.id)?"text-blue-100":"text-gray-500"}`,children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},s.id)),e.jsx("div",{ref:b})]})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1",children:e.jsx(g,{placeholder:"Type a message...",value:n,onChange:s=>v(s.target.value),onKeyPress:K,disabled:x.isPending})}),e.jsx(l,{onClick:S,disabled:!n.trim()||x.isPending,size:"sm",children:e.jsx(J,{className:"w-4 h-4"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(p,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Select a conversation"}),e.jsx("p",{className:"text-sm",children:"Choose a conversation from the sidebar to start messaging"})]})})}),e.jsx(W,{open:q,onOpenChange:w,children:e.jsxs(ee,{className:"sm:max-w-md",children:[e.jsxs(se,{children:[e.jsx(ae,{children:"New Conversation"}),e.jsx(te,{children:"Start a new conversation with another user"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(g,{placeholder:"Search users...",value:o,onChange:s=>f(s.target.value),className:"pl-10"})]}),e.jsx("div",{className:"text-center text-gray-500",children:e.jsx("p",{children:"User search functionality coming soon..."})})]})]})})]})}export{xe as default};
