import{r as a,j as e}from"./ui-D2Re0T6U.js";import{q as he,p as xe,E as pe,K as je,r as m,B as n,R as ve,$ as U,D as ge,a as ye,b as fe,c as Ne,d as Se,L,a1 as be,M as Pe,aj as z,a2 as Ce,y as r,ak as we,l as Te,I as Fe}from"./app-CDP34tcP.js";import{S as v,a as g,b as y,c as f,d as i}from"./select-CrjjNc36.js";import{C as N,a as ke,b as Le,c as Ve,d as o,e as qe,f as Ie,g as Me}from"./CivicSocialCard-fQwO41GT.js";import{P as V}from"./plus-B7QmCWei.js";import{T as Oe}from"./trash-2-BXXfZXt5.js";import{T as De}from"./tag-B6BmL1-C.js";import{C as Ee}from"./camera-Dt1CDN1O.js";import{T as Qe}from"./trending-up-DqzJ9oa9.js";import{R as Re}from"./refresh-cw-BqvEZ_Cm.js";import"./vendor-BtP0CW_r.js";import"./index-B4pxPuSB.js";import"./bookmark-B4VKGaXD.js";function as(){const{user:Be,isAuthenticated:Ae}=he(),{toast:S}=xe(),c=pe(),[$,l]=a.useState(!1),[q,Ke]=a.useState("following"),[b,W]=a.useState("all"),[I,Y]=a.useState(""),[M,H]=a.useState("latest"),[P,G]=a.useState({}),O=(s,t)=>G(d=>({...d,[s]:t})),[u,D]=a.useState(""),[E,Q]=a.useState("post"),[R,B]=a.useState("public"),[J,X]=a.useState([]),[Z,_]=a.useState(""),[ee,se]=a.useState(""),[Ue,C]=a.useState(null),[h,w]=a.useState(null),{data:x,isLoading:T,error:te,refetch:A}=je({queryKey:["socialFeed",q,b,M,I],queryFn:async()=>{const s=q==="following"?"following":b==="public"?"public":"all",t=new URLSearchParams({scope:s});return(await r(`/api/social/feed?${t.toString()}`)).feed||[]},staleTime:3e4}),F=m({mutationFn:async s=>await r("/api/social/posts","POST",s),onSuccess:()=>{c.invalidateQueries({queryKey:["socialFeed"]}),l(!1),me(),S({title:"Post created!",description:"Your post has been shared successfully."})},onError:s=>{S({title:"Error creating post",description:s.message||"Failed to create post. Please try again.",variant:"destructive"})}}),ae=m({mutationFn:async s=>await r(`/api/social/posts/${s}/like`,"POST"),onSuccess:()=>{c.invalidateQueries({queryKey:["socialFeed"]})}}),k=m({mutationFn:async({postId:s,content:t})=>await r(`/api/social/posts/${s}/comment`,"POST",{content:t}),onSuccess:()=>{c.invalidateQueries({queryKey:["socialFeed"]})}}),ie=m({mutationFn:async s=>await r(`/api/social/posts/${s}/share`,"POST"),onSuccess:()=>{c.invalidateQueries({queryKey:["socialFeed"]}),S({title:"Post shared!",description:"Your post has been shared successfully."})}}),ne=m({mutationFn:async s=>await r("/api/social/bookmarks","POST",{postId:s}),onSuccess:()=>{c.invalidateQueries({queryKey:["socialFeed"]})}}),le=async s=>{if(s.preventDefault(),!u.trim())return;const t={content:u,type:E,visibility:R,tags:J,location:Z,mood:ee,...h&&{imageUrl:h}};F.mutate(t)},re=s=>{ae.mutate(s)},K=s=>{const t=(P[s]||"").trim();t&&(k.mutate({postId:s,content:t}),O(s,""))},oe=s=>{ie.mutate(s)},ce=s=>{ne.mutate(s)},de=s=>{var d;const t=(d=s.target.files)==null?void 0:d[0];t&&(C(t),w(URL.createObjectURL(t)))},me=()=>{D(""),Q("post"),B("public"),X([]),_(""),se(""),C(null),w(null)},p=e.jsxs(e.Fragment,{children:[e.jsx(o,{title:"Quick Actions",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(n,{onClick:()=>l(!0),className:"w-full social-button-primary",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Create Post"]}),e.jsxs(n,{variant:"outline",className:"w-full",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Share Photo"]}),e.jsxs(n,{variant:"outline",className:"w-full",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Share Video"]})]})}),e.jsx(o,{title:"Trending Topics",children:e.jsx("div",{className:"space-y-2",children:["#CanadianPolitics","#CivicEngagement","#Democracy","#VotingRights"].map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 hover:bg-muted transition-colors cursor-pointer",children:[e.jsx("span",{className:"text-sm font-medium",children:s}),e.jsx(Qe,{className:"w-4 h-4 text-muted-foreground"})]},s))})}),e.jsx(o,{title:"Online Friends",children:e.jsx("div",{className:"space-y-2",children:[1,2,3].map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded-md hover:bg-muted transition-colors cursor-pointer",children:[e.jsx("div",{className:"social-avatar-online w-8 h-8",children:e.jsxs("div",{className:"w-full h-full rounded-full bg-social-primary flex items-center justify-center text-white text-xs font-medium",children:["U",s]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium truncate",children:["User ",s]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Online"})]})]},s))})})]}),j=e.jsx(Me,{title:"CivicSocial Feed",subtitle:"Stay connected with your civic community",actions:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>A(),disabled:T,children:T?e.jsx(z,{className:"w-4 h-4 animate-spin"}):e.jsx(Re,{className:"w-4 h-4"})}),e.jsxs(n,{onClick:()=>l(!0),className:"social-button-primary",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"New Post"]})]})}),ue=e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 p-4 bg-card border border-border rounded-lg",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Fe,{placeholder:"Search posts...",value:I,onChange:s=>Y(s.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{value:b,onValueChange:s=>W(s),children:[e.jsx(g,{className:"w-32",children:e.jsx(y,{})}),e.jsxs(f,{children:[e.jsx(i,{value:"all",children:"All Posts"}),e.jsx(i,{value:"public",children:"Public"}),e.jsx(i,{value:"friends",children:"Friends"}),e.jsx(i,{value:"private",children:"Private"})]})]}),e.jsxs(v,{value:M,onValueChange:s=>H(s),children:[e.jsx(g,{className:"w-32",children:e.jsx(y,{})}),e.jsxs(f,{children:[e.jsx(i,{value:"latest",children:"Latest"}),e.jsx(i,{value:"popular",children:"Popular"}),e.jsx(i,{value:"trending",children:"Trending"})]})]})]})]});return T?e.jsx(N,{header:j,sidebar:p,children:e.jsx(ke,{title:"Loading your feed...",description:"We're gathering the latest posts from your civic community."})}):te?e.jsx(N,{header:j,sidebar:p,children:e.jsx(Le,{title:"Failed to load feed",description:"We couldn't load your social feed. Please check your connection and try again.",retry:()=>A()})}):!x||x.length===0?e.jsx(N,{header:j,sidebar:p,children:e.jsx(Ve,{title:"No posts yet",description:"Be the first to share something with your civic community!",icon:e.jsx(ve,{className:"w-8 h-8"}),action:e.jsxs(n,{onClick:()=>l(!0),className:"social-button-primary",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Create Your First Post"]})})}):e.jsxs(N,{header:j,sidebar:p,children:[e.jsx(o,{children:ue}),e.jsx(o,{children:e.jsx(qe,{children:x.map(s=>e.jsx(Ie,{post:s,onLike:re,onComment:K,onShare:oe,onBookmark:ce},s.id))})}),e.jsx(o,{children:x.map(s=>e.jsxs("div",{className:"mt-2 p-3 border border-border rounded-lg bg-card",children:[e.jsx("div",{className:"flex items-start gap-2",children:e.jsx(U,{placeholder:"Write a comment...",value:P[s.id]||"",onChange:t=>O(s.id,t.target.value),className:"min-h-[60px]"})}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx(n,{size:"sm",className:"social-button-primary",disabled:k.isPending||!(P[s.id]||"").trim(),onClick:()=>K(s.id),children:k.isPending?"Postingâ€¦":"Comment"})})]},`comment-box-${s.id}`))}),e.jsx(ge,{open:$,onOpenChange:l,children:e.jsxs(ye,{className:"max-w-2xl",children:[e.jsxs(fe,{children:[e.jsx(Ne,{children:"Create a New Post"}),e.jsx(Se,{children:"Share your thoughts, ideas, or updates with the civic community."})]}),e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"content",children:"What's on your mind?"}),e.jsx(U,{id:"content",placeholder:"Share your thoughts with the civic community...",value:u,onChange:s=>D(s.target.value),className:"min-h-[120px]",required:!0})]}),h&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:h,alt:"Preview",className:"w-full rounded-lg max-h-64 object-cover"}),e.jsx(n,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{C(null),w(null)},children:e.jsx(Oe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"type",children:"Post Type"}),e.jsxs(v,{value:E,onValueChange:s=>Q(s),children:[e.jsx(g,{children:e.jsx(y,{})}),e.jsxs(f,{children:[e.jsx(i,{value:"post",children:"Post"}),e.jsx(i,{value:"share",children:"Share"}),e.jsx(i,{value:"poll",children:"Poll"}),e.jsx(i,{value:"event",children:"Event"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"visibility",children:"Visibility"}),e.jsxs(v,{value:R,onValueChange:s=>B(s),children:[e.jsx(g,{children:e.jsx(y,{})}),e.jsxs(f,{children:[e.jsx(i,{value:"public",children:"Public"}),e.jsx(i,{value:"friends",children:"Friends"}),e.jsx(i,{value:"private",children:"Private"})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(n,{type:"button",variant:"outline",size:"sm",onClick:()=>{var s;return(s=document.getElementById("image-upload"))==null?void 0:s.click()},children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Add Image"]}),e.jsx("input",{id:"image-upload",type:"file",accept:"image/*",onChange:de,className:"hidden"}),e.jsxs(n,{type:"button",variant:"outline",size:"sm",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Add Location"]}),e.jsxs(n,{type:"button",variant:"outline",size:"sm",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Add Tags"]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsxs(n,{type:"submit",className:"social-button-primary",disabled:F.isPending||!u.trim(),children:[F.isPending?e.jsx(z,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Post"]})]})]})]})})]})}export{as as default};
