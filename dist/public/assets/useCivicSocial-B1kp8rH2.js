import{E as u,r as s,am as y,K as l}from"./index-QXg1pDzo.js";function a(){return localStorage.getItem("civicos-jwt")||""}const c=y.apiUrl.replace(/\/+$/,"");function h(){return l({queryKey:["civicSocialFeed"],queryFn:async()=>{const i=a();if(!i)throw new Error("Authentication required");const e=await fetch(`${c}/api/social/feed`,{headers:{Authorization:`Bearer ${i}`}});if(!e.ok)throw e.status===401||e.status===403?(localStorage.removeItem("civicos-jwt"),new Error("Authentication required")):new Error("Failed to fetch feed");const t=await e.json();return t.success?t.feed||[]:[]},retry:(i,e)=>e.message==="Authentication required"?!1:i<3})}function w(){const i=u();return s({mutationFn:async e=>{const t=a(),n={content:String((e==null?void 0:e.content)??"").trim(),type:(e==null?void 0:e.type)||"text",visibility:(e==null?void 0:e.visibility)||"public"};e!=null&&e.imageUrl&&typeof e.imageUrl=="string"&&(n.imageUrl=e.imageUrl);const r=await fetch(`${c}/api/social/posts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(n)}),o=await r.json().catch(()=>({}));if(!r.ok){const d=(o==null?void 0:o.message)||(o==null?void 0:o.error)||"Failed to create post";throw new Error(d)}return o},onSuccess:()=>i.invalidateQueries({queryKey:["civicSocialFeed"]})})}function S(){const i=u();return s({mutationFn:async({postId:e,...t})=>{const n=a(),r=await fetch(`${c}/api/social/posts/${e}/comment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});if(!r.ok)throw new Error("Failed to add comment");return r.json()},onSuccess:()=>i.invalidateQueries({queryKey:["civicSocialFeed"]})})}function m(){const i=u();return s({mutationFn:async({postId:e,reaction:t="like"})=>{const n=a(),r=await fetch(`${c}/api/social/posts/${e}/like`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({reaction:t})});if(!r.ok)throw new Error("Failed to like post");return r.json()},onSuccess:()=>i.invalidateQueries({queryKey:["civicSocialFeed"]})})}function v(){return l({queryKey:["civicSocialFriends"],queryFn:async()=>{const i=a();if(!i)throw new Error("Authentication required");const e=await fetch(`${c}/api/social/friends`,{headers:{Authorization:`Bearer ${i}`}});if(!e.ok)throw e.status===401||e.status===403?(localStorage.removeItem("civicos-jwt"),new Error("Authentication required")):new Error("Failed to fetch friends");const t=await e.json();return t.success?t:{friends:[],received:[],sent:[]}},retry:(i,e)=>e.message==="Authentication required"?!1:i<3})}function F(){const i=u();return s({mutationFn:async({friendId:e})=>{const t=a(),n=await fetch(`${c}/api/social/friends`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({friendId:e})});if(!n.ok)throw new Error("Failed to add friend");return n.json()},onSuccess:()=>i.invalidateQueries({queryKey:["civicSocialFriends"]})})}function p(){const i=u();return s({mutationFn:async({friendId:e})=>{const t=a(),n=await fetch(`${c}/api/social/friends/accept`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({friendId:e})});if(!n.ok)throw new Error("Failed to accept friend request");return n.json()},onSuccess:()=>i.invalidateQueries({queryKey:["civicSocialFriends"]})})}function C(){const i=u();return s({mutationFn:async({friendId:e})=>{const t=a(),n=await fetch(`${c}/api/social/friends/remove`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({friendId:e})});if(!n.ok)throw new Error("Failed to remove friend");return n.json()},onSuccess:()=>i.invalidateQueries({queryKey:["civicSocialFriends"]})})}function q(){return s({mutationFn:async({userId:i,type:e,title:t,message:n})=>{const r=a(),o=await fetch(`${c}/api/social/notifications`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({userId:i,type:e,title:t,message:n})});if(!o.ok)throw new Error("Failed to send notification");return o.json()}})}function g(){const i=u();return s({mutationFn:async({followingId:e})=>{const t=a(),n=await fetch(`${c}/api/social/follow`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({followingId:e})});if(!n.ok)throw new Error("Failed to follow user");return n.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["civicSocialFeed"]}),i.invalidateQueries({queryKey:["civicSocialFriends"]})}})}export{h as a,v as b,w as c,m as d,S as e,q as f,F as g,p as h,C as i,g as u};
