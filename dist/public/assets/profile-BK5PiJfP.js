import{j as e}from"./ui-CDUWW_Ri.js";import{r as T}from"./vendor-1XCZ5AD1.js";import{q as Z,u as J,p as ee,E as se,K as A,r as k,g as o,j as x,R as B,B as u,W as ie,X as ae,Y as te,v as N,S as O,M as le,Z as re,h,i as p,P as ne,D as ce,a as de,b as oe,c as xe,d as me,L as c,I as j,_ as he,y as g}from"./index-B1N5ipvw.js";import{P as pe}from"./progress-CMgA2_Sx.js";import{T as je,a as ue,b as w,c as C}from"./tabs-DCXTq-v-.js";import{S as ge,a as ve,b as fe,c as Ne,d as L}from"./select-CCEMg9Lb.js";import{C as M}from"./camera-D7xi2hVN.js";import{B as $,G as ye}from"./graduation-cap-NmnKTkJs.js";import{S as be}from"./square-pen-CIjRSVLH.js";import{T as we}from"./target-CeLfLzZv.js";import{G}from"./globe-5nKa9HDV.js";import{F as Ce}from"./flag-BdakioHr.js";import{T as Fe}from"./trophy-G1M_LVhk.js";import{A as Pe}from"./award-DuLfTL3a.js";import"./index-q7PMzjPi.js";function Re(){var I;const{user:v,isAuthenticated:Te}=Z(),[S,Ae]=J(),{toast:m}=ee(),E=se(),U=S.split("/"),y=U[U.length-1],f=!y||y==="profile"||y===(v==null?void 0:v.id)||S==="/profile",l=f?v==null?void 0:v.id:y,[K,b]=T.useState(!1),[t,n]=T.useState({}),[R,Q]=T.useState("overview"),{data:i,isLoading:Y}=A({queryKey:["user-profile",l],queryFn:async()=>l?await g(`/api/users/${l}/profile`,"GET"):null,enabled:!!l}),{data:a}=A({queryKey:["user-stats",l],queryFn:async()=>l?await g(`/api/users/${l}/stats`,"GET"):null,enabled:!!l}),{data:F}=A({queryKey:["user-activity",l],queryFn:async()=>l?await g(`/api/users/${l}/activity`,"GET"):null,enabled:!!l}),P=k({mutationFn:async s=>g(`/api/users/${l}/profile`,"PUT",s),onSuccess:()=>{m({title:"Profile Updated",description:"Your profile has been updated successfully."}),E.invalidateQueries({queryKey:["user-profile",l]}),b(!1)},onError:s=>{m({title:"Update Failed",description:s.message||"Failed to update profile.",variant:"destructive"})}}),z=k({mutationFn:async()=>g("/api/social/friends","POST",{friendId:l,action:"send"}),onSuccess:()=>{m({title:"Friend Request Sent",description:"Your friend request has been sent."})},onError:s=>{m({title:"Request Failed",description:s.message||"Failed to send friend request.",variant:"destructive"})}}),H=k({mutationFn:async()=>g("/api/social/messages","POST",{recipientId:l,content:"Hello! I'd like to connect with you on CivicOS."}),onSuccess:()=>{m({title:"Message Sent",description:"Your message has been sent."})},onError:s=>{m({title:"Message Failed",description:s.message||"Failed to send message.",variant:"destructive"})}}),_=()=>{P.mutate(t)},D=async(s,r)=>{const d=new FormData;d.append("image",s),d.append("type",r);try{const q=await g(`/api/users/${l}/upload-image`,"POST",d);E.invalidateQueries({queryKey:["user-profile",l]}),m({title:"Image Updated",description:"Your profile image has been updated."})}catch(q){m({title:"Upload Failed",description:q.message||"Failed to upload image.",variant:"destructive"})}},V=s=>s?s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.firstName?s.firstName:s.email?s.email.split("@")[0]:"Anonymous User":"Loading...",W=s=>{switch(s==null?void 0:s.toLowerCase()){case"champion":return"bg-purple-500";case"expert":return"bg-blue-500";case"advocate":return"bg-green-500";case"active":return"bg-yellow-500";default:return"bg-gray-500"}},X=s=>s>=90?"text-green-600":s>=70?"text-yellow-600":"text-red-600";return Y?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-64 bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]})}):i?e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsxs("div",{className:"h-64 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg relative overflow-hidden",children:[i.profileBannerUrl&&e.jsx("img",{src:i.profileBannerUrl,alt:"Profile Banner",className:"w-full h-full object-cover"}),f&&e.jsxs(u,{variant:"secondary",size:"sm",className:"absolute top-4 right-4",onClick:()=>{var s;return(s=document.getElementById("banner-upload"))==null?void 0:s.click()},children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Change Banner"]}),e.jsx("input",{id:"banner-upload",type:"file",accept:"image/*",className:"hidden",onChange:s=>{var d;const r=(d=s.target.files)==null?void 0:d[0];r&&D(r,"banner")}})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/60 to-transparent",children:e.jsxs("div",{className:"flex items-end gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(ie,{className:"w-32 h-32 border-4 border-white",children:[e.jsx(ae,{src:i.profileImageUrl}),e.jsx(te,{className:"text-3xl bg-blue-600",children:(I=V(i)[0])==null?void 0:I.toUpperCase()})]}),f&&e.jsx(u,{variant:"secondary",size:"sm",className:"absolute -bottom-2 -right-2 rounded-full w-8 h-8 p-0",onClick:()=>{var s;return(s=document.getElementById("profile-upload"))==null?void 0:s.click()},children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx("input",{id:"profile-upload",type:"file",accept:"image/*",className:"hidden",onChange:s=>{var d;const r=(d=s.target.files)==null?void 0:d[0];r&&D(r,"profile")}})]}),e.jsxs("div",{className:"flex-1 text-white",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:V(i)}),i.isVerified&&e.jsxs(N,{variant:"secondary",className:"bg-green-500",children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),"Verified"]}),e.jsx(N,{className:W(i.civicLevel),children:i.civicLevel})]}),i.occupation&&e.jsxs("p",{className:"text-lg opacity-90 mb-1",children:[e.jsx($,{className:"w-4 h-4 inline mr-2"}),i.occupation]}),i.city&&i.province&&e.jsxs("p",{className:"text-lg opacity-90 mb-1",children:[e.jsx(le,{className:"w-4 h-4 inline mr-2"}),i.city,", ",i.province]}),i.bio&&e.jsx("p",{className:"text-lg opacity-90 mt-2 max-w-2xl",children:i.bio})]}),e.jsx("div",{className:"flex gap-2",children:f?e.jsxs(u,{onClick:()=>b(!0),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Edit Profile"]}):e.jsxs(e.Fragment,{children:[e.jsxs(u,{onClick:()=>z.mutate(),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Add Friend"]}),e.jsxs(u,{variant:"outline",onClick:()=>H.mutate(),children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),"Message"]})]})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(je,{value:R,onValueChange:Q,children:[e.jsxs(ue,{className:"grid w-full grid-cols-4",children:[e.jsx(w,{value:"overview",children:"Overview"}),e.jsx(w,{value:"activity",children:"Activity"}),e.jsx(w,{value:"social",children:"Social"}),e.jsx(w,{value:"civic",children:"Civic"})]}),e.jsxs(C,{value:"overview",className:"space-y-6",children:[f&&e.jsxs(o,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5"}),"Profile Completion"]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Profile Complete"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[i.profileCompletionPercentage,"%"]})]}),e.jsx(pe,{value:i.profileCompletionPercentage,className:"h-2"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Complete your profile to unlock more features and increase your civic impact score."})]})})]}),e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(p,{children:"About"})}),e.jsxs(x,{className:"space-y-4",children:[i.bio?e.jsx("p",{className:"text-gray-700",children:i.bio}):e.jsx("p",{className:"text-gray-500 italic",children:"No bio added yet."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.occupation&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:i.occupation})]}),i.education&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:i.education})]}),i.website&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-gray-500"}),e.jsx("a",{href:i.website,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline",children:i.website})]}),i.politicalAffiliation&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:i.politicalAffiliation})]})]}),i.interests&&i.interests.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Interests"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.interests.map((s,r)=>e.jsx(N,{variant:"secondary",children:s},r))})]})]})]}),e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(p,{children:"Civic Engagement"})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(a==null?void 0:a.totalVotes)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Votes Cast"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(a==null?void 0:a.totalPetitions)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Petitions Signed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:(a==null?void 0:a.totalDiscussions)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Discussions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(a==null?void 0:a.totalContacts)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Contacts"})]})]})})]})]}),e.jsx(C,{value:"activity",className:"space-y-6",children:e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(p,{children:"Recent Activity"})}),e.jsx(x,{children:F&&F.length>0?e.jsx("div",{className:"space-y-4",children:F.map(s=>e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ne,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.description}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date(s.timestamp).toLocaleDateString()})]})]},s.id))}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No recent activity"})})]})}),e.jsx(C,{value:"social",className:"space-y-6",children:e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(p,{children:"Social Stats"})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:i.friendsCount||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Friends"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:i.postsCount||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Posts"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:i.profileViews||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Profile Views"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(a==null?void 0:a.streakDays)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Day Streak"})]})]})})]})}),e.jsx(C,{value:"civic",className:"space-y-6",children:e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(p,{children:"Civic Achievements"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{className:"w-6 h-6 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Civic Points"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Earned through engagement"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:(a==null?void 0:a.civicPoints)||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"points"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"w-6 h-6 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Trust Score"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Based on verification"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-2xl font-bold ${X((a==null?void 0:a.trustScore)||0)}`,children:[(a==null?void 0:a.trustScore)||0,"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"trust"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Pe,{className:"w-6 h-6 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Achievements"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Badges earned"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:(a==null?void 0:a.achievementCount)||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"badges"})]})]})]})})]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(p,{className:"text-lg",children:"Quick Stats"})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Member Since"}),e.jsx("span",{className:"text-sm font-medium",children:i.createdAt?new Date(i.createdAt).toLocaleDateString():"Unknown"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Verification"}),e.jsx(N,{variant:i.isVerified?"default":"secondary",children:i.verificationLevel||"Unverified"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Profile Visibility"}),e.jsx(N,{variant:"outline",children:i.profileVisibility||"Public"})]})]})]}),i.socialLinks&&Object.keys(i.socialLinks).length>0&&e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(p,{className:"text-lg",children:"Social Links"})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-2",children:Object.entries(i.socialLinks||{}).map(([s,r])=>e.jsxs("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-blue-600 hover:underline",children:[e.jsx(G,{className:"w-4 h-4"}),s]},s))})})]})]})]}),e.jsx(ce,{open:K,onOpenChange:b,children:e.jsxs(de,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsx(xe,{children:"Edit Profile"}),e.jsx(me,{children:"Update your profile information and customize your appearance."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"firstName",children:"First Name"}),e.jsx(j,{id:"firstName",value:t.firstName||i.firstName||"",onChange:s=>n({...t,firstName:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"lastName",children:"Last Name"}),e.jsx(j,{id:"lastName",value:t.lastName||i.lastName||"",onChange:s=>n({...t,lastName:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"bio",children:"Bio"}),e.jsx(he,{id:"bio",placeholder:"Tell us about yourself...",value:t.bio||i.bio||"",onChange:s=>n({...t,bio:s.target.value}),rows:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"occupation",children:"Occupation"}),e.jsx(j,{id:"occupation",value:t.occupation||i.occupation||"",onChange:s=>n({...t,occupation:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"education",children:"Education"}),e.jsx(j,{id:"education",value:t.education||i.education||"",onChange:s=>n({...t,education:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"city",children:"City"}),e.jsx(j,{id:"city",value:t.city||i.city||"",onChange:s=>n({...t,city:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"province",children:"Province"}),e.jsx(j,{id:"province",value:t.province||i.province||"",onChange:s=>n({...t,province:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"website",children:"Website"}),e.jsx(j,{id:"website",type:"url",placeholder:"https://yourwebsite.com",value:t.website||i.website||"",onChange:s=>n({...t,website:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"politicalAffiliation",children:"Political Affiliation (Optional)"}),e.jsx(j,{id:"politicalAffiliation",placeholder:"e.g., Liberal, Conservative, Independent",value:t.politicalAffiliation||i.politicalAffiliation||"",onChange:s=>n({...t,politicalAffiliation:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"profileVisibility",children:"Profile Visibility"}),e.jsxs(ge,{value:t.profileVisibility||i.profileVisibility||"public",onValueChange:s=>n({...t,profileVisibility:s}),children:[e.jsx(ve,{children:e.jsx(fe,{})}),e.jsxs(Ne,{children:[e.jsx(L,{value:"public",children:"Public"}),e.jsx(L,{value:"friends",children:"Friends Only"}),e.jsx(L,{value:"private",children:"Private"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{onClick:_,disabled:P.isPending,children:P.isPending?"Saving...":"Save Changes"}),e.jsx(u,{variant:"outline",onClick:()=>b(!1),children:"Cancel"})]})]})]})})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(o,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"User Not Found"}),e.jsx("p",{className:"text-gray-600",children:"The user profile you're looking for doesn't exist."})]})})})})}export{Re as default};
