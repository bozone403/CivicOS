import{j as e}from"./ui-CDUWW_Ri.js";import{r as h}from"./vendor-1XCZ5AD1.js";import{z as _,q as D,g as w,W as $,l as G,ai as H,B as p,J,ao as E,U as M,ap as W}from"./index-CxE8SzRb.js";import{a as K,g as O,h as V,i as Y,e as Z}from"./useCivicSocial-C0Kjcmq_.js";import{U as q}from"./user-check-dDGZ2-cn.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=_("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function ne(){const{user:a}=D(),{data:n,isLoading:ee,error:se}=K(),g=(n==null?void 0:n.friends)||[],N=(n==null?void 0:n.received)||[],u=(n==null?void 0:n.sent)||[],k=O(),P=V(),y=Y(),A=Z(),[f,R]=h.useState(""),[I,S]=h.useState([]),[T,U]=h.useState(!1),[z,C]=h.useState(null),[ae,X]=h.useState(null);h.useEffect(()=>{if(f.length<2){S([]),C(null);return}const i=setTimeout(async()=>{U(!0),C(null);try{const t=await W(`/api/users/search?q=${encodeURIComponent(f)}`,"GET");if(t.users){const r=t.users.filter(c=>{const d=c.id===(a==null?void 0:a.id),m=g.some(l=>l.id===c.id),o=u.some(l=>l.friendId===c.id),x=N.some(l=>l.userId===c.id);return!d&&!m&&!o&&!x});S(r)}}catch{C("Failed to search users")}finally{U(!1)}},300);return()=>clearTimeout(i)},[f,g,u,N,a==null?void 0:a.id]);const B=async s=>{try{await k.mutateAsync({friendId:parseInt(s)}),A.mutate({userId:s,type:"friend_request",title:"New Friend Request",message:`${(a==null?void 0:a.firstName)||(a==null?void 0:a.email)||"A user"} sent you a friend request.`}),R(""),S([]),X(null)}catch{}},Q=async s=>{try{await P.mutateAsync({friendId:parseInt(s)}),A.mutate({userId:s,type:"friend_accept",title:"Friend Request Accepted",message:`${(a==null?void 0:a.firstName)||(a==null?void 0:a.email)||"A user"} accepted your friend request!`})}catch{}},F=async s=>{try{await y.mutateAsync({friendId:parseInt(s)})}catch{}};return e.jsxs("div",{className:"max-w-4xl mx-auto flex flex-col gap-6",children:[e.jsxs(w,{className:"p-6 mb-4 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx($,{className:"w-8 h-8 text-civic-blue"}),e.jsx("div",{className:"font-bold text-2xl text-civic-blue",children:"Add Friends"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex gap-2 mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-10 pr-4 py-2 border rounded-lg bg-background focus:ring-2 focus:ring-civic-blue",placeholder:"Search users by name or email...",value:f,onChange:s=>R(s.target.value),disabled:k.isPending})]})}),f.length>=2&&e.jsx("div",{className:"absolute z-10 w-full bg-white dark:bg-slate-800 border rounded-lg shadow-lg max-h-60 overflow-y-auto",children:T?e.jsxs("div",{className:"p-4 text-center",children:[e.jsx(H,{className:"w-4 h-4 animate-spin mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Searching..."})]}):z?e.jsx("div",{className:"p-4 text-center text-red-500",children:e.jsx("p",{className:"text-sm",children:z})}):I.length>0?e.jsx("div",{className:"py-2",children:I.map(s=>{var i,t;return e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-50 dark:hover:bg-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-civic-blue rounded-full flex items-center justify-center text-white font-bold",children:[(i=s.firstName)==null?void 0:i[0],(t=s.lastName)==null?void 0:t[0]]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),s.civicPoints&&e.jsxs("p",{className:"text-xs text-civic-gold",children:["Civic Points: ",s.civicPoints]})]})]}),e.jsxs(p,{size:"sm",onClick:()=>B(s.id),disabled:k.isPending,className:"bg-civic-blue hover:bg-civic-gold",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Add Friend"]})]},s.id)})}):e.jsx("div",{className:"p-4 text-center text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No users found"})})})]})]}),N.length>0&&e.jsxs(w,{className:"p-6 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(q,{className:"w-6 h-6 text-green-600"}),e.jsxs("h3",{className:"font-bold text-xl text-green-600",children:["Friend Requests (",N.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:N.map(s=>{var i,t,r,c,d,m,o,x,l,j,v,b;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold",children:((t=(i=s.user)==null?void 0:i.firstName)==null?void 0:t[0])||((c=(r=s.user)==null?void 0:r.lastName)==null?void 0:c[0])||((m=(d=s.user)==null?void 0:d.email)==null?void 0:m[0])||"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(o=s.user)!=null&&o.firstName&&((x=s.user)!=null&&x.lastName)?`${s.user.firstName} ${s.user.lastName}`:((l=s.user)==null?void 0:l.firstName)||((j=s.user)==null?void 0:j.lastName)||((v=s.user)==null?void 0:v.email)||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-500",children:((b=s.user)==null?void 0:b.email)||"No email"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{size:"sm",onClick:()=>Q(s.userId),disabled:P.isPending,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"Accept"]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>F(s.userId),disabled:y.isPending,children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),"Decline"]})]})]},s.id)})})]}),u.length>0&&e.jsxs(w,{className:"p-6 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(L,{className:"w-6 h-6 text-yellow-600"}),e.jsxs("h3",{className:"font-bold text-xl text-yellow-600",children:["Pending Requests (",u.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:u.map(s=>{var i,t,r,c,d,m,o,x,l,j,v,b;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-600 rounded-full flex items-center justify-center text-white font-bold",children:((t=(i=s.friend)==null?void 0:i.firstName)==null?void 0:t[0])||((c=(r=s.friend)==null?void 0:r.lastName)==null?void 0:c[0])||((m=(d=s.friend)==null?void 0:d.email)==null?void 0:m[0])||"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(o=s.friend)!=null&&o.firstName&&((x=s.friend)!=null&&x.lastName)?`${s.friend.firstName} ${s.friend.lastName}`:((l=s.friend)==null?void 0:l.firstName)||((j=s.friend)==null?void 0:j.lastName)||((v=s.friend)==null?void 0:v.email)||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-500",children:((b=s.friend)==null?void 0:b.email)||"No email"})]})]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>F(s.friendId),disabled:y.isPending,children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),"Cancel"]})]},s.id)})})]}),e.jsxs(w,{className:"p-6 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(M,{className:"w-6 h-6 text-civic-blue"}),e.jsxs("h3",{className:"font-bold text-xl text-civic-blue",children:["My Friends (",g.length,")"]})]}),g.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No friends yet. Start by searching for users above!"})]}):e.jsx("div",{className:"grid gap-3",children:g.map(s=>{var i,t,r;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-civic-blue rounded-full flex items-center justify-center text-white font-bold",children:((i=s.firstName)==null?void 0:i[0])||((t=s.lastName)==null?void 0:t[0])||((r=s.email)==null?void 0:r[0])||"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.firstName||s.lastName||s.email||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email||"No email"}),s.civicPoints&&e.jsxs("p",{className:"text-xs text-civic-gold",children:["Civic Points: ",s.civicPoints]})]})]}),e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>F(s.id),disabled:y.isPending,className:"text-red-600 hover:text-red-700",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"Remove"]})]},s.id)})})]})]})}export{ne as default};
