import{j as e}from"./ui-CDUWW_Ri.js";import{r as l}from"./vendor-1XCZ5AD1.js";import{z as L,q as F,p as Q,E as R,K as A,r as V,B as i,l as E,I as g,ae as I,_ as p,X as k,Y as $,Z as q,v as B,P as O,aj as _,aq as G,a1 as H,a0 as X,a2 as Y,D as Z,a as J,b as W,c as ee,d as se,y as u}from"./index-D74MF8tO.js";import{P as ae}from"./plus-CuO_8g7V.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=L("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);function me(){var S,C;const{user:r}=F(),{toast:D}=Q(),j=R(),[a,P]=l.useState(null),[n,N]=l.useState(""),[m,y]=l.useState(""),v=l.useRef(null),[z,f]=l.useState(!1),[re,ie]=l.useState(null),{data:c=[],isLoading:T}=A({queryKey:["civicSocialConversations"],queryFn:async()=>{const s=await u("/api/social/conversations","GET");return s.success?s.conversations:[]},staleTime:3e4}),{data:x=[],isLoading:U}=A({queryKey:["civicSocialMessages",a],queryFn:async()=>{if(!a)return[];const s=await u(`/api/social/messages/${a}`,"GET");return s.success?s.messages:[]},enabled:!!a,staleTime:1e4}),o=V({mutationFn:async({recipientId:s,content:t})=>u("/api/social/messages","POST",{recipientId:s,content:t}),onSuccess:()=>{j.invalidateQueries({queryKey:["civicSocialMessages",a]}),j.invalidateQueries({queryKey:["civicSocialConversations"]}),N("")},onError:()=>{D({title:"Error",description:"Failed to send message",variant:"destructive"})}});l.useEffect(()=>{var s;(s=v.current)==null||s.scrollIntoView({behavior:"smooth"})},[x]);const b=()=>{!n.trim()||!a||o.mutate({recipientId:a,content:n.trim()})},K=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),b())},h=s=>s.participant?`${s.participant.firstName||""} ${s.participant.lastName||""}`.trim()||s.participant.email:"Unknown User",w=s=>{if(s.participant){const t=s.participant.firstName||"",d=s.participant.lastName||"";return`${t.charAt(0)}${d.charAt(0)}`.toUpperCase()||s.participant.email.charAt(0).toUpperCase()}return"?"};return e.jsxs("div",{className:"flex h-screen bg-white",children:[e.jsxs("div",{className:"w-80 border-r border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Messages"}),e.jsxs(i,{size:"sm",onClick:()=>f(!0),className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"New"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(g,{placeholder:"Search conversations...",value:m,onChange:s=>y(s.target.value),className:"pl-10"})]})]}),e.jsx(I,{className:"h-[calc(100vh-120px)]",children:T?e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3 animate-pulse"})]})]},t))})}):c.length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(p,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No conversations yet"}),e.jsx("p",{className:"text-sm",children:"Start a conversation to begin messaging"})]}):e.jsx("div",{className:"p-2",children:c.filter(s=>h(s).toLowerCase().includes(m.toLowerCase())).map(s=>{var t,d,M;return e.jsxs("div",{onClick:()=>P(s.id),className:`flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-colors ${a===s.id?"bg-blue-50 border border-blue-200":"hover:bg-gray-100"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsxs(k,{className:"w-10 h-10",children:[e.jsx($,{src:(t=s.participant)==null?void 0:t.profileImageUrl}),e.jsx(q,{children:w(s)})]}),((d=s.participant)==null?void 0:d.isOnline)&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 border-2 border-white rounded-full"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:h(s)}),s.unreadCount>0&&e.jsx(B,{variant:"destructive",className:"text-xs",children:s.unreadCount})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:typeof s.lastMessage=="string"?s.lastMessage:((M=s.lastMessage)==null?void 0:M.content)||"No messages yet"})]})]},s.id)})})})]}),e.jsx("div",{className:"flex-1 flex flex-col bg-white",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(k,{className:"w-8 h-8",children:[e.jsx($,{src:(C=(S=c.find(s=>s.id===a))==null?void 0:S.participant)==null?void 0:C.profileImageUrl}),e.jsx(q,{children:w(c.find(s=>s.id===a)||{})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:h(c.find(s=>s.id===a)||{})}),e.jsx("p",{className:"text-sm text-gray-500",children:"Active now"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{size:"sm",variant:"ghost",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx(i,{size:"sm",variant:"ghost",children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx(i,{size:"sm",variant:"ghost",children:e.jsx(te,{className:"w-4 h-4"})})]})]})}),e.jsx(I,{className:"flex-1 p-4 bg-gray-50",children:U?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,t)=>e.jsx("div",{className:`flex ${t%2===0?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${t%2===0?"bg-blue-500 text-white":"bg-white border"}`,children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})})},t))}):x.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(p,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Start the conversation!"})]}):e.jsxs("div",{className:"space-y-4",children:[x.map(s=>e.jsx("div",{className:`flex ${s.senderId===(r==null?void 0:r.id)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${s.senderId===(r==null?void 0:r.id)?"bg-blue-500 text-white":"bg-white border border-gray-200"}`,children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsx("p",{className:`text-xs mt-1 ${s.senderId===(r==null?void 0:r.id)?"text-blue-100":"text-gray-500"}`,children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},s.id)),e.jsx("div",{ref:v})]})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{size:"sm",variant:"ghost",children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx(i,{size:"sm",variant:"ghost",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx(i,{size:"sm",variant:"ghost",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex-1",children:e.jsx(g,{placeholder:"Type a message...",value:n,onChange:s=>N(s.target.value),onKeyPress:K,disabled:o.isPending})}),e.jsx(i,{onClick:b,disabled:!n.trim()||o.isPending,size:"sm",children:e.jsx(Y,{className:"w-4 h-4"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(p,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Select a conversation"}),e.jsx("p",{className:"text-sm",children:"Choose a conversation from the sidebar to start messaging"})]})})}),e.jsx(Z,{open:z,onOpenChange:f,children:e.jsxs(J,{className:"sm:max-w-md",children:[e.jsxs(W,{children:[e.jsx(ee,{children:"New Conversation"}),e.jsx(se,{children:"Start a new conversation with another user"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(g,{placeholder:"Search users...",value:m,onChange:s=>y(s.target.value),className:"pl-10"})]}),e.jsx("div",{className:"text-center text-gray-500",children:e.jsx("p",{children:"User search functionality coming soon..."})})]})]})})]})}export{me as default};
