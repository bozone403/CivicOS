import{j as e}from"./ui-CDUWW_Ri.js";import{r as a}from"./vendor-1XCZ5AD1.js";import{z as Y,q as J,p as V,E as W,r as X,y as F,g as I,j as L,R as Z,B as g,X as G,Y as _,Z as ee,$ as se,v as te,M as ae,ak as re,al as ie,am as ne}from"./index-DhTCSRfs.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=Y("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);function de({onPostCreated:m,placeholder:U="What's on your mind?",showLocation:A=!0,showMood:M=!0,showTags:R=!0,showVisibility:D=!0,showImageUpload:E=!0,className:h="",autoFocus:z=!1}){var T,q;const{user:i}=J(),{toast:n}=V(),v=W(),[l,f]=a.useState(""),[j,y]=a.useState("public"),[b,N]=a.useState(""),[w,S]=a.useState(""),[r,d]=a.useState([]),[c,p]=a.useState(null),[P,x]=a.useState(null),[C,k]=a.useState(!1),O=X({mutationFn:async s=>F("/api/social/posts","POST",s),onSuccess:()=>{n({title:"Post created!",description:"Your post has been shared to your profile and the feed."}),v.invalidateQueries({queryKey:["social-posts"]}),v.invalidateQueries({queryKey:["user-posts"]}),B(),m==null||m()},onError:s=>{n({title:"Post failed",description:s.message||"Failed to create post. Please try again.",variant:"destructive"})}}),B=()=>{f(""),y("public"),N(""),S(""),d([]),p(null),x(null)},K=s=>{var o;const t=(o=s.target.files)==null?void 0:o[0];t&&(p(t),x(URL.createObjectURL(t)))},Q=async s=>{if(s.preventDefault(),!l.trim()&&!c){n({title:"Content required",description:"Please enter some content or upload an image.",variant:"destructive"});return}if(!i){n({title:"Login required",description:"Please log in to create posts.",variant:"destructive"});return}k(!0);try{let t=null;if(c){const u=new FormData;u.append("image",c),t=(await F("/api/upload/image","POST",u)).imageUrl}const o={content:l.trim(),type:"post",visibility:j,imageUrl:t,location:b.trim()||void 0,mood:w.trim()||void 0,tags:r.filter(u=>u.trim())};O.mutate(o)}catch(t){console.error("Post creation error:",t),n({title:"Post failed",description:"Failed to create post. Please try again.",variant:"destructive"})}finally{k(!1)}},$=s=>{if(s.key==="Enter"||s.key===","){s.preventDefault();const t=s.currentTarget.value.trim();t&&!r.includes(t)&&(d([...r,t]),s.currentTarget.value="")}},H=s=>{d(r.filter(t=>t!==s))};return i?e.jsx(I,{className:`p-4 ${h}`,children:e.jsx(L,{className:"p-0",children:e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(G,{className:"w-10 h-10",children:[e.jsx(_,{src:i.profileImageUrl}),e.jsx(ee,{className:"bg-blue-600",children:((T=i.firstName)==null?void 0:T[0])||((q=i.email)==null?void 0:q[0])||"U"})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx(se,{placeholder:U,value:l,onChange:s=>f(s.target.value),className:"min-h-[100px] resize-none border-0 focus:ring-0 p-0 text-base",autoFocus:z,maxLength:1e3}),P&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:P,alt:"Preview",className:"max-w-xs max-h-48 rounded-lg object-cover"}),e.jsx(g,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 w-6 h-6 p-0",onClick:()=>{p(null),x(null)},children:"×"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[R&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Add tags (press Enter or comma)",onKeyDown:$,className:"flex-1 text-sm border-0 focus:ring-0 p-0 bg-transparent"})]}),r.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((s,t)=>e.jsxs(te,{variant:"secondary",className:"text-xs",children:["#",s,e.jsx("button",{type:"button",onClick:()=>H(s),className:"ml-1 hover:text-red-600",children:"×"})]},t))})]}),e.jsxs("div",{className:"flex gap-4",children:[A&&e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Add location",value:b,onChange:s=>N(s.target.value),className:"flex-1 text-sm border-0 focus:ring-0 p-0 bg-transparent"})]}),M&&e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(re,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"How are you feeling?",value:w,onChange:s=>S(s.target.value),className:"flex-1 text-sm border-0 focus:ring-0 p-0 bg-transparent"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[E&&e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-500 hover:text-blue-600"}),e.jsx("input",{type:"file",accept:"image/*",onChange:K,className:"hidden"})]}),D&&e.jsxs("select",{value:j,onChange:s=>y(s.target.value),className:"text-sm border-0 focus:ring-0 p-0 bg-transparent",children:[e.jsx("option",{value:"public",children:"Public"}),e.jsx("option",{value:"friends",children:"Friends"}),e.jsx("option",{value:"private",children:"Private"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[l.length,"/1000"]}),e.jsxs(g,{type:"submit",disabled:!l.trim()&&!c||C,size:"sm",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),C?"Posting...":"Post"]})]})]})]})]})})}):e.jsx(I,{className:`p-4 ${h}`,children:e.jsxs(L,{className:"text-center py-8",children:[e.jsx(Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Login to Post"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Join the conversation by logging in to your CivicOS account."}),e.jsx(g,{onClick:()=>window.location.href="/auth",children:"Login to Post"})]})})}export{de as U};
