import{j as e}from"./ui-CDUWW_Ri.js";import{r}from"./vendor-1XCZ5AD1.js";import{z as Z,q as J,p as ee,E as se,K as ae,r as d,g,j as v,R as te,U as ie,Q as re,h as L,i as M,v as h,D as le,a as ne,b as ce,c as oe,X as A,Y as D,Z as q,I as de,y as c,B as m,an as me,M as xe,ak as he,a2 as ue,_ as pe}from"./index-DhTCSRfs.js";import{T as je,a as ge,b as y,c as N}from"./tabs-Do8ugyXE.js";import{U as ve}from"./UnifiedSocialPost-DvKvhjGV.js";import{T as ye}from"./trending-up-CNZk-Mmg.js";import{S as Ne}from"./star-B-cigtIa.js";import{C as fe}from"./clock-B1u3n-hF.js";import{G as be}from"./globe-B6u_KmDf.js";import{S as we}from"./square-pen-BdtyGef7.js";import{T as ke}from"./trash-2-BiIZA0_l.js";import{S as Pe}from"./share-Br3Ooxjg.js";import{B as Ce}from"./bookmark-Cro-U_Mo.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=Z("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);function Xe(){var S;const{user:l,isAuthenticated:Fe}=J(),{toast:t}=ee(),n=se(),[Te,U]=r.useState(!1),[Ee,$]=r.useState({content:"",type:"post",visibility:"public",tags:[],location:"",mood:""}),[Le,Me]=r.useState(null),[Ae,De]=r.useState(""),[u,p]=r.useState(null);r.useEffect(()=>{const s=a=>{u!==null&&p(null)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[u]);const[f,B]=r.useState("all"),[j,k]=r.useState(null),[qe,Ue]=r.useState(!1),[P,$e]=r.useState({type:"all",visibility:"all",sortBy:"recent"}),{data:x,isLoading:K}=ae({queryKey:["social-posts",f,P],queryFn:async()=>{const s=new URLSearchParams({tab:f,...P});return(await c(`/api/social/posts?${s}`,"GET")).posts||[]}});d({mutationFn:async s=>{if(!l)throw new Error("Please log in to create posts");return c("/api/social/posts","POST",s)},onSuccess:()=>{t({title:"Post Created",description:"Your post has been published successfully."}),n.invalidateQueries({queryKey:["social-posts"]}),U(!1),$({content:"",type:"post",visibility:"public",tags:[]})},onError:s=>{console.error("Post creation error:",s),t({title:"Post Failed",description:s.message||"Failed to create post. Please check your connection and try again.",variant:"destructive"})}});const Q=d({mutationFn:async({postId:s,action:a})=>c(`/api/social/posts/${s}/like`,"POST",{action:a}),onSuccess:()=>{n.invalidateQueries({queryKey:["social-posts"]})},onError:s=>{t({title:"Action Failed",description:s.message||"Failed to perform action.",variant:"destructive"})}}),z=d({mutationFn:async({postId:s,content:a})=>c(`/api/social/posts/${s}/comments`,"POST",{content:a}),onSuccess:()=>{n.invalidateQueries({queryKey:["social-posts"]}),t({title:"Comment Added",description:"Your comment has been posted."})},onError:s=>{t({title:"Comment Failed",description:s.message||"Failed to post comment.",variant:"destructive"})}}),I=d({mutationFn:async({postId:s,comment:a})=>c(`/api/social/posts/${s}/share`,"POST",{comment:a}),onSuccess:()=>{n.invalidateQueries({queryKey:["social-posts"]}),t({title:"Post Shared",description:"Your post has been shared successfully."})},onError:s=>{t({title:"Share Failed",description:s.message||"Failed to share post.",variant:"destructive"})}}),O=d({mutationFn:async({postId:s,action:a})=>c(`/api/social/posts/${s}/bookmark`,"POST",{action:a}),onSuccess:()=>{n.invalidateQueries({queryKey:["social-posts"]})},onError:s=>{t({title:"Bookmark Failed",description:s.message||"Failed to bookmark post.",variant:"destructive"})}});d({mutationFn:async({postId:s,updates:a})=>c(`/api/social/posts/${s}`,"PUT",a),onSuccess:()=>{n.invalidateQueries({queryKey:["social-posts"]}),t({title:"Post Updated",description:"Your post has been updated successfully."})},onError:s=>{t({title:"Update Failed",description:s.message||"Failed to update post.",variant:"destructive"})}});const Y=d({mutationFn:async s=>c(`/api/social/posts/${s}`,"DELETE"),onSuccess:()=>{n.invalidateQueries({queryKey:["social-posts"]}),t({title:"Post Deleted",description:"Your post has been deleted successfully."})},onError:s=>{t({title:"Delete Failed",description:s.message||"Failed to delete post.",variant:"destructive"})}}),H=s=>{Q.mutate({postId:s.id,action:s.isLiked?"unlike":"like"})},R=(s,a)=>{a.trim()&&z.mutate({postId:s,content:a})},G=s=>{I.mutate({postId:s.id})},V=s=>{O.mutate({postId:s.id,action:s.isBookmarked?"unbookmark":"bookmark"})},b=s=>s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.firstName?s.firstName:s.email?s.email.split("@")[0]:"Anonymous User",W=s=>{switch(s==null?void 0:s.toLowerCase()){case"champion":return"bg-purple-500";case"expert":return"bg-blue-500";case"advocate":return"bg-green-500";case"active":return"bg-yellow-500";default:return"bg-gray-500"}},_=s=>{const a=new Date(s),i=Math.floor((new Date().getTime()-a.getTime())/1e3);return i<60?"just now":i<3600?`${Math.floor(i/60)}m ago`:i<86400?`${Math.floor(i/3600)}h ago`:i<2592e3?`${Math.floor(i/86400)}d ago`:a.toLocaleDateString()},C=({post:s})=>{var a,w,i,F,T,E;return e.jsx(g,{className:"mb-6 hover:shadow-md transition-shadow",children:e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(A,{className:"w-10 h-10",children:[e.jsx(D,{src:(a=s.user)==null?void 0:a.profileImageUrl}),e.jsx(q,{className:"bg-blue-600",children:(w=b(s.user)[0])==null?void 0:w.toUpperCase()})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:b(s.user)}),((i=s.user)==null?void 0:i.isVerified)&&e.jsxs(h,{variant:"secondary",children:[e.jsx(Ne,{className:"w-3 h-3 mr-1"}),"Verified"]}),e.jsx(h,{className:`text-xs ${W(((F=s.user)==null?void 0:F.civicLevel)||"")}`,children:((T=s.user)==null?void 0:T.civicLevel)||"Registered"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(fe,{className:"w-3 h-3"}),_(s.createdAt),s.visibility!=="public"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx(be,{className:"w-3 h-3"}),s.visibility]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:o=>{o.stopPropagation(),p(u===s.id?null:s.id)},children:e.jsx(me,{className:"w-4 h-4"})}),((E=s.user)==null?void 0:E.id)===(l==null?void 0:l.id)&&u===s.id&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white border rounded-md shadow-lg z-10 min-w-[120px]",children:[e.jsxs(m,{variant:"ghost",size:"sm",className:"w-full justify-start",onClick:o=>{o.stopPropagation(),p(null),t({title:"Edit Feature",description:"Post editing will be available soon."})},children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Edit"]}),e.jsxs(m,{variant:"ghost",size:"sm",className:"w-full justify-start text-red-600 hover:text-red-700",onClick:o=>{o.stopPropagation(),p(null),confirm("Are you sure you want to delete this post?")&&Y.mutate(s.id)},children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:s.content}),s.imageUrl&&e.jsx("div",{className:"mt-4",children:e.jsx("img",{src:s.imageUrl,alt:"Post image",className:"rounded-lg max-w-full h-auto"})}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:s.tags.map((o,X)=>e.jsxs(h,{variant:"outline",className:"text-xs",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),o]},X))}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-sm text-gray-600",children:[s.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3"}),s.location]}),s.mood&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),s.mood]})]})]}),e.jsx("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:[s.likesCount," likes"]}),e.jsxs("span",{children:[s.commentsCount," comments"]}),e.jsxs("span",{children:[s.sharesCount," shares"]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>H(s),className:s.isLiked?"text-red-600":"",children:[e.jsx(ue,{className:`w-4 h-4 mr-2 ${s.isLiked?"fill-current":""}`}),"Like"]}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>k(s),children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Comment"]}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>G(s),children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Share"]}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>V(s),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),s.isBookmarked?"Saved":"Save"]})]})]})})};return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"CivicSocial Feed"}),e.jsx("p",{className:"text-gray-600",children:"Connect with fellow citizens and share your civic engagement"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("div",{className:"mb-6",children:e.jsx(ve,{placeholder:"What's on your mind?",onPostCreated:()=>{n.invalidateQueries({queryKey:["social-posts"]})}})}),e.jsxs(je,{value:f,onValueChange:B,children:[e.jsxs(ge,{className:"grid w-full grid-cols-4",children:[e.jsx(y,{value:"all",children:"All Posts"}),e.jsx(y,{value:"friends",children:"Friends"}),e.jsx(y,{value:"trending",children:"Trending"}),e.jsx(y,{value:"my-posts",children:"My Posts"})]}),e.jsx(N,{value:"all",className:"mt-6",children:K?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading posts..."})]}):(x==null?void 0:x.length)===0?e.jsx(g,{children:e.jsxs(v,{className:"p-8 text-center",children:[e.jsx(te,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-gray-600",children:"Be the first to share your civic thoughts and experiences!"})]})}):e.jsx("div",{children:x==null?void 0:x.map(s=>e.jsx(C,{post:s},s.id))})}),e.jsx(N,{value:"friends",className:"mt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ie,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Friends' Posts"}),e.jsx("p",{className:"text-gray-600",children:"Posts from your friends will appear here."})]})}),e.jsx(N,{value:"trending",className:"mt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ye,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Trending Posts"}),e.jsx("p",{className:"text-gray-600",children:"Most popular and engaging posts will appear here."})]})}),e.jsx(N,{value:"my-posts",className:"mt-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"My Posts"}),e.jsx("p",{className:"text-gray-600",children:"Your posts will appear here."})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(L,{children:e.jsx(M,{className:"text-lg",children:"Your Activity"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Posts Created"}),e.jsx("span",{className:"text-sm font-medium",children:"0"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Likes Given"}),e.jsx("span",{className:"text-sm font-medium",children:"0"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Comments Made"}),e.jsx("span",{className:"text-sm font-medium",children:"0"})]})]})]}),e.jsxs(g,{children:[e.jsx(L,{children:e.jsx(M,{className:"text-lg",children:"Trending Topics"})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"#CivicEngagement"}),e.jsx(h,{variant:"secondary",children:"Hot"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"#LocalPolitics"}),e.jsx(h,{variant:"secondary",children:"Trending"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"#CommunityAction"}),e.jsx(h,{variant:"secondary",children:"New"})]})]})})]})]})]}),e.jsx(le,{open:!!j,onOpenChange:()=>k(null),children:e.jsxs(ne,{className:"max-w-2xl",children:[e.jsx(ce,{children:e.jsx(oe,{children:"Post Details"})}),j&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{post:j}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Comments"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(A,{className:"w-8 h-8",children:[e.jsx(D,{src:l==null?void 0:l.profileImageUrl}),e.jsx(q,{className:"bg-blue-600 text-xs",children:(S=b(l)[0])==null?void 0:S.toUpperCase()})]}),e.jsx("div",{className:"flex-1",children:e.jsx(de,{placeholder:"Write a comment...",onKeyPress:s=>{s.key==="Enter"&&s.currentTarget.value.trim()&&(R(j.id,s.currentTarget.value),s.currentTarget.value="")}})})]}),e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No comments yet. Be the first to comment!"})]})]})]})]})})]})}export{Xe as default};
