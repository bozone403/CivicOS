import{j as e}from"./ui-B-8yHimL.js";import{r as c}from"./vendor-DRd396Ms.js";import{c as X,r as ue,q as he,E as pe,J as M,s as x,x as o,h as u,k as h,R as f,W as C,X as b,Q as w,B as t,ak as Q,i as je,am as K,a4 as O,a5 as ge,a0 as Ne,D as Y,a as H,b as W,d as B}from"./index-Brrh0oBT.js";import{I as ve}from"./image-CO2RgLqk.js";import{S as ye}from"./smile-BHfGHjlf.js";import{T as G}from"./trash-2-B_B587Dw.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=X("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=X("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);function Ce(){var A,L;const{user:i,isAuthenticated:k}=ue(),{toast:n}=he(),d=pe(),[p,S]=c.useState(""),[j,P]=c.useState(""),[a,_]=c.useState(null),[V,g]=c.useState(!1),[Z,I]=c.useState(!1),[be,F]=c.useState(null),[m,N]=c.useState(null),[l,E]=c.useState(null),[v,q]=c.useState(""),ee=c.useRef(null),{data:z=[],isLoading:se}=M({queryKey:["/api/social/posts"],queryFn:()=>o("/api/social/posts","GET"),enabled:k}),{data:ae=[]}=M({queryKey:["/api/social/posts",a==null?void 0:a.id,"comments"],queryFn:()=>o(`/api/social/posts/${a==null?void 0:a.id}/comments`,"GET"),enabled:!!a&&k}),U=x({mutationFn:async s=>o("/api/social/posts","POST",s),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/social/posts"]}),S(""),q(""),g(!1),n({title:"Post created!",description:"Your post has been shared successfully."})},onError:s=>{n({title:"Error creating post",description:s.message||"Failed to create post. Please try again.",variant:"destructive"})}});x({mutationFn:async({postId:s,data:r})=>o(`/api/social/posts/${s}`,"PUT",r),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/social/posts"]}),F(null),n({title:"Post updated!",description:"Your post has been updated successfully."})},onError:s=>{n({title:"Error updating post",description:s.message||"Failed to update post. Please try again.",variant:"destructive"})}});const te=x({mutationFn:async s=>o(`/api/social/posts/${s}`,"DELETE"),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/social/posts"]}),n({title:"Post deleted!",description:"Your post has been deleted successfully."})},onError:s=>{n({title:"Error deleting post",description:s.message||"Failed to delete post. Please try again.",variant:"destructive"})}}),ie=x({mutationFn:async({postId:s,content:r,parentCommentId:y})=>o(`/api/social/posts/${s}/comments`,"POST",{content:r,parentCommentId:y}),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/social/posts",a==null?void 0:a.id,"comments"]}),P(""),E(null),n({title:"Comment posted!",description:"Your comment has been posted successfully."})},onError:s=>{n({title:"Error posting comment",description:s.message||"Failed to post comment. Please try again.",variant:"destructive"})}}),ne=x({mutationFn:async({commentId:s,content:r})=>o(`/api/social/comments/${s}`,"PUT",{content:r}),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/social/posts",a==null?void 0:a.id,"comments"]}),N(null),n({title:"Comment updated!",description:"Your comment has been updated successfully."})},onError:s=>{n({title:"Error updating comment",description:s.message||"Failed to update comment. Please try again.",variant:"destructive"})}}),re=x({mutationFn:async s=>o(`/api/social/comments/${s}`,"DELETE"),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/social/posts",a==null?void 0:a.id,"comments"]}),n({title:"Comment deleted!",description:"Your comment has been deleted successfully."})},onError:s=>{n({title:"Error deleting comment",description:s.message||"Failed to delete comment. Please try again.",variant:"destructive"})}}),le=x({mutationFn:async({postId:s,commentId:r})=>o("/api/social/like","POST",{postId:s,commentId:r}),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/social/posts"]}),a&&d.invalidateQueries({queryKey:["/api/social/posts",a.id,"comments"]})},onError:s=>{n({title:"Error",description:s.message||"Failed to like/unlike. Please try again.",variant:"destructive"})}}),$=()=>{if(!p.trim()&&!v.trim()){n({title:"Error",description:"Please enter some content or an image URL.",variant:"destructive"});return}U.mutate({content:p,imageUrl:v||void 0})},ce=s=>{confirm("Are you sure you want to delete this post?")&&te.mutate(s)},oe=()=>{!a||!j.trim()||ie.mutate({postId:a.id,content:j,parentCommentId:l==null?void 0:l.id})},de=s=>{m&&ne.mutate({commentId:s.id,content:m.content})},me=s=>{confirm("Are you sure you want to delete this comment?")&&re.mutate(s)},D=(s,r)=>{le.mutate({postId:s,commentId:r})},T=s=>s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.userId,R=s=>s.firstName&&s.lastName?`${s.firstName[0]}${s.lastName[0]}`:s.userId.substring(0,2).toUpperCase();return k?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"CivicSocial Feed"}),e.jsx("p",{className:"text-gray-600",children:"Share your thoughts and engage with the community"})]}),e.jsx(u,{className:"mb-6",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs(f,{className:"h-10 w-10",children:[e.jsx(C,{src:i==null?void 0:i.profileImageUrl}),e.jsxs(b,{children:[(A=i==null?void 0:i.firstName)==null?void 0:A[0],(L=i==null?void 0:i.lastName)==null?void 0:L[0]]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(w,{placeholder:"What's on your mind?",value:p,onChange:s=>S(s.target.value),className:"min-h-[100px] resize-none",ref:ee}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>g(!0),children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Add Image"]}),e.jsxs(t,{variant:"outline",size:"sm",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Emoji"]})]}),e.jsxs(t,{onClick:$,disabled:U.isPending||!p.trim()&&!v.trim(),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Post"]})]})]})]})})}),e.jsx("div",{className:"space-y-6",children:se?e.jsx("div",{className:"animate-pulse space-y-6",children:[...Array(3)].map((s,r)=>e.jsx(u,{children:e.jsxs(h,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})},r))}):z.length===0?e.jsx(u,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-gray-600",children:"Be the first to share something!"})]})})}):z.map(s=>e.jsxs(u,{children:[e.jsx(je,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(f,{className:"h-10 w-10",children:[e.jsx(C,{src:s.profileImageUrl}),e.jsx(b,{children:R(s)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:T(s)}),e.jsx("p",{className:"text-sm text-gray-500",children:K(new Date(s.createdAt),{addSuffix:!0})})]})]}),s.userId===(i==null?void 0:i.id)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>F(s),children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>ce(s.id),children:e.jsx(G,{className:"w-4 h-4"})})]})]})}),e.jsxs(h,{children:[s.content&&e.jsx("p",{className:"text-gray-900 mb-4",children:s.content}),s.imageUrl&&e.jsx("img",{src:s.imageUrl,alt:"Post image",className:"w-full h-64 object-cover rounded-lg mb-4"}),s.type==="share"&&s.comment&&e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:e.jsx("p",{className:"text-sm text-gray-600",children:s.comment})}),e.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>D(s.id),className:s.isLiked?"text-red-500":"",children:[e.jsx(O,{className:`w-4 h-4 mr-2 ${s.isLiked?"fill-current":""}`}),s.likeCount]}),e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>{_(s),I(!0)},children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),s.commentCount]}),e.jsxs(t,{variant:"ghost",size:"sm",children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Share"]})]})})]})]},s.id))}),e.jsx(Y,{open:V,onOpenChange:g,children:e.jsxs(H,{children:[e.jsx(W,{children:e.jsx(B,{children:"Create Post"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(w,{placeholder:"What's on your mind?",value:p,onChange:s=>S(s.target.value),className:"min-h-[120px]"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Image URL (optional)"}),e.jsx("input",{type:"url",placeholder:"https://example.com/image.jpg",value:v,onChange:s=>q(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(t,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(t,{onClick:$,children:"Post"})]})]})]})}),e.jsx(Y,{open:Z,onOpenChange:I,children:e.jsxs(H,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(W,{children:e.jsx(B,{children:"Comments"})}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsxs(f,{className:"h-8 w-8",children:[e.jsx(C,{src:a.profileImageUrl}),e.jsx(b,{children:R(a)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:T(a)}),e.jsx("p",{className:"text-xs text-gray-500",children:K(new Date(a.createdAt),{addSuffix:!0})})]})]}),a.content&&e.jsx("p",{className:"text-sm",children:a.content})]})}),e.jsx("div",{className:"space-y-4",children:ae.map(s=>{var r,y;return e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(f,{className:"h-8 w-8 flex-shrink-0",children:[e.jsx(C,{src:s.profileImageUrl}),e.jsxs(b,{children:[(r=s.firstName)==null?void 0:r[0],(y=s.lastName)==null?void 0:y[0]]})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-medium text-sm",children:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.userId}),s.userId===(i==null?void 0:i.id)&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>N(s),children:e.jsx(J,{className:"w-3 h-3"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>me(s.id),children:e.jsx(G,{className:"w-3 h-3"})})]})]}),(m==null?void 0:m.id)===s.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{value:m.content,onChange:xe=>N({...m,content:xe.target.value}),className:"min-h-[80px]"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(t,{size:"sm",onClick:()=>de(s),children:"Save"}),e.jsx(t,{size:"sm",variant:"outline",onClick:()=>N(null),children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm",children:s.content}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>D(void 0,s.id),className:s.isLiked?"text-red-500":"",children:[e.jsx(O,{className:`w-3 h-3 mr-1 ${s.isLiked?"fill-current":""}`}),s.likeCount]}),e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>E(s),children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),"Reply"]})]})]})]})})]},s.id)})}),e.jsxs("div",{className:"space-y-2",children:[l&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-600",children:["Replying to ",l.firstName&&l.lastName?`${l.firstName} ${l.lastName}`:l.userId]}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>E(null),children:"Cancel reply"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(w,{placeholder:l?"Write a reply...":"Write a comment...",value:j,onChange:s=>P(s.target.value),className:"flex-1"}),e.jsx(t,{onClick:oe,disabled:!j.trim(),children:e.jsx(Q,{className:"w-4 h-4"})})]})]})]})]})})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(u,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Sign in to view the social feed"}),e.jsx("p",{className:"text-gray-600",children:"Join the conversation and connect with other citizens."})]})})})})}function Fe(){return e.jsx(Ce,{})}export{Fe as default};
