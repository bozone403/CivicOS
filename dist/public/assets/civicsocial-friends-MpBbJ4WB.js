import{j as e}from"./ui-wkHeCsE0.js";import{r as n}from"./vendor-DRd396Ms.js";import{q as C,g as o,ac as P,B as x,ad as u,U as y,ae as R,t as E}from"./index-ps_rrfzi.js";import{a as z,f as $,g as D,h as L,e as M}from"./useCivicSocial-DRRO2Tst.js";import{C as B}from"./check-CGAfdnS_.js";function H(){const{user:l}=C(),{data:i,isLoading:I,error:S}=z(),b=(i==null?void 0:i.friends)||[],h=(i==null?void 0:i.received)||[],g=(i==null?void 0:i.sent)||[],a=$(),f=D(),d=L(),p=M(),[r,c]=n.useState(""),[v,m]=n.useState([]),[k,j]=n.useState(!1),[N,F]=n.useState(null);n.useEffect(()=>{if(r.length<2){m([]);return}let s=!1;return j(!0),F(null),fetch(`/api/users/search?q=${encodeURIComponent(r)}`).then(t=>t.json()).then(t=>{s||(m(t.users||[]),j(!1))}).catch(()=>{}),()=>{s=!0}},[r]);const U=s=>{s.preventDefault(),r.trim()&&(a.mutate({friendId:Number(r)},{onSuccess:()=>{p.mutate({userId:r,type:"friend_request",title:"New Friend Request",message:`${(l==null?void 0:l.firstName)||(l==null?void 0:l.email)||"A user"} sent you a friend request.`})}}),c(""))},A=s=>{f.mutate({friendId:s},{onSuccess:()=>{p.mutate({userId:s,type:"friend_accept",title:"Friend Request Accepted",message:`${(l==null?void 0:l.firstName)||(l==null?void 0:l.email)||"A user"} accepted your friend request!`})}})},w=s=>{d.mutate({friendId:s})};return e.jsxs("div",{className:"max-w-2xl mx-auto flex flex-col gap-6",children:[e.jsxs(o,{className:"p-6 mb-4 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700 fade-in-up flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(P,{className:"w-8 h-8 text-civic-blue"}),e.jsx("div",{className:"font-bold text-2xl text-civic-blue",children:"Add Friends"})]}),e.jsxs("form",{className:"flex gap-2 w-full max-w-xs relative",onSubmit:U,"aria-label":"Add friend form",children:[e.jsx("input",{className:"border rounded-lg px-3 py-2 flex-1 bg-background focus:ring-2 focus:ring-civic-blue",placeholder:"Search users by name or email",value:r,onChange:s=>c(s.target.value),disabled:a.isPending,"aria-label":"Friend user ID or search",autoComplete:"off"}),e.jsx(x,{type:"submit",size:"sm",disabled:!r.trim()||a.isPending,"aria-label":"Send friend request",className:"bg-civic-blue text-white font-bold hover:bg-civic-gold transition-colors px-4 py-2 rounded-lg",children:a.isPending?e.jsx(u,{className:"animate-spin w-4 h-4"}):"Add Friend"}),v.length>0&&e.jsx("div",{className:"absolute top-full left-0 w-full bg-white border rounded shadow z-10 mt-1 max-h-48 overflow-y-auto",children:v.map(s=>e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 hover:bg-civic-blue/10 cursor-pointer",onClick:()=>{c(s.id),m([])},tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(c(s.id),m([]))},role:"option","aria-selected":r===s.id,children:[s.profileImageUrl?e.jsx("img",{src:s.profileImageUrl,alt:"Avatar",className:"w-8 h-8 rounded-full object-cover border-2 border-civic-blue"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-civic-blue text-white flex items-center justify-center text-lg font-bold",children:(s.firstName||s.email||"?")[0]}),e.jsx("span",{className:"font-medium",children:s.firstName||s.email||s.id}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.email})]},s.id))}),k&&e.jsx("div",{className:"absolute top-full left-0 w-full bg-white border rounded shadow z-10 mt-1 p-2 text-xs",children:"Searching..."}),N&&e.jsx("div",{className:"absolute top-full left-0 w-full bg-white border rounded shadow z-10 mt-1 p-2 text-xs text-red-500",children:N})]}),a.error&&e.jsx("div",{className:"text-xs text-red-500 mt-2",role:"alert",children:"Error sending request."})]}),e.jsxs(o,{className:"p-6 mb-4 bg-gradient-to-br from-yellow-50 to-white/80 dark:from-yellow-900 dark:to-slate-900/80 shadow-lg rounded-xl border border-yellow-200 dark:border-yellow-700 fade-in-up",children:[e.jsxs("div",{className:"font-bold text-lg mb-2 text-yellow-800 dark:text-yellow-200 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"})," Pending Friend Requests"]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[h.length===0&&e.jsx("div",{className:"text-muted-foreground",children:"No pending requests."}),h.map(s=>e.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-lg border border-gray-200 bg-white/80 hover:bg-yellow-50 focus-within:bg-yellow-100 p-3 transition shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.profileImageUrl?e.jsx("img",{src:s.profileImageUrl,alt:"Avatar",className:"w-10 h-10 rounded-full object-cover border-2 border-yellow-400"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-yellow-400 text-white flex items-center justify-center text-lg font-bold",children:(s.firstName||s.email||"?")[0]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.firstName||s.email||`User ${s.userId}`}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.email})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{size:"sm",onClick:()=>A(s.userId),disabled:f.isPending,"aria-label":"Accept friend request",className:"bg-civic-blue text-white font-bold hover:bg-civic-gold transition-colors rounded-lg",children:f.isPending?e.jsx(u,{className:"animate-spin w-4 h-4"}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Accept"]})}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>w(s.userId),disabled:d.isPending,"aria-label":"Decline friend request",className:"rounded-lg",children:d.isPending?e.jsx(u,{className:"animate-spin w-4 h-4"}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-1"}),"Decline"]})})]})]},s.id))]})]}),e.jsxs(o,{className:"p-6 mb-4 bg-white/90 dark:bg-slate-900/90 shadow-lg rounded-xl border border-gray-200 dark:border-slate-700 fade-in-up",children:[e.jsxs("div",{className:"font-bold text-lg mb-2 text-civic-blue flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"})," Your Friends"]}),I&&e.jsx("div",{children:"Loading friends..."}),S&&e.jsx("div",{className:"text-red-500",children:"Error loading friends."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[b.length===0&&e.jsx("div",{className:"text-muted-foreground col-span-2",children:"You have no friends yet."}),b.map(s=>e.jsxs(o,{className:"p-4 flex items-center justify-between gap-3 rounded-xl border border-gray-200 bg-gradient-to-br from-blue-50 to-white/80 hover:bg-civic-blue/10 focus-within:bg-civic-blue/20 transition shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.profileImageUrl?e.jsx("img",{src:s.profileImageUrl,alt:"Avatar",className:"w-10 h-10 rounded-full object-cover border-2 border-civic-blue"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-civic-blue text-white flex items-center justify-center text-lg font-bold",children:(s.firstName||s.email||"?")[0]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.firstName||s.email||`User ${s.friendId}`}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.email})]})]}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>w(s.friendId),disabled:d.isPending,"aria-label":"Unfriend",className:"rounded-lg",children:d.isPending?e.jsx(u,{className:"animate-spin w-4 h-4"}):"Unfriend"})]},s.id))]})]}),g.length>0&&e.jsxs(o,{className:"p-6 mb-4 bg-gradient-to-br from-blue-50 to-white/80 dark:from-blue-900 dark:to-slate-900/80 shadow-lg rounded-xl border border-blue-200 dark:border-blue-700 fade-in-up",children:[e.jsxs("div",{className:"font-bold text-lg mb-2 text-blue-800 dark:text-blue-200 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"})," Sent Friend Requests"]}),e.jsx("div",{className:"flex flex-col gap-3",children:g.map(s=>e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-gray-200 bg-white/80 hover:bg-blue-50 focus-within:bg-blue-100 p-3 transition shadow-sm",children:[s.profileImageUrl?e.jsx("img",{src:s.profileImageUrl,alt:"Avatar",className:"w-10 h-10 rounded-full object-cover border-2 border-blue-400"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-400 text-white flex items-center justify-center text-lg font-bold",children:(s.firstName||s.email||"?")[0]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.firstName||s.email||`User ${s.friendId}`}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.email})]}),e.jsx("span",{className:"ml-auto text-xs text-blue-500 font-medium",children:"Pending"})]},s.id))})]})]})}export{H as default};
