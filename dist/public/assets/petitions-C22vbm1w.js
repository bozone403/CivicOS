import{j as e}from"./ui-B-8yHimL.js";import{r as l}from"./vendor-DRd396Ms.js";import{q as M,p as O,z as $,H as Q,r as x,g as m,j as h,T as R,l as U,I as _,h as K,i as V,E as b,C as w,U as S,B as n,Y as C,D as Y,a as G,b as J,d as W,e as X,w as c}from"./index-CR-aYzqG.js";import{S as Z,a as ee,b as se,c as ae,d as r}from"./select-DYd-yP49.js";import{P as te}from"./progress-DVvEPVZ_.js";import{C as P}from"./clock-Boq4qXxy.js";import{B as T}from"./bookmark-BtUfnQE8.js";import{T as ie}from"./target-Dg1fydKV.js";import{C as re}from"./calendar-DcKbuyO_.js";import"./index-Bfvbq57u.js";function pe(){const{isAuthenticated:u}=M(),{toast:i}=O(),k=$(),[d,L]=l.useState(""),[o,E]=l.useState("all"),[t,ne]=l.useState(null),[D,q]=l.useState(!1),{data:F=[],isLoading:z,error:A}=Q({queryKey:["/api/petitions"],queryFn:()=>c("/api/petitions","GET")}),g=x({mutationFn:async({petitionId:s,verificationId:a})=>c(`/api/petitions/${s}/sign`,"POST",{verificationId:a}),onSuccess:()=>{i({title:"Petition signed!",description:"Your signature has been recorded successfully."}),k.invalidateQueries({queryKey:["/api/petitions"]})},onError:s=>{i({title:"Error signing petition",description:s.message||"Failed to sign petition. Please try again.",variant:"destructive"})}}),j=x({mutationFn:async({petitionId:s,platform:a})=>c(`/api/petitions/${s}/share`,"POST",{platform:a}),onSuccess:s=>{s.shareLink&&window.open(s.shareLink,"_blank"),i({title:"Petition shared!",description:"The petition has been shared successfully."})},onError:s=>{i({title:"Error sharing petition",description:s.message||"Failed to share petition. Please try again.",variant:"destructive"})}}),p=x({mutationFn:async s=>c(`/api/petitions/${s}/save`,"POST"),onSuccess:()=>{i({title:"Petition saved!",description:"The petition has been saved to your bookmarks."})},onError:s=>{i({title:"Error saving petition",description:s.message||"Failed to save petition. Please try again.",variant:"destructive"})}}),y=async s=>{if(!u){i({title:"Authentication required",description:"Please log in to sign petitions.",variant:"destructive"});return}const a=`petition_${s}_${Date.now()}`;g.mutate({petitionId:s,verificationId:a})},v=async(s,a)=>{j.mutate({petitionId:s,platform:a})},f=async s=>{if(!u){i({title:"Authentication required",description:"Please log in to save petitions.",variant:"destructive"});return}p.mutate(s)},N=F.filter(s=>{const a=s.title.toLowerCase().includes(d.toLowerCase())||s.description.toLowerCase().includes(d.toLowerCase()),I=o==="all"||s.category===o;return a&&I}),H=s=>{switch(s.toLowerCase()){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},B=(s,a)=>Math.min(s/a*100,100);return z?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"animate-pulse space-y-6",children:[...Array(6)].map((s,a)=>e.jsx(m,{children:e.jsxs(h,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})},a))})}):A?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(m,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(R,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Petitions"}),e.jsx("p",{className:"text-gray-600",children:"Unable to load petitions at this time. Please try again later."})]})})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Canadian Petitions"}),e.jsx("p",{className:"text-gray-600",children:"Make your voice heard on important issues affecting Canadians"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(_,{placeholder:"Search petitions...",value:d,onChange:s=>L(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(Z,{value:o,onValueChange:E,children:[e.jsx(ee,{children:e.jsx(se,{placeholder:"Filter by category"})}),e.jsxs(ae,{children:[e.jsx(r,{value:"all",children:"All Categories"}),e.jsx(r,{value:"Healthcare",children:"Healthcare"}),e.jsx(r,{value:"Environment",children:"Environment"}),e.jsx(r,{value:"Democracy",children:"Democracy"}),e.jsx(r,{value:"Indigenous Rights",children:"Indigenous Rights"}),e.jsx(r,{value:"Housing",children:"Housing"}),e.jsx(r,{value:"Economy",children:"Economy"}),e.jsx(r,{value:"Transparency",children:"Transparency"})]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:N.map(s=>e.jsxs(m,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(K,{className:"pb-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(V,{className:"text-lg mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{variant:"outline",className:"text-xs",children:s.category}),e.jsx(b,{className:`text-xs ${H(s.urgency)}`,children:s.urgency}),s.verified&&e.jsx(w,{className:"h-4 w-4 text-green-600"})]})]})})}),e.jsxs(h,{children:[e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:s.description}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[s.currentSignatures.toLocaleString()," / ",s.targetSignatures.toLocaleString()]})]}),e.jsx(te,{value:B(s.currentSignatures,s.targetSignatures),className:"h-2"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.currentSignatures.toLocaleString()," signatures"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.daysLeft," days left"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-100",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s.creator}),s.verified&&e.jsx(w,{className:"w-4 h-4 text-green-600"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>f(s.id),disabled:p.isPending,children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>v(s.id,"twitter"),disabled:j.isPending,children:[e.jsx(C,{className:"w-4 h-4 mr-1"}),"Share"]})]}),e.jsx(n,{size:"sm",onClick:()=>y(s.id),disabled:g.isPending,children:"Sign Petition"})]})]})]},s.id))}),N.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ie,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No petitions found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your search or filter criteria."})]}),e.jsx(Y,{open:D,onOpenChange:q,children:e.jsx(G,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:t&&e.jsxs("div",{children:[e.jsxs(J,{children:[e.jsx(W,{children:t.title}),e.jsx(X,{children:t.description})]}),e.jsxs("div",{className:"space-y-6 mt-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{children:[t.currentSignatures.toLocaleString()," signatures"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{children:[t.daysLeft," days left"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:t.status})]})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Key Supporters"}),e.jsx("div",{className:"space-y-2",children:t.supporters.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-600",children:s.role})]}),e.jsx("span",{className:"text-xs text-gray-500",children:s.location})]},a))})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["Created by: ",t.creator]}),e.jsxs("span",{children:[t.daysLeft," days remaining"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>f(t.id),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Save"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>v(t.id,"twitter"),children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Share"]}),e.jsx(n,{size:"sm",onClick:()=>y(t.id),children:"Sign Petition"})]})]})]})]})})})]})}export{pe as default};
