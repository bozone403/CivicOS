import{j as e}from"./ui-CDUWW_Ri.js";import{r as d}from"./vendor-1XCZ5AD1.js";import{q as X,p as Z,E as le,r as ne,y,g as c,j as o,R as L,B as p,X as K,Y as M,Z as z,$ as ce,v as O,M as _,a0 as oe,a1 as me,a2 as de,u as H,K as D,s as xe,a3 as J,U as ue,a4 as he,Q as ge}from"./index-BtY_Uh1j.js";import{T as pe,a as je,b as E,c as R}from"./tabs-BXcED2zq.js";import{T as Ne}from"./tag-BZJkuGmE.js";import{u as ve}from"./useCivicSocial-Bofus-Kh.js";import{S as fe}from"./star-Xnb4xrO8.js";import{C as ye}from"./calendar-B-4PS7Y4.js";import{A as W}from"./award-Doe1_0eD.js";function be({onPostCreated:j,placeholder:$="What's on your mind?",showLocation:r=!0,showMood:m=!0,showTags:N=!0,showVisibility:A=!0,showImageUpload:k=!0,className:b="",autoFocus:s=!1}){var G,Y;const{user:h}=X(),{toast:l}=Z(),w=le(),[n,C]=d.useState(""),[v,S]=d.useState("public"),[g,f]=d.useState(""),[a,x]=d.useState(""),[u,U]=d.useState([]),[P,q]=d.useState(null),[Q,I]=d.useState(null),[V,B]=d.useState(!1),ee=ne({mutationFn:async t=>y("/api/social/posts","POST",t),onSuccess:()=>{l({title:"Post created!",description:"Your post has been shared to your profile and the feed."}),w.invalidateQueries({queryKey:["social-posts"]}),w.invalidateQueries({queryKey:["user-posts"]}),se(),j==null||j()},onError:t=>{l({title:"Post failed",description:t.message||"Failed to create post. Please try again.",variant:"destructive"})}}),se=()=>{C(""),S("public"),f(""),x(""),U([]),q(null),I(null)},ae=t=>{var T;const i=(T=t.target.files)==null?void 0:T[0];i&&(q(i),I(URL.createObjectURL(i)))},te=async t=>{if(t.preventDefault(),!n.trim()&&!P){l({title:"Content required",description:"Please enter some content or upload an image.",variant:"destructive"});return}if(!h){l({title:"Login required",description:"Please log in to create posts.",variant:"destructive"});return}B(!0);try{let i=null;if(P){const F=new FormData;F.append("image",P),i=(await y("/api/upload/image","POST",F)).imageUrl}const T={content:n.trim(),type:"post",visibility:v,imageUrl:i,location:g.trim()||void 0,mood:a.trim()||void 0,tags:u.filter(F=>F.trim())};ee.mutate(T)}catch(i){console.error("Post creation error:",i),l({title:"Post failed",description:"Failed to create post. Please try again.",variant:"destructive"})}finally{B(!1)}},ie=t=>{if(t.key==="Enter"||t.key===","){t.preventDefault();const i=t.currentTarget.value.trim();i&&!u.includes(i)&&(U([...u,i]),t.currentTarget.value="")}},re=t=>{U(u.filter(i=>i!==t))};return h?e.jsx(c,{className:`p-4 ${b}`,children:e.jsx(o,{className:"p-0",children:e.jsxs("form",{onSubmit:te,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(K,{className:"w-10 h-10",children:[e.jsx(M,{src:h.profileImageUrl}),e.jsx(z,{className:"bg-blue-600",children:((G=h.firstName)==null?void 0:G[0])||((Y=h.email)==null?void 0:Y[0])||"U"})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx(ce,{placeholder:$,value:n,onChange:t=>C(t.target.value),className:"min-h-[100px] resize-none border-0 focus:ring-0 p-0 text-base",autoFocus:s,maxLength:1e3}),Q&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:Q,alt:"Preview",className:"max-w-xs max-h-48 rounded-lg object-cover"}),e.jsx(p,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 w-6 h-6 p-0",onClick:()=>{q(null),I(null)},children:"×"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[N&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Add tags (press Enter or comma)",onKeyDown:ie,className:"flex-1 text-sm border-0 focus:ring-0 p-0 bg-transparent"})]}),u.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map((t,i)=>e.jsxs(O,{variant:"secondary",className:"text-xs",children:["#",t,e.jsx("button",{type:"button",onClick:()=>re(t),className:"ml-1 hover:text-red-600",children:"×"})]},i))})]}),e.jsxs("div",{className:"flex gap-4",children:[r&&e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(_,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Add location",value:g,onChange:t=>f(t.target.value),className:"flex-1 text-sm border-0 focus:ring-0 p-0 bg-transparent"})]}),m&&e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"How are you feeling?",value:a,onChange:t=>x(t.target.value),className:"flex-1 text-sm border-0 focus:ring-0 p-0 bg-transparent"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[k&&e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(me,{className:"w-5 h-5 text-gray-500 hover:text-blue-600"}),e.jsx("input",{type:"file",accept:"image/*",onChange:ae,className:"hidden"})]}),A&&e.jsxs("select",{value:v,onChange:t=>S(t.target.value),className:"text-sm border-0 focus:ring-0 p-0 bg-transparent",children:[e.jsx("option",{value:"public",children:"Public"}),e.jsx("option",{value:"friends",children:"Friends"}),e.jsx("option",{value:"private",children:"Private"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[n.length,"/1000"]}),e.jsxs(p,{type:"submit",disabled:!n.trim()&&!P||V,size:"sm",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),V?"Posting...":"Post"]})]})]})]})]})})}):e.jsx(c,{className:`p-4 ${b}`,children:e.jsxs(o,{className:"text-center py-8",children:[e.jsx(L,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Login to Post"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Join the conversation by logging in to your CivicOS account."}),e.jsx(p,{onClick:()=>window.location.href="/auth",children:"Login to Post"})]})})}function Ue(){var f;const[j]=H(),[,$]=H(),r=j.split("/").pop(),{user:m}=X(),{toast:N}=Z(),[A,k]=d.useState("posts"),b=ve(),{data:s,isLoading:h}=D({queryKey:["user-profile",r],queryFn:async()=>(await y(`/api/users/profile/${r}`,"GET")).profile,enabled:!!r}),{data:l,isLoading:w}=D({queryKey:["user-posts",r],queryFn:async()=>(await y(`/api/social/posts/user/${r}`,"GET")).posts||[],enabled:!!r}),{data:n}=D({queryKey:["user-achievements",r],queryFn:async()=>(await y(`/api/users/${r}/achievements`,"GET")).achievements||[],enabled:!!r}),C=async()=>{const a=`${window.location.origin}/profile/${r}`,x=`Check out ${(s==null?void 0:s.firstName)||(s==null?void 0:s.username)}'s profile on CivicOS`;try{navigator.share?await navigator.share({title:`${(s==null?void 0:s.firstName)||(s==null?void 0:s.username)}'s Profile`,text:x,url:a}):(await navigator.clipboard.writeText(`${x} ${a}`),N({title:"Link copied!",description:"Profile link has been copied to your clipboard."}))}catch(u){console.error("Share error:",u)}},v=()=>s!=null&&s.firstName&&(s!=null&&s.lastName)?`${s.firstName} ${s.lastName}`:s!=null&&s.firstName?s.firstName:s!=null&&s.username?s.username:"Anonymous User",S=a=>{switch(a==null?void 0:a.toLowerCase()){case"champion":return"bg-purple-500";case"expert":return"bg-blue-500";case"advocate":return"bg-green-500";case"active":return"bg-yellow-500";default:return"bg-gray-500"}},g=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return h?e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading profile..."})]})}):s?e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx(c,{className:"mb-8",children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs(K,{className:"w-24 h-24",children:[e.jsx(M,{src:s.profileImageUrl}),e.jsx(z,{className:"bg-blue-600 text-2xl",children:(f=v()[0])==null?void 0:f.toUpperCase()})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold",children:v()}),s.isVerified&&e.jsxs(O,{variant:"secondary",children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),"Verified"]}),e.jsx(O,{className:`text-xs ${S(s.civicLevel||"")}`,children:s.civicLevel||"Registered"})]}),e.jsxs("p",{className:"text-gray-600",children:["@",s.username]}),s.bio&&e.jsx("p",{className:"text-gray-700 max-w-md",children:s.bio}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4"}),s.location]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),"Joined ",g(s.joinDate)]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:C,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Share Profile"]}),(m==null?void 0:m.id)!==s.id&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{variant:"default",size:"sm",onClick:()=>$(`/civicsocial/messages?recipientId=${encodeURIComponent(s.id)}`),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Message"]}),e.jsxs(p,{variant:"secondary",size:"sm",onClick:()=>b.mutate({followingId:s.id},{onSuccess:()=>N({title:"Followed",description:`You are now following @${s.username}`}),onError:a=>N({title:"Follow failed",description:(a==null?void 0:a.message)||"Could not follow user",variant:"destructive"})}),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Follow"]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx(c,{children:e.jsxs(o,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.postsCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"Posts"})]})}),e.jsx(c,{children:e.jsxs(o,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.followersCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"Followers"})]})}),e.jsx(c,{children:e.jsxs(o,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:s.followingCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"Following"})]})}),e.jsx(c,{children:e.jsxs(o,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:s.civicPoints}),e.jsx("div",{className:"text-sm text-gray-600",children:"Civic Points"})]})})]}),e.jsxs(pe,{value:A,onValueChange:k,children:[e.jsxs(je,{className:"grid w-full grid-cols-3",children:[e.jsx(E,{value:"posts",children:"Posts"}),e.jsx(E,{value:"achievements",children:"Achievements"}),e.jsx(E,{value:"activity",children:"Activity"})]}),e.jsx(R,{value:"posts",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[(m==null?void 0:m.id)===s.id&&e.jsx(be,{placeholder:`What's on your mind, ${s.firstName||s.username}?`,onPostCreated:()=>{window.location.reload()}}),w?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading posts..."})]}):(l==null?void 0:l.length)===0?e.jsx(c,{children:e.jsxs(o,{className:"p-8 text-center",children:[e.jsx(L,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-gray-600",children:(m==null?void 0:m.id)===s.id?"Share your first post to get started!":`${s.firstName||s.username} hasn't posted anything yet.`})]})}):e.jsx("div",{className:"space-y-4",children:l==null?void 0:l.map(a=>{var x;return e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(K,{className:"w-10 h-10",children:[e.jsx(M,{src:a.user.profileImageUrl}),e.jsx(z,{className:"bg-blue-600",children:((x=a.user.firstName)==null?void 0:x[0])||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"font-semibold",children:[a.user.firstName," ",a.user.lastName]}),e.jsx("span",{className:"text-sm text-gray-500",children:g(a.createdAt)})]}),e.jsx("p",{className:"text-gray-800 mb-3",children:a.content}),a.imageUrl&&e.jsx("img",{src:a.imageUrl,alt:"Post",className:"rounded-lg max-w-full h-auto mb-3"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("button",{className:"flex items-center gap-1 hover:text-blue-600",children:[e.jsx(he,{className:"w-4 h-4"}),a.likesCount||0]}),e.jsxs("button",{className:"flex items-center gap-1 hover:text-blue-600",children:[e.jsx(L,{className:"w-4 h-4"}),a.commentsCount||0]}),e.jsxs("button",{className:"flex items-center gap-1 hover:text-blue-600",children:[e.jsx(J,{className:"w-4 h-4"}),a.sharesCount||0]})]})]})]})})},a.id)})})]})}),e.jsx(R,{value:"achievements",className:"mt-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(n==null?void 0:n.length)===0?e.jsx(c,{className:"col-span-full",children:e.jsxs(o,{className:"p-8 text-center",children:[e.jsx(W,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No achievements yet"}),e.jsx("p",{className:"text-gray-600",children:"Keep engaging with civic activities to earn achievements!"})]})}):n==null?void 0:n.map(a=>e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(W,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Earned ",g(a.earnedAt)]})]})]})})},a.id))})}),e.jsx(R,{value:"activity",className:"mt-6",children:e.jsx(c,{children:e.jsxs(o,{className:"p-8 text-center",children:[e.jsx(ge,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Activity Feed"}),e.jsx("p",{className:"text-gray-600",children:"Recent civic engagement activity will appear here."})]})})})]})]}):e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Profile Not Found"}),e.jsx("p",{className:"text-gray-600",children:"The user profile you're looking for doesn't exist."})]})})}export{Ue as default};
