import{j as e,v as je,w as Ne,r as u,x as we,y as Z,I as ee,z as se,A as te,E as ae,F as ne,G as ie,L as re,H as oe}from"./ui-D2Re0T6U.js";import{z as le,q as F,p as q,E as ce,K as de,r as P,y as S,H as x,B as m,aa as be,J as Ce,X as O,Y as G,Z as J,$ as T,a2 as W,_ as D,s as ke,g as Se,j as Ee,v as X,ab as Re,a4 as ze,ac as Pe,a3 as $e}from"./app-CDP34tcP.js";import{T as Me,a as De}from"./thumbs-up-DwuAKGK7.js";import{C as Te}from"./clock-B6e33f1c.js";import{P as Ae}from"./pen-UOGIAb5c.js";import{T as Fe}from"./trash-2-BXXfZXt5.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=le("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=le("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);function Ie({targetType:t,targetId:a,className:n="",size:i="md",showCounts:p=!0}){const{user:w}=F(),{toast:v}=q(),o=ce(),{data:r,isLoading:c}=de({queryKey:[`/api/vote/${t}/${a}`],enabled:!!a}),h=P({mutationFn:async d=>await(await S("/api/vote","POST",{targetType:t,targetId:a,voteType:d})).json(),onSuccess:d=>{o.setQueryData([`/api/vote/${t}/${a}`],d),o.invalidateQueries({queryKey:[`/api/${t}s`]}),o.invalidateQueries({queryKey:["/api/forum/posts"]}),o.invalidateQueries({queryKey:["/api/politicians"]}),o.invalidateQueries({queryKey:["/api/bills"]})},onError:d=>{let g="Failed to register vote";if(d.message){if(d.message.includes("already voted")){v({title:"Already Voted",description:"You have already voted on this item. Each user can only vote once.",variant:"default"});return}const k=d.message.match(/400: (.+)/);if(k)try{g=JSON.parse(k[1]).message||g}catch{g=k[1]}else g=d.message}v({title:"Vote Failed",description:g,variant:"destructive"})}}),E=d=>{if(!w){v({title:"Login Required",description:"Please log in to vote",variant:"destructive"});return}h.mutate(d)},R=(r==null?void 0:r.upvotes)||0,z=(r==null?void 0:r.downvotes)||0,f=(r==null?void 0:r.totalScore)||0,y=r==null?void 0:r.userVote,b={sm:"h-7 w-7",md:"h-8 w-8",lg:"h-10 w-10"},C={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"};return e.jsxs("div",{className:x("flex items-center space-x-2",n),children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(m,{variant:y==="upvote"?"default":"outline",size:"sm",className:x(b[i],"p-0",y==="upvote"&&"bg-green-600 hover:bg-green-700 text-white"),onClick:()=>E("upvote"),disabled:h.isPending||c,children:e.jsx(Me,{className:C[i]})}),p&&e.jsx("span",{className:"text-sm font-medium text-green-600 min-w-[20px] text-center",children:R})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(m,{variant:y==="downvote"?"default":"outline",size:"sm",className:x(b[i],"p-0",y==="downvote"&&"bg-red-600 hover:bg-red-700 text-white"),onClick:()=>E("downvote"),disabled:h.isPending||c,children:e.jsx(De,{className:C[i]})}),p&&e.jsx("span",{className:"text-sm font-medium text-red-600 min-w-[20px] text-center",children:z})]}),p&&e.jsxs("div",{className:"flex items-center space-x-1 ml-2 pl-2 border-l",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Score:"}),e.jsx("span",{className:x("text-sm font-bold",f>0&&"text-green-600",f<0&&"text-red-600",f===0&&"text-gray-500"),children:f>0?`+${f}`:f})]})]})}const Ve=je,Ue=Ne,Ke=u.forwardRef(({className:t,inset:a,children:n,...i},p)=>e.jsxs(se,{ref:p,className:x("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",t),...i,children:[n,e.jsx(be,{className:"ml-auto"})]}));Ke.displayName=se.displayName;const Qe=u.forwardRef(({className:t,...a},n)=>e.jsx(te,{ref:n,className:x("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...a}));Qe.displayName=te.displayName;const me=u.forwardRef(({className:t,sideOffset:a=4,...n},i)=>e.jsx(we,{children:e.jsx(Z,{ref:i,sideOffset:a,className:x("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-white/95 backdrop-blur-md p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...n})}));me.displayName=Z.displayName;const A=u.forwardRef(({className:t,inset:a,...n},i)=>e.jsx(ee,{ref:i,className:x("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",t),...n}));A.displayName=ee.displayName;const _e=u.forwardRef(({className:t,children:a,checked:n,...i},p)=>e.jsxs(ae,{ref:p,className:x("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:n,...i,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ne,{children:e.jsx(Ce,{className:"h-4 w-4"})})}),a]}));_e.displayName=ae.displayName;const Be=u.forwardRef(({className:t,children:a,...n},i)=>e.jsxs(ie,{ref:i,className:x("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ne,{children:e.jsx(qe,{className:"h-2 w-2 fill-current"})})}),a]}));Be.displayName=ie.displayName;const Ye=u.forwardRef(({className:t,inset:a,...n},i)=>e.jsx(re,{ref:i,className:x("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",t),...n}));Ye.displayName=re.displayName;const He=u.forwardRef(({className:t,...a},n)=>e.jsx(oe,{ref:n,className:x("-mx-1 my-1 h-px bg-muted",t),...a}));He.displayName=oe.displayName;function Oe({targetType:t,targetId:a,allowReplies:n=!0,allowEditing:i=!0,allowDeleting:p=!0,showUserAvatars:w=!0,maxDepth:v=3}){var K,Q;const{user:o,isAuthenticated:r}=F(),{toast:c}=q();ce();const[h,E]=u.useState(""),[R,z]=u.useState(null),[f,y]=u.useState(""),[b,C]=u.useState(null),[d,g]=u.useState(""),{data:k=[],isLoading:L,refetch:$}=de({queryKey:[`/api/social/comments/${t}/${a}`],queryFn:async()=>{try{return await S(`/api/social/comments/${t}/${a}`,"GET")||[]}catch(s){return console.error("Failed to fetch comments:",s),[]}},staleTime:300*1e3}),M=P({mutationFn:async s=>await S("/api/social/comments","POST",{content:s,targetType:t,targetId:a,parentCommentId:b||void 0}),onSuccess:()=>{E(""),C(null),g(""),$(),c({title:"Comment posted!",description:"Your comment has been added successfully."})},onError:s=>{c({title:"Failed to post comment",description:s.message||"Please try again.",variant:"destructive"})}}),ue=P({mutationFn:async({commentId:s,content:l})=>await S(`/api/social/comments/${s}`,"PUT",{content:l}),onSuccess:()=>{z(null),y(""),$(),c({title:"Comment updated!",description:"Your comment has been updated successfully."})},onError:s=>{c({title:"Failed to update comment",description:s.message||"Please try again.",variant:"destructive"})}}),xe=P({mutationFn:async s=>await S(`/api/social/comments/${s}`,"DELETE"),onSuccess:()=>{$(),c({title:"Comment deleted!",description:"Your comment has been removed successfully."})},onError:s=>{c({title:"Failed to delete comment",description:s.message||"Please try again.",variant:"destructive"})}}),I=P({mutationFn:async({commentId:s,reaction:l})=>await S(`/api/social/comments/${s}/like`,"POST",{reaction:l}),onSuccess:()=>{$()},onError:s=>{c({title:"Failed to react to comment",description:s.message||"Please try again.",variant:"destructive"})}}),V=s=>{s.preventDefault(),h.trim()&&(b?M.mutate(d):M.mutate(h))},pe=(s,l)=>{z(s),y(l)},he=()=>{!R||!f.trim()||ue.mutate({commentId:R,content:f})},fe=s=>{confirm("Are you sure you want to delete this comment?")&&xe.mutate(s)},ge=s=>{C(s),g("")},ve=(s,l)=>{if(!r){c({title:"Login required",description:"Please log in to react to comments.",variant:"destructive"});return}const j=l==="like"?null:"like";I.mutate({commentId:s,reaction:j||"like"})},ye=(s,l)=>{if(!r){c({title:"Login required",description:"Please log in to react to comments.",variant:"destructive"});return}const j=l==="dislike"?null:"dislike";I.mutate({commentId:s,reaction:j||"dislike"})},U=(s,l=0)=>{var _,B,Y,H;if(l>v)return null;const j=(_=s.user)!=null&&_.firstName&&((B=s.user)!=null&&B.lastName)?`${s.user.firstName} ${s.user.lastName}`:((Y=s.user)==null?void 0:Y.email)||"Anonymous";return e.jsx(Se,{className:`mb-4 ${l>0?"ml-8 border-l-2 border-gray-200":""}`,children:e.jsx(Ee,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[w&&e.jsxs(O,{className:"w-8 h-8",children:[e.jsx(G,{src:(H=s.user)==null?void 0:H.profileImageUrl}),e.jsx(J,{children:j.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900",children:j}),e.jsxs(X,{variant:"outline",className:"text-xs",children:[e.jsx(Te,{className:"w-3 h-3 mr-1"}),Re(new Date(s.createdAt),{addSuffix:!0})]}),s.updatedAt&&s.updatedAt!==s.createdAt&&e.jsx(X,{variant:"secondary",className:"text-xs",children:"Edited"})]}),R===s.id?e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{value:f,onChange:N=>y(N.target.value),placeholder:"Edit your comment...",className:"min-h-[80px]"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{size:"sm",onClick:he,children:"Save"}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>z(null),children:"Cancel"})]})]}):e.jsx("div",{className:"text-sm text-gray-700 mb-3",children:s.content}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>ve(s.id,s.userVote),className:`flex items-center space-x-1 ${s.userVote==="like"?"text-blue-600":"text-gray-500"}`,children:[e.jsx(ze,{className:`w-4 h-4 ${s.userVote==="like"?"fill-current":""}`}),e.jsx("span",{children:s.likeCount})]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>ye(s.id,s.userVote),className:`flex items-center space-x-1 ${s.userVote==="dislike"?"text-red-600":"text-gray-500"}`,children:e.jsx("span",{children:s.dislikeCount})}),n&&l<v&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:()=>ge(s.id),className:"flex items-center space-x-1 text-gray-500 hover:text-gray-700",children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx("span",{children:"Reply"})]}),(s.canEdit||s.canDelete)&&e.jsxs(Ve,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(Pe,{className:"w-4 h-4"})})}),e.jsxs(me,{align:"end",children:[s.canEdit&&i&&e.jsxs(A,{onClick:()=>pe(s.id,s.content),children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Edit"]}),s.canDelete&&p&&e.jsxs(A,{onClick:()=>fe(s.id),className:"text-red-600",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})]}),b===s.id&&e.jsx("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("form",{onSubmit:N=>{N.preventDefault(),V(N)},children:[e.jsx(T,{value:d,onChange:N=>g(N.target.value),placeholder:"Write a reply...",className:"mb-2"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(m,{size:"sm",type:"submit",disabled:!d.trim(),children:[e.jsx(W,{className:"w-4 h-4 mr-1"}),"Reply"]}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>C(null),children:"Cancel"})]})]})}),s.replies&&s.replies.length>0&&e.jsx("div",{className:"mt-4",children:s.replies.map(N=>U(N,l+1))})]})]})})},s.id)};return L?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})}):e.jsxs("div",{className:"space-y-6",children:[r&&e.jsx("form",{onSubmit:V,className:"space-y-3",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[w&&e.jsxs(O,{className:"w-8 h-8",children:[e.jsx(G,{src:o==null?void 0:o.profileImageUrl}),e.jsx(J,{children:((K=o==null?void 0:o.firstName)==null?void 0:K.charAt(0).toUpperCase())||((Q=o==null?void 0:o.email)==null?void 0:Q.charAt(0).toUpperCase())||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(T,{value:h,onChange:s=>E(s.target.value),placeholder:"Write a comment...",className:"min-h-[100px] resize-none"}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[h.length,"/1000 characters"]}),e.jsxs(m,{type:"submit",size:"sm",disabled:!h.trim()||M.isPending,children:[M.isPending?e.jsx("div",{className:"w-4 h-4 animate-spin border-2 border-white border-t-transparent rounded-full mr-2"}):e.jsx(W,{className:"w-4 h-4 mr-1"}),"Post Comment"]})]})]})]})}),!r&&e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-lg",children:[e.jsx(D,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Please log in to comment"}),e.jsxs(m,{variant:"outline",size:"sm",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Login to Comment"]})]}),e.jsx("div",{className:"space-y-4",children:k.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(D,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"No comments yet. Be the first to share your thoughts!"})]}):k.map(s=>U(s))})]})}function ss({targetType:t,targetId:a,title:n,description:i,showVoting:p=!0,showComments:w=!0,showSharing:v=!0}){const{user:o}=F(),{toast:r}=q(),c=async()=>{try{await navigator.share({title:n,text:i,url:window.location.href})}catch{navigator.clipboard.writeText(window.location.href),r({title:"Link copied",description:"The link has been copied to your clipboard."})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[p&&e.jsx(Ie,{targetType:t,targetId:Number(a),size:"md"}),v&&e.jsxs(m,{variant:"outline",size:"sm",onClick:c,className:"flex items-center space-x-2",children:[e.jsx($e,{className:"w-4 h-4"}),e.jsx("span",{children:"Share"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{children:"Discussion"})]})]}),w&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(D,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Comments"})]}),e.jsx(Oe,{targetType:t,targetId:a,allowReplies:!0,allowEditing:!0,allowDeleting:!0,showUserAvatars:!0,maxDepth:3})]})]})}export{ss as I,Ie as V};
