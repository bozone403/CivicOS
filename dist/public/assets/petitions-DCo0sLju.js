import{j as e}from"./ui-B-8yHimL.js";import{r as d}from"./vendor-DRd396Ms.js";import{c as re,r as le,q as ce,E as oe,J as de,s as u,h as N,k as C,T as H,B as c,m as me,I as g,i as he,j as xe,G as O,C as F,U as I,a2 as q,D as z,a as M,b as R,d as U,e as Q,L as m,Q as ue,x as h}from"./index-BeuhHH6b.js";import{S as B,a as $,b as K,c as V,d as t}from"./select-g9Wws6eC.js";import{P as ge}from"./progress-CYyvPjO9.js";import{P as pe}from"./plus-p65hhI2O.js";import{C as _}from"./clock-CJDX51rL.js";import{T as je}from"./target-BK1PvMK4.js";import{C as ye}from"./calendar-V_ntvd4L.js";import"./index-Bfvbq57u.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=re("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]),J=[{id:1,title:"Climate Action Now",description:"Urgent petition calling for immediate climate action and carbon reduction targets in Canada.",creator:"Climate Action Network",category:"Environment",region:"National",targetSignatures:5e4,currentSignatures:32450,daysLeft:45,status:"active",urgency:"high",verified:!0,image:"https://images.unsplash.com/photo-1569163139394-de4e4c5c5c5c?w=800&h=400&fit=crop",tags:["Climate","Environment","Action"],supporters:[{name:"Greenpeace Canada",role:"Environmental Organization",location:"National"},{name:"Sierra Club Canada",role:"Environmental Organization",location:"National"}]},{id:2,title:"Universal Healthcare Expansion",description:"Petition to expand universal healthcare coverage to include dental, vision, and mental health services.",creator:"Canadian Health Coalition",category:"Healthcare",region:"National",targetSignatures:75e3,currentSignatures:56780,daysLeft:30,status:"active",urgency:"medium",verified:!0,image:"https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?w=800&h=400&fit=crop",tags:["Healthcare","Universal Coverage","Dental"],supporters:[{name:"Canadian Medical Association",role:"Professional Association",location:"National"},{name:"Canadian Nurses Association",role:"Professional Association",location:"National"}]},{id:3,title:"Housing Affordability Crisis",description:"Petition demanding immediate action on the housing affordability crisis affecting millions of Canadians.",creator:"Housing Rights Coalition",category:"Housing",region:"National",targetSignatures:1e5,currentSignatures:89230,daysLeft:20,status:"active",urgency:"critical",verified:!0,image:"https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=400&fit=crop",tags:["Housing","Affordability","Crisis"],supporters:[{name:"Canadian Housing and Renewal Association",role:"Housing Organization",location:"National"},{name:"ACORN Canada",role:"Tenant Organization",location:"National"}]}];function p(l){return l?typeof l=="string"?l:typeof l.message=="string"?l.message:typeof l.message=="object"?JSON.stringify(l.message):JSON.stringify(l):"Unknown error"}function Ae(){const{user:l,isAuthenticated:j}=le(),{toast:n}=ce(),b=oe(),[y,Y]=d.useState(""),[v,W]=d.useState("all"),[r,ve]=d.useState(null),[X,Z]=d.useState(!1),[ee,x]=d.useState(!1),[i,o]=d.useState({title:"",description:"",category:"Democracy",targetSignatures:500,deadlineDate:""}),{data:w=[],isLoading:se,error:S}=de({queryKey:["/api/petitions"],queryFn:async()=>{try{const s=await h("/api/petitions","GET");return s&&Array.isArray(s)?s:s&&s.data&&Array.isArray(s.data)?s.data:(console.warn("Unexpected API response format, using fallback data"),J)}catch{return J}},retry:2,retryDelay:1e3}),P=u({mutationFn:async({petitionId:s,verificationId:a})=>h(`/api/petitions/${s}/sign`,"POST",{verificationId:a}),onSuccess:()=>{n({title:"Petition signed!",description:"Your signature has been recorded successfully."}),b.invalidateQueries({queryKey:["/api/petitions"]})},onError:s=>{n({title:"Error signing petition",description:p(s)||"Failed to sign petition. Please try again.",variant:"destructive"})}}),k=u({mutationFn:async({petitionId:s,platform:a})=>h(`/api/petitions/${s}/share`,"POST",{platform:a}),onSuccess:s=>{s.shareLink&&window.open(s.shareLink,"_blank"),n({title:"Petition shared!",description:"The petition has been shared successfully."})},onError:s=>{n({title:"Error sharing petition",description:p(s)||"Failed to share petition. Please try again.",variant:"destructive"})}}),D=u({mutationFn:async s=>h(`/api/petitions/${s}/save`,"POST"),onSuccess:()=>{n({title:"Petition saved!",description:"The petition has been saved to your bookmarks."})},onError:s=>{n({title:"Error saving petition",description:p(s)||"Failed to save petition. Please try again.",variant:"destructive"})}}),f=u({mutationFn:async s=>h("/api/petitions","POST",s),onSuccess:()=>{n({title:"Petition created!",description:"Your petition has been created successfully."}),x(!1),o({title:"",description:"",category:"Democracy",targetSignatures:500,deadlineDate:""}),b.invalidateQueries({queryKey:["/api/petitions"]})},onError:s=>{n({title:"Error creating petition",description:p(s)||"Failed to create petition. Please try again.",variant:"destructive"})}}),E=async s=>{if(!j){n({title:"Authentication required",description:"Please log in to sign petitions.",variant:"destructive"});return}const a=`petition_${s}_${Date.now()}`;P.mutate({petitionId:s,verificationId:a})},A=async(s,a)=>{k.mutate({petitionId:s,platform:a})},T=async s=>{if(!j){n({title:"Authentication required",description:"Please log in to save petitions.",variant:"destructive"});return}D.mutate(s)},ae=async()=>{if(!j){n({title:"Authentication required",description:"Please log in to create petitions.",variant:"destructive"});return}if(!i.title||!i.description){n({title:"Missing information",description:"Please fill in all required fields.",variant:"destructive"});return}f.mutate(i)},L=w.filter(s=>{const a=s.title.toLowerCase().includes(y.toLowerCase())||s.description.toLowerCase().includes(y.toLowerCase()),ne=v==="all"||s.category===v;return a&&ne}),te=s=>{switch(s.toLowerCase()){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},ie=(s,a)=>Math.min(s/a*100,100);return se?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"animate-pulse space-y-6",children:[...Array(6)].map((s,a)=>e.jsx(N,{children:e.jsxs(C,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})},a))})}):S&&w.length===0?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(N,{children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Error Loading Petitions"}),e.jsx("p",{className:"text-gray-600",children:"Unable to load petitions at this time. Please try again later."})]})})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Canadian Petitions"}),e.jsx("p",{className:"text-gray-600",children:"Make your voice heard on important issues affecting Canadians"})]}),e.jsxs(c,{onClick:()=>x(!0),className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Create Petition"]})]}),S&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx(H,{className:"inline w-4 h-4 mr-1"}),"Showing sample data due to connection issues. Some features may be limited."]})}),!1]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(g,{placeholder:"Search petitions...",value:y,onChange:s=>Y(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(B,{value:v,onValueChange:W,children:[e.jsx($,{children:e.jsx(K,{placeholder:"Filter by category"})}),e.jsxs(V,{children:[e.jsx(t,{value:"all",children:"All Categories"}),e.jsx(t,{value:"Healthcare",children:"Healthcare"}),e.jsx(t,{value:"Environment",children:"Environment"}),e.jsx(t,{value:"Democracy",children:"Democracy"}),e.jsx(t,{value:"Indigenous Rights",children:"Indigenous Rights"}),e.jsx(t,{value:"Housing",children:"Housing"}),e.jsx(t,{value:"Economy",children:"Economy"}),e.jsx(t,{value:"Transparency",children:"Transparency"})]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:L.map(s=>e.jsxs(N,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(he,{className:"pb-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(xe,{className:"text-lg mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(O,{variant:"outline",className:"text-xs",children:s.category}),e.jsx(O,{className:`text-xs ${te(s.urgency)}`,children:s.urgency}),s.verified&&e.jsx(F,{className:"h-4 w-4 text-green-600"})]})]})})}),e.jsxs(C,{children:[e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:s.description}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[s.currentSignatures.toLocaleString()," / ",s.targetSignatures.toLocaleString()]})]}),e.jsx(ge,{value:ie(s.currentSignatures,s.targetSignatures),className:"h-2"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.currentSignatures.toLocaleString()," signatures"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.daysLeft," days left"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-100",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s.creator}),s.verified&&e.jsx(F,{className:"w-4 h-4 text-green-600"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>T(s.id),disabled:D.isPending,children:[e.jsx(G,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>A(s.id,"twitter"),disabled:k.isPending,children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"Share"]})]}),e.jsx(c,{size:"sm",onClick:()=>E(s.id),disabled:P.isPending,children:"Sign Petition"})]})]})]},s.id))}),L.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(je,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No petitions found"}),e.jsx("p",{className:"text-gray-600",children:"Try adjusting your search or filter criteria."})]}),e.jsx(z,{open:X,onOpenChange:Z,children:e.jsx(M,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:r&&e.jsxs("div",{children:[e.jsxs(R,{children:[e.jsx(U,{children:r.title}),e.jsx(Q,{children:r.description})]}),e.jsxs("div",{className:"space-y-6 mt-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{children:[r.currentSignatures.toLocaleString()," signatures"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{children:[r.daysLeft," days left"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:r.status})]})]})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Key Supporters"}),e.jsx("div",{className:"space-y-2",children:r.supporters.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-600",children:s.role})]}),e.jsx("span",{className:"text-xs text-gray-500",children:s.location})]},a))})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["Created by: ",r.creator]}),e.jsxs("span",{children:[r.daysLeft," days remaining"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>T(r.id),children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Save"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>A(r.id,"twitter"),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Share"]}),e.jsx(c,{size:"sm",onClick:()=>E(r.id),children:"Sign Petition"})]})]})]})]})})}),e.jsx(z,{open:ee,onOpenChange:x,children:e.jsxs(M,{className:"max-w-2xl",children:[e.jsxs(R,{children:[e.jsx(U,{children:"Create New Petition"}),e.jsx(Q,{children:"Start a petition to make your voice heard on important issues."})]}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"title",children:"Petition Title *"}),e.jsx(g,{id:"title",placeholder:"Enter petition title...",value:i.title,onChange:s=>o({...i,title:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"description",children:"Description *"}),e.jsx(ue,{id:"description",placeholder:"Describe your petition and why it's important...",value:i.description,onChange:s=>o({...i,description:s.target.value}),rows:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"category",children:"Category"}),e.jsxs(B,{value:i.category,onValueChange:s=>o({...i,category:s}),children:[e.jsx($,{children:e.jsx(K,{})}),e.jsxs(V,{children:[e.jsx(t,{value:"Democracy",children:"Democracy"}),e.jsx(t,{value:"Healthcare",children:"Healthcare"}),e.jsx(t,{value:"Environment",children:"Environment"}),e.jsx(t,{value:"Housing",children:"Housing"}),e.jsx(t,{value:"Economy",children:"Economy"}),e.jsx(t,{value:"Indigenous Rights",children:"Indigenous Rights"}),e.jsx(t,{value:"Transparency",children:"Transparency"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"targetSignatures",children:"Target Signatures"}),e.jsx(g,{id:"targetSignatures",type:"number",placeholder:"500",value:i.targetSignatures,onChange:s=>o({...i,targetSignatures:parseInt(s.target.value)||500})})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"deadlineDate",children:"Deadline (Optional)"}),e.jsx(g,{id:"deadlineDate",type:"date",value:i.deadlineDate,onChange:s=>o({...i,deadlineDate:s.target.value})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx(c,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(c,{onClick:ae,disabled:f.isPending,children:f.isPending?"Creating...":"Create Petition"})]})]})})]})}export{Ae as default};
